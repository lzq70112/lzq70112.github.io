(window.webpackJsonp=window.webpackJsonp||[]).push([[190],{660:function(s,a,t){"use strict";t.r(a);var r=t(20),n=Object(r.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("Harbor 开机自启遇到容器不全的问题\n")]),s._v(" "),t("h2",{attrs:{id:"_1、问题描述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、问题描述"}},[s._v("#")]),s._v(" 1、问题描述")]),s._v(" "),t("p",[s._v("每次harbor重启之后，容器就会起不了\n"),t("code",[s._v("docker ps")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("CONTAINER ID   IMAGE                                    COMMAND                  CREATED      STATUS                 PORTS                       NAMES\nd0057d84c397   goharbor/registry-photon:v2.6.2-v1.7.8   "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/entrypoint.sh /etc…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" days ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" hours "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp                    registry\n1bae11fc827a   goharbor/harbor-log:v1.7.8               "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh -c /usr/loc…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" days ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" hours "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:1514-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10514")]),s._v("/tcp   harbor-log\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("code",[s._v("vim docker-compose.yml")]),s._v(" #查看配置文件有restart选项")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("version: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2'")]),s._v("\nservices:\n  log:\n    image: goharbor/harbor-log:v1.7.8\n    container_name: harbor-log\n    restart: always\n    dns_search: "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n    cap_drop:\n      - ALL\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h2",{attrs:{id:"_2、解决方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、解决方法"}},[s._v("#")]),s._v(" 2、解决方法")]),s._v(" "),t("p",[t("code",[s._v("vim /lib/systemd/system/harbor.service")]),s._v("#添加service启动")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[Unit]\nDescription=Harbor\nAfter=docker.service systemd-networkd.service systemd-resolved.service\nRequires=docker.service\nDocumentation=http://github.com/vmware/harbor\n\n[Service]\nType=simple\nRestart=on-failure\nRestartSec=5\nExecStart=/usr/bin/docker-compose -f /usr/local/src/harbor/docker-compose.yml up\nExecStop=/usr/bin/docker-compose -f /usr/local/src/harbor/docker-compose.yml down\n\n[Install]\nWantedBy=multi-user.target\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" harbor\nsystemctl start harbor\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"_3、开机测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、开机测试"}},[s._v("#")]),s._v(" 3、开机测试")]),s._v(" "),t("p",[t("code",[s._v("docker ps")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("CONTAINER ID   IMAGE                                    COMMAND                  CREATED          STATUS                    PORTS                                                                                                                 NAMES\nea86aeb4cde0   goharbor/nginx-photon:v1.7.8             "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx -g \'daemon of…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" seconds "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:80-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp, :::80-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:443-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/tcp, :::443-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:4443-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4443")]),s._v("/tcp, :::4443-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4443")]),s._v("/tcp   nginx\n698e0fc7b6c5   goharbor/harbor-jobservice:v1.7.8        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/harbor/start.sh"')]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" seconds                                                                                                                                   harbor-jobservice\nbc1134c27a84   goharbor/harbor-portal:v1.7.8            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx -g \'daemon of…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" seconds "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp                                                                                                                harbor-portal\n5fd24b7e6ad8   goharbor/harbor-core:v1.7.8              "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/harbor/start.sh"')]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("47")]),s._v(" seconds "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                                                                         harbor-core\nf2e35468193b   goharbor/redis-photon:v1.7.8             "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-entrypoint.s…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" seconds             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("/tcp                                                                                                              redis\n1482ae680704   goharbor/harbor-db:v1.7.8                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/entrypoint.sh post…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v(" seconds "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5432")]),s._v("/tcp                                                                                                              harbor-db\n27a20042f6e2   goharbor/harbor-adminserver:v1.7.8       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/harbor/start.sh"')]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v(" seconds "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                                                                         harbor-adminserver\na68ef5ea219a   goharbor/registry-photon:v2.6.2-v1.7.8   "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/entrypoint.sh /etc…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v(" seconds "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp                                                                                                              registry\na973cc48f97c   goharbor/harbor-registryctl:v1.7.8       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/harbor/start.sh"')]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v(" seconds "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                                                                         registryctl\n922ebaa2117b   goharbor/harbor-log:v1.7.8               "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh -c /usr/loc…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" seconds "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:1514-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10514")]),s._v("/tcp       \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);