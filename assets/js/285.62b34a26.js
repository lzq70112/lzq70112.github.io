(window.webpackJsonp=window.webpackJsonp||[]).push([[285],{755:function(t,e,n){"use strict";n.r(e);var r=n(20),p=Object(r.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"_1-vpn应用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-vpn应用场景"}},[t._v("#")]),t._v(" 1.VPN应用场景")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lzq70112/images/blog/202201082233575.png",alt:"m_cc947729b6ac6ef1578f74b6cee4ad11_r"}})]),t._v(" "),n("h1",{attrs:{id:"_2-vpn服务端配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-vpn服务端配置"}},[t._v("#")]),t._v(" 2.VPN服务端配置")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lzq70112/images/blog/202201082233398.png",alt:"m_76e42c1968a4ac0f0e6d91454c1e25ed_r"}})]),t._v(" "),n("p",[t._v("实验环境规划\n"),n("img",{attrs:{src:"http://www.sunrisenan.com/uploads/linux/images/m_05313729f4d3fc3648f9db5ee70a9ad6_r.png",alt:"null"}})]),t._v(" "),n("p",[t._v("环境准备:")]),t._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@vpn-server ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl stop firewalld")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@vpn-server ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl disable firewalld")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@vpn-server ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# setenforce 0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@vpn-server ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# getenforce")]),t._v("\nDisabled\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("p",[n("strong",[t._v("1.配置epel源, 安装pptp VPN相关软件")])]),t._v(" "),n("blockquote",[n("p",[t._v("[root"),n("a",{attrs:{href:"https://github.com/vpn",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vpn"),n("OutboundLink")],1),t._v("-server ~]# wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo\n[root"),n("a",{attrs:{href:"https://github.com/vpn",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vpn"),n("OutboundLink")],1),t._v("-server ~]# yum install ppp pptp pptpd -y")])]),t._v(" "),n("p",[n("strong",[t._v("2.开启内核转发功能")])]),t._v(" "),n("blockquote",[n("p",[t._v("echo “net.ipv4.ip_forward=1” >> /etc/sysctl.conf\n[root"),n("a",{attrs:{href:"https://github.com/vpn",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vpn"),n("OutboundLink")],1),t._v("-server ~]# sysctl -p")])]),t._v(" "),n("p",[n("strong",[t._v("3.配置客户端上网DNS, 如客户端不需要分配DNS可不配置")])]),t._v(" "),n("blockquote",[n("p",[t._v("[root"),n("a",{attrs:{href:"https://github.com/vpn",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vpn"),n("OutboundLink")],1),t._v("-server ~]# vim /etc/ppp/options.pptpd +68\nms-dns 223.5.5.5")])]),t._v(" "),n("p",[n("strong",[t._v("4.设置VPN拨号的账号密码")])]),t._v(" "),n("blockquote",[n("p",[t._v("[root"),n("a",{attrs:{href:"https://github.com/vpn",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vpn"),n("OutboundLink")],1),t._v("-server ~]# vim /etc/ppp/chap-secrets\n# Secrets for authentication using CHAP\n# client server secret IP addresses\nbgx * 123456 *")])]),t._v(" "),n("p",[n("strong",[t._v("5.分配VPN拨号地址段, 注意和内网相同地址")])]),t._v(" "),n("blockquote",[n("p",[t._v("[root"),n("a",{attrs:{href:"https://github.com/vpn",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vpn"),n("OutboundLink")],1),t._v("-server ~]# vim /etc/pptpd.conf\n#添加本机公网IP（localip）\nlocalip 192.168.56.11\n#分配VPN用户的内网网段（remoteip）\nremoteip 172.16.56.100-200")])]),t._v(" "),n("p",[n("strong",[t._v("6.启动pptpd服务并加入开机自启动")])]),t._v(" "),n("blockquote",[n("p",[t._v("[root"),n("a",{attrs:{href:"https://github.com/vpn",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vpn"),n("OutboundLink")],1),t._v("-server ~]# systemctl start pptpd\n[root"),n("a",{attrs:{href:"https://github.com/vpn",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vpn"),n("OutboundLink")],1),t._v("-server ~]# systemctl enable pptpd\n//检查tcp1723端口是否开启\n[root"),n("a",{attrs:{href:"https://github.com/vpn",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vpn"),n("OutboundLink")],1),t._v("-server ~]# ss -lntup | grep 1723\ntcp LISTEN 0 3 "),n("em",[t._v(":1723 *:")]),t._v(" users:((“pptpd”,pid=3483,fd=6))")])]),t._v(" "),n("h1",{attrs:{id:"_3-win客户端配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-win客户端配置"}},[t._v("#")]),t._v(" 3.Win客户端配置")]),t._v(" "),n("p",[t._v("1.如果直接使用客户端连接内网地址是无法连接成功")]),t._v(" "),n("p",[n("img",{attrs:{src:"http://www.sunrisenan.com/uploads/linux/images/m_732a9756e5ab08b386bbc1ba58bb641f_r.png",alt:"null"}})]),t._v(" "),n("p",[t._v("2.打开网络共享中心，点击–>设置新的连接或网络")]),t._v(" "),n("p",[n("img",{attrs:{src:"http://www.sunrisenan.com/uploads/linux/images/m_9da07a4e4b67556ad209b671ae7fe29f_r.png",alt:"null"}})]),t._v(" "),n("p",[t._v("3.选择连接到工作区域")]),t._v(" "),n("p",[n("img",{attrs:{src:"http://www.sunrisenan.com/uploads/linux/images/m_ce09fb6c605c7ef7c4bb958307dbb63e_r.png",alt:"null"}})]),t._v(" "),n("p",[t._v("4.使用Internet连接到VPN服务")]),t._v(" "),n("p",[n("img",{attrs:{src:"http://www.sunrisenan.com/uploads/linux/images/m_f1ca2a4cf5c4658ce77459ed434d1be2_r.png",alt:"null"}})]),t._v(" "),n("p",[t._v("5.填写vpn地址以及名称,然后下一步")]),t._v(" "),n("p",[n("img",{attrs:{src:"http://www.sunrisenan.com/uploads/linux/images/m_3b361a9a9c452152b9ed66005d887d8a_r.png",alt:"null"}})]),t._v(" "),n("p",[t._v("6.填写在VPN-Server上配置好的用户名以及密码, 然后点击连接")]),t._v(" "),n("p",[n("img",{attrs:{src:"http://www.sunrisenan.com/uploads/linux/images/m_a5b7fa2b5d6f0ca3b316e4de9247efbe_r.png",alt:"null"}})]),t._v(" "),n("p",[t._v("7.VPN连接成功")]),t._v(" "),n("p",[n("img",{attrs:{src:"http://www.sunrisenan.com/uploads/linux/images/m_2d6a53ef7179fbf31f87d81fa003e9f3_r.png",alt:"null"}})]),t._v(" "),n("p",[t._v("8.测试是否能够连接100.100.1.50这台内网服务器,如图2-7")]),t._v(" "),n("p",[n("img",{attrs:{src:"http://www.sunrisenan.com/uploads/linux/images/m_87aa3f767ec21becf5320aab912421a6_r.png",alt:"null"}})]),t._v(" "),n("p",[n("img",{attrs:{src:"http://www.sunrisenan.com/uploads/linux/images/m_bf68e25ce83e1ce0c6e2af7e1ef12b43_r.png",alt:"null"}})]),t._v(" "),n("p",[t._v("默认连接VPN是会通过VPN的默认网关来进行上网,我们取消默认使用VPN连接上网功能即可")]),t._v(" "),n("p",[n("img",{attrs:{src:"http://www.sunrisenan.com/uploads/linux/images/m_06c47ceadb443962ba63726413cd97d3_r.png",alt:"null"}})]),t._v(" "),n("h1",{attrs:{id:"_4-linux客户端配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-linux客户端配置"}},[t._v("#")]),t._v(" 4.Linux客户端配置")]),t._v(" "),n("p",[n("strong",[t._v("1.以CentOS7.4为客户端,安装软件包")])]),t._v(" "),n("blockquote",[n("p",[t._v("yum install -y ppp pptp pptp-setup")])]),t._v(" "),n("p",[n("strong",[t._v("2.客户端连接VPN服务端")]),t._v("\n运行 pptpsetup –create test –server IP –username 用户名 –password 密码 –encrypt –start 连接 VPN 服务端。\n您需要填写实际配置 VPN 服务端的 IP 地址、用户名和密码。")]),t._v(" "),n("blockquote",[n("p",[t._v("[root"),n("a",{attrs:{href:"https://github.com/vpn",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vpn"),n("OutboundLink")],1),t._v("-client-rhel ~]# pptpsetup –create test –server 192.168.56.11 –username bgx –password 123456 –encrypt –start\nUsing interface ppp0\nConnect: ppp0 <–> /dev/pts/3\nCHAP authentication succeeded\nMPPE 128-bit stateless compression enabled\nlocal IP address 172.16.56.102\nremote IP address 192.168.56.11")])]),t._v(" "),n("p",[n("strong",[t._v("3.检查分配地址段")])]),t._v(" "),n("blockquote",[n("p",[t._v("[root"),n("a",{attrs:{href:"https://github.com/vpn",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vpn"),n("OutboundLink")],1),t._v("-client-rhel ~]# ifconfig|grep -A 5 ppp\nppp0: flags=4305<UP,POINTOPOINT,RUNNING,NOARP,MULTICAST> mtu 1496\ninet 172.16.56.102 netmask 255.255.255.255 destination 192.168.69.112\nppp txqueuelen 3 (Point-to-Point Protocol)\nRX packets 6 bytes 60 (60.0 B)\nRX errors 0 dropped 0 overruns 0 frame 0\nTX packets 6 bytes 66 (66.0 B)\nTX errors 0 dropped 0 overruns 0 carrier 0 collisions 0")])]),t._v(" "),n("p",[n("strong",[t._v("4.添加默认路由")])]),t._v(" "),n("blockquote",[n("p",[t._v("[root"),n("a",{attrs:{href:"https://github.com/vpn",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vpn"),n("OutboundLink")],1),t._v("-client-rhel ~]# ping "),n("a",{attrs:{href:"http://www.baidu.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("www.baidu.com"),n("OutboundLink")],1),t._v("\n[root"),n("a",{attrs:{href:"https://github.com/vpn",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vpn"),n("OutboundLink")],1),t._v("-client-rhel ~]# ip route replace default dev ppp0\n[root"),n("a",{attrs:{href:"https://github.com/vpn",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vpn"),n("OutboundLink")],1),t._v("-client-rhel ~]# ping "),n("a",{attrs:{href:"http://www.baidu.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("www.baidu.com"),n("OutboundLink")],1),t._v("\nPING baidu.com (220.181.57.216) 56(84) bytes of data.\n64 bytes from 220.181.57.216: icmp_seq=1 ttl=52 time=23.0 ms\n64 bytes from 220.181.57.216: icmp_seq=2 ttl=52 time=22.9 ms")])]),t._v(" "),n("p",[n("strong",[t._v("5.VPN连接故障")]),t._v("\n如下这类错误和VPN客户端拨号提示连接691错误类似")]),t._v(" "),n("blockquote",[n("p",[t._v("1.检查IPtables和Selinux，以及客户端防火墙。\n2.如果是云主机请检查安全组入口和出口是否运行1723端口访问。\n3.如果是物理主机需要向IDC了解是否关闭此端口, 或路由不支持此协议。\nNov 15 15:30:07 iZm5ea7wyzv7b8pzmd9vk5Z pppd[11407]: pppd 2.4.5 started by root, uid 0\nNov 15 15:30:07 iZm5ea7wyzv7b8pzmd9vk5Z pppd[11407]: Using interface ppp0\nNov 15 15:30:07 iZm5ea7wyzv7b8pzmd9vk5Z pppd[11407]: Connect: ppp0 <–> /dev/pts/2\nNov 15 15:30:38 iZm5ea7wyzv7b8pzmd9vk5Z pppd[11407]: LCP: timeout sending Config-Requests\nNov 15 15:30:38 iZm5ea7wyzv7b8pzmd9vk5Z pppd[11407]: Connection terminated.\nNov 15 15:30:38 iZm5ea7wyzv7b8pzmd9vk5Z pppd[11407]: Modem hangup\nNov 15 15:30:38 iZm5ea7wyzv7b8pzmd9vk5Z pppd[11407]: Exit.")])])])}),[],!1,null,null,null);e.default=p.exports}}]);