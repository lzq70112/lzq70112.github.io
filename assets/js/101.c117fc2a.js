(window.webpackJsonp=window.webpackJsonp||[]).push([[101],{568:function(s,e,a){"use strict";a.r(e);var n=a(20),t=Object(n.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("kubeasz3部署K8S-dashboard篇 kubeasz3自带的 kubeasz2不具备安装\n")]),s._v(" "),a("h2",{attrs:{id:"_1、安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、安装"}},[s._v("#")]),s._v(" 1、安装")]),s._v(" "),a("p",[a("code",[s._v("vim clusters/k8s-01/config.yml")]),s._v(" 从安装配置看默认安装")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dashboard 自动安装")]),s._v("\ndashboard_install: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yes"')]),s._v("\ndashboardVer: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v2.1.0"')]),s._v("\ndashboardMetricsScraperVer: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1.0.6"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_2、使用token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、使用token"}},[s._v("#")]),s._v(" 2、使用token")]),s._v(" "),a("p",[s._v("不再使用admin 单独使用")]),s._v(" "),a("p",[s._v("kubectl get secret -A")]),s._v(" "),a("p",[s._v("kubectl  describe secret  dashboard-read-user-token-mjm7k   -n kube-system")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("Name:         dashboard-read-user-token-mjm7k\nNamespace:    kube-system\nLabels:       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nAnnotations:  kubernetes.io/service-account.name: dashboard-read-user\n              kubernetes.io/service-account.uid: f67e7ba9-4d3a-4fc7-95e7-ae0d12cf2c9d\n\nType:  kubernetes.io/service-account-token\n\nData\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\nca.crt:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1350")]),s._v(" bytes\nnamespace:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" bytes\ntoken:      eyJhbGciOiJSUzI1NiIsImtpZCI6IndIaHNaWjVTZGNHV3YtanNTN09KbVpwVW1aUXh0LTNqZ09kQUgwVXFFa1kifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtcmVhZC11c2VyLXRva2VuLW1qbTdrIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImRhc2hib2FyZC1yZWFkLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJmNjdlN2JhOS00ZDNhLTRmYzctOTVlNy1hZTBkMTJjZjJjOWQiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06ZGFzaGJvYXJkLXJlYWQtdXNlciJ9.FcJZPgRNfBmizQapaUZYzrEP80GAMWddpI1guiDTywkNcJq8On-ShEdHaYdVYIQC0EiDubKGZV9LmEVknPoT_yasNU66hxG1fZ0F0lJ8SWUtiBs24n7Sz8iatEOfswNAwFiE24Cyp-Nqw0daqd-k8J945yjWn6v3XdbgIWVnq8D_EkMdTnt5X27TRiPev_cEiJMQecmKBRCjD9zVhVpLZWwwQn15l7uYwAMev_LMJNuxThHOhMP5hRA7Bc0DYC4boPnQA3-NadbC3iVh-BAJOIXwZBnZ-Jt0ppinxmBkcwUidEsA8JZxiesOYMdmYqxjfQQZR6p9OR1zm-mI53H_bg\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h3",{attrs:{id:"修改token-ttl值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改token-ttl值"}},[s._v("#")]),s._v(" 修改token-ttl值")]),s._v(" "),a("p",[s._v("领导提出需求，为了合理加长时间")]),s._v(" "),a("p",[a("code",[s._v("vim /etc/kubeasz/roles/cluster-addon/templates/dashboard/kubernetes-dashboard.yaml")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kind: Deployment\napiVersion: apps/v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      k8s-app: kubernetes-dashboard\n  template:\n    metadata:\n      labels:\n        k8s-app: kubernetes-dashboard\n    spec:\n      containers:\n        - name: kubernetes-dashboard\n          image: kubernetesui/dashboard:v2.1.0\n          ports:\n            - containerPort: 8443\n              protocol: TCP\n          args:\n            - --auto-generate-certificates\n            - --namespace=kube-system\n            - --token-ttl=7200\n\t\t\t# 添加ttl\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[a("code",[s._v("kubectl apply -f .")]),s._v(" #更新配置")]),s._v(" "),a("h2",{attrs:{id:"_3、kubeconfig登陆"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、kubeconfig登陆"}},[s._v("#")]),s._v(" 3、kubeconfig登陆")]),s._v(" "),a("p",[a("code",[s._v("DASH_TOCKEN=$(kubectl get secret -n kube-system dashboard-read-user-token-mjm7k -o jsonpath={.data.token}|base64 -d)")]),s._v(" "),a("code",[s._v("echo $DASH_TOCKEN")])]),s._v(" "),a("p",[a("code",[s._v("kubectl config set-cluster kubernetes --server=192.168.2.22:6443 --kubeconfig=/root/dashbord-read.conf")]),s._v(" # 集群信息")]),s._v(" "),a("p",[a("code",[s._v("kubectl config set-credentials dashboard-read --token=$DASH_TOCKEN --kubeconfig=/root/dashbord-read.conf")]),s._v(" #用户名")]),s._v(" "),a("p",[a("code",[s._v("kubectl config set-context dashboard-read@kubernetes --cluster=kubernetes --user=dashboard-read --kubeconfig=/root/dashbord-read.conf")])]),s._v(" "),a("p",[a("code",[s._v("kubectl config use-context dashboard-read@kubernetes --kubeconfig=/root/dashbord-read.conf")])])])}),[],!1,null,null,null);e.default=t.exports}}]);