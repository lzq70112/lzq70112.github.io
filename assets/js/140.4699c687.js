(window.webpackJsonp=window.webpackJsonp||[]).push([[140],{609:function(s,t,a){"use strict";a.r(t);var e=a(20),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"前-言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前-言"}},[s._v("#")]),s._v(" "),a("strong",[s._v("前 言")])]),s._v(" "),a("p",[s._v("NeuVector 是业界首个端到端的开源容器安全平台，唯一为容器化工作负载提供企业级零信任安全的解决方案。本文将从以下 5 个方面详细介绍如何部署 NeuVector：")]),s._v(" "),a("p",[a("strong",[s._v("1.  NeuVector 概览")])]),s._v(" "),a("p",[a("strong",[s._v("2.  NeuVector 安装")])]),s._v(" "),a("ol",[a("li",[s._v("高可用架构设计")]),s._v(" "),a("li",[s._v("多云安全管理")]),s._v(" "),a("li",[s._v("其他配置")])]),s._v(" "),a("h2",{attrs:{id:"_1-neuvector-概览"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-neuvector-概览"}},[s._v("#")]),s._v(" "),a("strong",[s._v("1.NeuVector 概览")])]),s._v(" "),a("p",[s._v("NeuVector 致力于保障企业级容器平台安全，可以提供实时深入的容器网络可视化、东西向容器网络监控、主动隔离和保护、容器主机安全以及容器内部安全，容器管理平台无缝集成并且实现应用级容器安全的自动化，适用于各种云环境、跨云或者本地部署等容器生产环境。")]),s._v(" "),a("p",[s._v("2021年， NeuVector 被 SUSE 收购，并在 2022 年 1 月完成开源，"),a("a",{attrs:{href:"https://links.jianshu.com/go?to=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzIyMTUwMDMyOQ%3D%3D%26mid%3D2247497361%26idx%3D1%26sn%3D00c0debaf63f3724b95a632ab8ef389a%26chksm%3De8397057df4ef941e74acbfc33721902fd1eb8e71b52e460e16e30ec8c0c3fb217be0a4fced7%26scene%3D21%23wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[s._v("成为业界首个端到端的开源容器安全平台"),a("OutboundLink")],1),s._v("，唯一为容器化工作负载提供企业级零信任安全的解决方案。")]),s._v(" "),a("p",[s._v("项目地址："),a("a",{attrs:{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fneuvector%2Fneuvector",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/neuvector/neuvector"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("本文主要基于 NeuVector 首个开源版 NeuVector:5.0.0-preview.1 进行介绍。")]),s._v(" "),a("h4",{attrs:{id:"_1-1-架构解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-架构解析"}},[s._v("#")]),s._v(" "),a("strong",[s._v("1.1. 架构解析")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/19330071-a18cc7cdeeb41caa?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("NeuVector 本身包含 Controller、Enforcer、Manager、Scanner 和 Updater 模块。")]),s._v(" "),a("ul",[a("li",[s._v("Controller ：整个 NeuVector 的控制模块，API 入口，包括配置下发，高可用主要考虑 Controller 的 HA ，通常建议部署 3 个 Controller 模块组成集群。")]),s._v(" "),a("li",[s._v("Enforcer ：主要用于安全策略部署下发和执行，DaemonSet 类型会在每个节点部署。")]),s._v(" "),a("li",[s._v("Manager：提供 web-UI(仅HTTPS) 和 CLI 控制台，供用户管理 NeuVector 。")]),s._v(" "),a("li",[s._v("Scanner ：对节点、容器、Kubernetes 、镜像进行 CVE 漏洞扫描")]),s._v(" "),a("li",[s._v("Updater ：cronjob ，用于定期更新 CVE 漏洞库")])]),s._v(" "),a("h4",{attrs:{id:"_1-2-主要功能概览"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-主要功能概览"}},[s._v("#")]),s._v(" "),a("strong",[s._v("1.2.主要功能概览")])]),s._v(" "),a("ul",[a("li",[s._v("安全漏洞扫描")]),s._v(" "),a("li",[s._v("容器网络流量可视化")]),s._v(" "),a("li",[s._v("网络安全策略定义")]),s._v(" "),a("li",[s._v("L7 防火墙")]),s._v(" "),a("li",[s._v("CICD 安全扫描")]),s._v(" "),a("li",[s._v("合规分析")])]),s._v(" "),a("p",[s._v("本文重点介绍安装部署，具体功能将在后续文章中深入介绍。")]),s._v(" "),a("h2",{attrs:{id:"_2-neuvector-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-neuvector-安装"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2.NeuVector 安装")])]),s._v(" "),a("p",[s._v("安装环境\n软件版本：\nOS：Ubuntu18.04\nKubernetes：1.20.14\nRancher：2.5.12\nDocker：19.03.15\nNeuVector：5.0.0-preview.1")]),s._v(" "),a("h4",{attrs:{id:"_2-1-快速部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-快速部署"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2.1. 快速部署")])]),s._v(" "),a("p",[s._v("创建 namespace")]),s._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[s._v("kubectl create "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("namespace")]),s._v(" neuvector\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("部署 CRD( Kubernetes 1.19+ 版本)")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("raw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("githubusercontent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("manifests"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("crd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k8s"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.19")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("部署 CRD(Kubernetes 1.18或更低版本)")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("raw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("githubusercontent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("manifests"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("crd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k8s"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("配置 RBAC")]),s._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[s._v("kubectl create clusterrole neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("app "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("verb"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("watch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("update "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("resource"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nodes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pods"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("services"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("namespaces\nkubectl create clusterrole neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rbac "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("verb"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("watch "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("resource"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("rolebindings"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("roles"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("clusterrolebindings"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("clusterroles"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io\nkubectl create clusterrolebinding neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("app "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("clusterrole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("app "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("serviceaccount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\nkubectl create clusterrolebinding neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rbac "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("clusterrole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rbac "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("serviceaccount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\nkubectl create clusterrole neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admission "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("verb"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("watch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("create"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("update"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("resource"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("validatingwebhookconfigurations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("mutatingwebhookconfigurations\nkubectl create clusterrolebinding neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admission "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("clusterrole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admission "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("serviceaccount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\nkubectl create clusterrole neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("customresourcedefinition "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("verb"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("watch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("create"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("get "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("resource"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("customresourcedefinitions\nkubectl create clusterrolebinding  neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("customresourcedefinition "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("clusterrole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("customresourcedefinition "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("serviceaccount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\nkubectl create clusterrole neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nvsecurityrules "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("verb"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("resource"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nvsecurityrules"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("nvclustersecurityrules\nkubectl create clusterrolebinding neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nvsecurityrules "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("clusterrole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nvsecurityrules "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("serviceaccount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\nkubectl create clusterrolebinding neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("view "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("clusterrole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("view "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("serviceaccount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\nkubectl create rolebinding neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admin "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("clusterrole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("serviceaccount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n neuvector\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("检查是否有以下 RBAC 对象")]),s._v(" "),a("div",{staticClass:"language-csharp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" clusterrolebinding  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" grep neuvector\nkubectl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" rolebinding "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n neuvector "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" grep neuvector\n\nkubectl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" clusterrolebinding  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" grep neuvector\n\nneuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admission                            ClusterRole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admission                            44h\nneuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("app                                  ClusterRole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("app                                  44h\nneuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("customresourcedefinition             ClusterRole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("customresourcedefinition             44h\nneuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nvadmissioncontrolsecurityrules      ClusterRole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nvadmissioncontrolsecurityrules      44h\nneuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nvsecurityrules                      ClusterRole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nvsecurityrules                      44h\nneuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nvwafsecurityrules                   ClusterRole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nvwafsecurityrules                   44h\nneuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rbac                                 ClusterRole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rbac                                 44h\nneuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("view                                 ClusterRole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("view                                                   44h\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("div",{staticClass:"language-csharp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" rolebinding "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n neuvector "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" grep neuvector\nneuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admin         ClusterRole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("admin            44h\nneuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("psp   Role"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("binding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("psp   44h\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("部署 NeuVector")]),s._v(" "),a("p",[s._v("底层 Runtime 为 Docker")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("raw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("githubusercontent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("manifests"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("docker"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("底层 Runtime 为 Containerd（对于 k3s 和 rke2 可以使用此 yaml 文件）")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("raw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("githubusercontent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("manifests"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("containerd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1.21 以下的 Kubernetes 版本会提示以下错误，将 yaml 文件下载将 batch/v1 修改为 batch/v1beta1")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("error: unable to recognize "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://raw.githubusercontent.com/neuvector/manifests/main/kubernetes/5.0.0/neuvector-docker-k8s.yaml"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" no matches "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" kind "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CronJob"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" version "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"batch/v1"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1.20.x cronjob 还处于 beta 阶段，1.21 版本开始 cronjob 才正式 GA 。")]),s._v(" "),a("p",[s._v("默认部署web-ui使用的是loadblance类型的Service，为了方便访问修改为NodePort，也可以通过 Ingress 对外提供服务")]),s._v(" "),a("div",{staticClass:"language-swift line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[s._v("kubectl patch  svc neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("service"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("webui  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n neuvector "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("'json' "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p '"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"op"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"replace"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/spec/type"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NodePort"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"op"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"add"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/spec/ports/0/nodePort"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30888")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("'\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("访问 "),a("a",{attrs:{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fnode_ip%3A30888",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://node_ip:30888"),a("OutboundLink")],1),s._v("\n默认密码为 admin/admin")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/19330071-9165398efcb4cef8?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("点击头像旁的 My profile 页面进入设置页面，设置密码和语言")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/19330071-0bb1763d17fe558c?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp",alt:"img"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/19330071-18a98eb87ae369db?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp",alt:"img"}})]),s._v(" "),a("h4",{attrs:{id:"_2-2-helm-部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-helm-部署"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2.2. Helm 部署")])]),s._v(" "),a("p",[s._v("添加 repo")]),s._v(" "),a("div",{staticClass:"language-csharp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[s._v("helm repo "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("neuvector")]),s._v(" https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("helm"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\nhelm search repo neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("core\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("创建 namespace")]),s._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[s._v("kubectl create "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("namespace")]),s._v(" neuvector\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("创建 ServiceAccount")]),s._v(" "),a("div",{staticClass:"language-undefined line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kubectl create serviceaccount neuvector -n neuvector\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("helm 安装")]),s._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[s._v("helm install neuvector "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("namespace")]),s._v(" neuvector neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("core  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("set registry"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("set\ntag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("preview"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("set"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("controller"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repository"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("controller"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("preview "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("\nset"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("enforcer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repository"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("enforcer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("preview "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("set \nmanager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repository"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("manager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("preview "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("set \ncve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("scanner"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repository"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("scanner"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("preview "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("set cve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("updater"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repository"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("updater"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("preview\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("Helm-chart 参数查看：\n"),a("a",{attrs:{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fneuvector%2Fneuvector-helm%2Ftree%2Fmaster%2Fcharts%2Fcore",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/neuvector/neuvector-helm/tree/master/charts/core"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"_3-高可用架构设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-高可用架构设计"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3. 高可用架构设计")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/19330071-4dca85a4c438402b?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("NeuVector-HA 主要需要考虑 Controller 模块的 HA，只要有一个 Controller 处于打开状态，所有数据都将在 3 个副本之间之间同步。")]),s._v(" "),a("p",[s._v("Controller 数据主要存储在 /var/neuvector/ 目录中，但出现 POD 重建或集群重新部署时，会自动从此目录加载备份文件，进行集群恢复。")]),s._v(" "),a("h4",{attrs:{id:"_3-1-部署策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-部署策略"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.1.部署策略")])]),s._v(" "),a("p",[s._v("NeuVector 官方提供四种 HA 部署模式")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/19330071-f0cb9ec22b21ff96?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("方式一：不进行任何调度限制，由 Kubernetes 进行自由调度管理管理。")]),s._v(" "),a("p",[s._v("方式二：NeuVector control 组件 (manager,controller）+enforce、scanner组件配置调度 label 限制和污点容忍，与 Kubernetes master 节点部署一起。")]),s._v(" "),a("p",[s._v("方式三：给 Kubernetes 集群中通过 Taint 方式建立专属的 NeuVector 节点，只允许 Neuvector control 组件部署。")]),s._v(" "),a("p",[s._v("方式四：NeuVector control 组件 (manager,controller）配置调度 label 限制和污点容忍，与 Kubernetes master 节点部署一起。k8s-master 不部署 enforce 和 scanner 组件，意味着 master 节点不在接受扫描和策略下发。")]),s._v(" "),a("p",[s._v("以方式二为例，进行部署")]),s._v(" "),a("p",[s._v("给 master 节点打上特定标签")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl label nodes nodename "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nvcontroller")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("获取节点 Taint")]),s._v(" "),a("div",{staticClass:"language-csharp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" node nodename "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("o yaml"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("grep "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("A "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" taint\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("以 Rancher 部署的节点 master 节点为例")]),s._v(" "),a("div",{staticClass:"language-csharp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[s._v("taints"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" effect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NoSchedule")]),s._v("\n    key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("role"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubernetes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("controlplane")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" effect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NoExecute")]),s._v("\n    key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("role"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubernetes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("编辑部署的 yaml 给 NeuVector-control 组件（manager,controller）添加 nodeSelector 和 tolerations 给 enforce、scanner 组件只添加 tolerations 。")]),s._v(" "),a("p",[s._v("例如以 manager 组件为例：")]),s._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[s._v("kind"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Deployment\nmetadata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pod\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector\nspec"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  selector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    matchLabels"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pod\n  replicas"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    metadata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      labels"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pod\n    spec"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      nodeSelector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        nvcontroller"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("\n      containers"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pod\n          image"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("manager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("preview"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("preview"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n          env"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" CTRL_SERVER_IP\n              value"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("svc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("neuvector\n      restartPolicy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Always\n      tolerations"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" effect"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NoSchedule\n        key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-role.kubernetes.io/controlplane"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("operator")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Equal\n        value"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" effect"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NoExecute\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("operator")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Equal"')]),s._v("\n        key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-role.kubernetes.io/etcd"')]),s._v("\n        value"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("h4",{attrs:{id:"_3-2-数据持久化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-数据持久化"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.2.数据持久化")])]),s._v(" "),a("p",[s._v("配置环境变量启用配置数据持久化")]),s._v(" "),a("div",{staticClass:"language-objectivec line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-objectivec"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CTRL_PERSIST_CONFIG\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("配置此环境变量后，默认情况下 NeuVector-Controller 会将数据存储在 /var/neuvector 目录内，默认此目录是 hostpath 映射在 POD 所在宿主机的 /var/neuvector 目录内。")]),s._v(" "),a("p",[s._v("若需要更高级别数据可靠性也可以通过 PV 对接 nfs 或其他支出多读写的存储中。")]),s._v(" "),a("p",[s._v("这样当出现 NeuVector-Controller 三个 POD 副本同时都销毁，宿主机都完全不可恢复时，也不会有数据配置数据丢失。")]),s._v(" "),a("p",[s._v("以下以 NFS 为例。")]),s._v(" "),a("p",[s._v("部署 nfs")]),s._v(" "),a("p",[s._v("创建 pv 和 pvc")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("cat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EOF")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" kubectl apply "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" PersistentVolume\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("data\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("capacity")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("storage")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("Gi\n  "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("accessModes")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" ReadWriteMany \n  "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("nfs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nfsdata\n    "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("server")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".195")]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EOF")]),s._v("\ncat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EOF")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" kubectl apply "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" PersistentVolumeClaim\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("data\n  "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("accessModes")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" ReadWriteMany\n  "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("requests")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("storage")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("Gi\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EOF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[s._v("修改 NeuVector-Controller 部署 yaml，添加 pvc 信息，将 /var/neuvector 目录映射到 nfs 中（默认是hostpath映射到本地)")]),s._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[s._v("spec"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    spec"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      volumes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nv"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("share\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token expression"}},[s._v("Path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("                        ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// replaced by persistentVolumeClaim")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token expression"}},[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector        ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// replaced by persistentVolumeClaim")])]),s._v("\n          persistentVolumeClaim"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            claimName"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("data\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("或直接在 NeuVector 部署 yaml 中挂载 nfs 目录")]),s._v(" "),a("div",{staticClass:"language-jsx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-jsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nv"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("share\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("nfs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nfs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("server")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.26")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".204")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".144")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"_4-多云安全管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-多云安全管理"}},[s._v("#")]),s._v(" "),a("strong",[s._v("4.多云安全管理")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/19330071-65a25735ed5d7e6f?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("在实际生产应用中，会存在对多个集群进行安全进行管理，NeuVector 支持集群联邦功能。")]),s._v(" "),a("p",[s._v("需要在一个集群上暴露 Federation Master 服务，在每个远端集群上部署 Federation Worker 服务。为了更好的灵活性，可以在每个集群同时启用 Federation Master 和 Federation Worker 服务。")]),s._v(" "),a("p",[s._v("在每个集群部署此 yaml")]),s._v(" "),a("div",{staticClass:"language-tsx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[s._v("apiVersion"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1\nkind"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Service\nmetadata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("service"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fed"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master\n  namespace"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector\nspec"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  ports"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11443")]),s._v("\n    name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" fed\n    nodePort"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30627")]),s._v("\n    protocol"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("\n  type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NodePort\n  selector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pod\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\n\napiVersion"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1\nkind"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Service\nmetadata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("service"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fed"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("worker\n  namespace"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector\nspec"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  ports"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10443")]),s._v("\n    name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" fed\n    nodePort"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31783")]),s._v("\n    protocol"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("\n  type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NodePort\n  selector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pod\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[s._v("将其中一个集群升级为主集群")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/19330071-9d6f9fc538a147cc?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("将其中一个集群升级为主集群，配置连接远程暴露 ip 和对 remot cluster 可达的端口。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/19330071-8901d694e4a34491?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp",alt:"img"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/19330071-8a4c3813170b0fdb?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp",alt:"img"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/19330071-8261557aee9ac71d?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("在主集群中，生成 token，用于其他 remote cluster 连接。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/19330071-bfd79abf0e63ade1?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp",alt:"img"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/19330071-44c2f4fb2b1dffab?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("在 remote cluster 中配置加入主集群，配置 token 和连接端子")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/19330071-ce8b84b9c471b939?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp",alt:"img"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/19330071-846442347a420812?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp",alt:"img"}})]),s._v(" "),a("p",[s._v("在界面可以对多个 NeuVector 集群进行管理")]),s._v(" "),a("p",[a("img",{attrs:{src:"https:////upload-images.jianshu.io/upload_images/19330071-a867ab46b459f39b?imageMogr2/auto-orient/strip%7CimageView2/2/w/944/format/webp",alt:"img"}})]),s._v(" "),a("h2",{attrs:{id:"_5-其他配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-其他配置"}},[s._v("#")]),s._v(" "),a("strong",[s._v("5.其他配置")])]),s._v(" "),a("h4",{attrs:{id:"_5-1-升级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-升级"}},[s._v("#")]),s._v(" "),a("strong",[s._v("5.1.升级")])]),s._v(" "),a("p",[s._v("若是采用 yaml 文件方式部署的 NeuVector 直接更新对应的组件镜像 tag 即可完成升级。如")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" imagedeployment/neuvector-controller-podneuvector-controller-pod"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector/controller:2.4.1 -n neuvector\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image -n neuvectords/neuvector-enforcer-pod neuvector-enforcer-pod"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("neuvector/enforcer:2.4.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("若是采用 Helm 部署的 NeuVector，则直接执行 helm update 配置对应参数即可。")]),s._v(" "),a("h4",{attrs:{id:"_5-2-卸载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-卸载"}},[s._v("#")]),s._v(" "),a("strong",[s._v("5.2.卸载")])]),s._v(" "),a("p",[s._v("删除部署的组件")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("kubectl delete "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("raw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("githubusercontent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("manifests"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("docker"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("删除配置的 RBAC")]),s._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" clusterrolebinding  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" grep neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("awk "),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token expression"}},[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")])])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("}'")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("xargs kubectl delete clusterrolebinding\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" rolebinding "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n neuvector "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" grep neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("awk "),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token expression"}},[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")])])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("}'")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("xargs kubectl delete rolebinding "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n neuvector\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("删除对应的 CRD")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("kubectl delete "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f  https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("raw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("githubusercontent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("manifests"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("crd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k8s"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.19")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n\nkubectl delete "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("raw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("githubusercontent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("manifests"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("waf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("crd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k8s"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.19")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n\nkubectl delete "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("raw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("githubusercontent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("neuvector"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("manifests"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("admission"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("crd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k8s"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.19")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("总结：")])]),s._v(" "),a("p",[s._v("SUSE 此次开源的 NeuVector 是一个成熟稳定的容器安全管理平台，未来 NeuVector 会和 Rancher 产品更好地融合。")])])}),[],!1,null,null,null);t.default=r.exports}}]);