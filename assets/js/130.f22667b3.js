(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{601:function(s,t,a){"use strict";a.r(t);var n=a(20),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"_1、前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、前言"}},[s._v("#")]),s._v(" 1、"),a("strong",[s._v("前言")])]),s._v(" "),a("p",[s._v("在使用 Kubernetes 时，可能会遇到一些网络问题。当通过检查配置与日志无法排查错误时，这时就需要抓取网络数据包，但是Pod内一般不会安装"),a("code",[s._v("tcpdump")]),s._v("命令，那有没有方法可以直接通过宿主机抓取Pod网络数据包？")]),s._v(" "),a("p",[s._v("当然有，本文介绍 "),a("code",[s._v("nsenter")]),s._v(" 命令，能够进入Pod容器"),a("code",[s._v("net")]),s._v(" 命名空间。并且本文提供一个快速进入Pod容器 "),a("code",[s._v("net")]),s._v(" 命名空间脚本，方便大家使用。")]),s._v(" "),a("h2",{attrs:{id:"_2、nsenter-使用参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、nsenter-使用参数"}},[s._v("#")]),s._v(" 2、"),a("strong",[s._v("nsenter 使用参数")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("nsenter "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("program "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("arguments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\noptions:\n-t, --target pid：指定被进入命名空间的目标进程的pid\n-m, --mount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("：进入mount命名空间。如果指定了file，则进入file的命名空间\n-u, --uts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("：进入uts命名空间。如果指定了file，则进入file的命名空间\n-i, --ipc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("：进入ipc命名空间。如果指定了file，则进入file的命名空间\n-n, --net"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("：进入net命名空间。如果指定了file，则进入file的命名空间\n-p, --pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("：进入pid命名空间。如果指定了file，则进入file的命名空间\n-U, --user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("：进入user命名空间。如果指定了file，则进入file的命名空间\n-G, --setgid gid：设置运行程序的gid\n-S, --setuid uid：设置运行程序的uid\n-r, --root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("directory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("：设置根目录\n-w, --wd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("directory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("：设置工作目录\n\n如果没有给出program，则默认执行 "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$SHELL")]),s._v("。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("blockquote",[a("p",[s._v("除了进入 "),a("code",[s._v("net")]),s._v(" 命名空间，"),a("code",[s._v("nsenter")]),s._v(" 还可以进入 "),a("code",[s._v("mnt")]),s._v(", "),a("code",[s._v("uts")]),s._v(", "),a("code",[s._v("ipc")]),s._v(", "),a("code",[s._v("pid")]),s._v(", "),a("code",[s._v("user")]),s._v(" 命名空间，以及指定根目录和工作目录。")])]),s._v(" "),a("h2",{attrs:{id:"_3、pod-容器抓包演示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、pod-容器抓包演示"}},[s._v("#")]),s._v(" 3、"),a("strong",[s._v("Pod 容器抓包演示")])]),s._v(" "),a("blockquote",[a("p",[s._v("发现某个服务网络不通，建议把这个服务副本数调为1个Pod，并且找到这个副本Pod所在"),a("code",[s._v("宿主机")]),s._v("和"),a("code",[s._v("Pod名称")]),s._v("。")])]),s._v(" "),a("p",[s._v("查看Pod所在 "),a("code",[s._v("宿主机")]),s._v(" 和 "),a("code",[s._v("Pod名称")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ kubectl get pods -n "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -o wide\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("登陆Pod所在 "),a("code",[s._v("宿主机")]),s._v("，创建一个 "),a("code",[s._v("e_net.sh")]),s._v(" Shell 脚本。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" e_net.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/env bash")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -f  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/docker"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nerdctl -n k8s.io"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n          \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("e_net")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -eu\n  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pod")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("kubectl get pod $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("pod_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" -n $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("namespace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" -o template --template"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{range .status.containerStatuses}}{{.containerID}}{{end}}'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" -F "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $3}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("$command inspect -f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(".State.Pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" $pod"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -e "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[s._v("\\033")]),s._v("[32m Entering pod netns for "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${namespace}")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${pod_name}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[s._v("\\033")]),s._v("[0m"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cmd")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nsenter -n -t '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${pid}")]),s._v('"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -e "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[s._v("\\033")]),s._v("[32m Execute the command: "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${cmd}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[s._v("\\033")]),s._v('[0m"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${cmd}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行函数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pod_name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("\ne_net\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("blockquote",[a("p",[s._v("脚本依赖命令：宿主机上需要已安装 "),a("code",[s._v("kubectl")]),s._v("、"),a("code",[s._v("docker")]),s._v("、"),a("code",[s._v("nsenter")]),s._v("、"),a("code",[s._v("sed")]),s._v("、"),a("code",[s._v("echo")]),s._v(" 命令。")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加脚本执行权限")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x e_net.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("本例抓取 "),a("code",[s._v("test")]),s._v(" 命名空间中 "),a("code",[s._v("demo2-deployment-5f5f4fbd9b-92gd4")]),s._v(" Pod "),a("code",[s._v("8080")]),s._v(" 端口请求包。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入 Pod demo2-deployment-5f5f4fbd9b-92gd4 net 命名空间")]),s._v("\n$ ./e_net.sh demo2-deployment-5f5f4fbd9b-92gd4 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面是脚本执行完输出结果")]),s._v("\n Entering pod netns "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" test/demo2-deployment-5f5f4fbd9b-92gd4\n\n Execute the command: nsenter -n -t "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44762")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("现在使用 "),a("code",[s._v("ip addr")]),s._v(" 或者 "),a("code",[s._v("ifconfig")]),s._v(" 查看，发现网卡配置只有 "),a("code",[s._v("demo2-deployment-5f5f4fbd9b-92gd4")]),s._v("Pod 网卡配置。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lzq70112/images/blog/202206021348194.png",alt:"img"}})]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("tcpdump")]),s._v(" 抓取 "),a("code",[s._v("eth0")]),s._v(" 网卡上 "),a("code",[s._v("80")]),s._v(" 端口 数据包。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ nsenter -t "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("324630")]),s._v(" --net tcpdump -i eth0 port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" -nn   -w dns.pcap\n\ntcpdump: listening on eth0, link-type EN10MB "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", capture size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v(" bytes\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" packets captured\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" packets received by filter\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" packets dropped by kernel\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("下载 "),a("code",[s._v("demo2.pcap")]),s._v(" 到本机，使用 "),a("code",[s._v("wireshark")]),s._v(" 查看包。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lzq70112/images/blog/202206021348162.png",alt:"img"}})]),s._v(" "),a("h2",{attrs:{id:"_4、原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、原理"}},[s._v("#")]),s._v(" 4、"),a("strong",[s._v("原理")])]),s._v(" "),a("p",[a("code",[s._v("namespace")]),s._v(" 是Linux中一些进程属性的作用域，使用命名空间，可以隔离不同的进程。")]),s._v(" "),a("p",[s._v("Linux在不断的添加命名空间，目前有：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("mount")]),s._v("：挂载命名空间，使进程有一个独立的挂载文件系统，始于Linux 2.4.19")]),s._v(" "),a("li",[a("code",[s._v("ipc")]),s._v("：ipc命名空间，使进程有一个独立的ipc，包括"),a("a",{attrs:{href:"https://cloud.tencent.com/product/cmq?from=10680",target:"_blank",rel:"noopener noreferrer"}},[s._v("消息队列"),a("OutboundLink")],1),s._v("，共享内存和信号量，始于Linux 2.6.19")]),s._v(" "),a("li",[a("code",[s._v("uts")]),s._v("：uts命名空间，使进程有一个独立的hostname和domainname，始于Linux 2.6.19")]),s._v(" "),a("li",[a("code",[s._v("net")]),s._v("：network命名空间，使进程有一个独立的网络栈，始于Linux 2.6.24")]),s._v(" "),a("li",[a("code",[s._v("pid")]),s._v("：pid命名空间，使进程有一个独立的pid空间，始于Linux 2.6.24")]),s._v(" "),a("li",[a("code",[s._v("user")]),s._v("：user命名空间，是进程有一个独立的user空间，始于Linux 2.6.23，结束于Linux 3.8")]),s._v(" "),a("li",[a("code",[s._v("cgroup")]),s._v("：cgroup命名空间，使进程有一个独立的cgroup控制组，始于Linux 4.6")])]),s._v(" "),a("p",[s._v("Linux的每个进程都具有命名空间，可以在 "),a("code",[s._v("/proc/PID/ns")]),s._v(" 目录中看到命名空间的文件描述符。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lzq70112/images/blog/202206021348129.png",alt:"img"}})]),s._v(" "),a("h2",{attrs:{id:"_4、nsenter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、nsenter"}},[s._v("#")]),s._v(" 4、"),a("strong",[s._v("nsenter")])]),s._v(" "),a("p",[a("code",[s._v("nsenter")]),s._v(" 命令相当于在setns之上做了一层封装，使我们无需指定命名空间的"),a("code",[s._v("文件描述符")]),s._v("，而是指定"),a("code",[s._v("进程号")]),s._v("即可。")]),s._v(" "),a("p",[s._v("指定"),a("code",[s._v("进程号PID")]),s._v("以及需要进入的"),a("code",[s._v("命名空间")]),s._v("后，"),a("code",[s._v("nsenter")]),s._v("会帮我们找到对应的命名空间文件描述符"),a("code",[s._v("/proc/PID/ns/FD")]),s._v("，然后使用该命名空间运行新的程序。")]),s._v(" "),a("h2",{attrs:{id:"_5、参考链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、参考链接"}},[s._v("#")]),s._v(" 5、"),a("strong",[s._v("参考链接")])]),s._v(" "),a("ul",[a("li",[s._v("https://staight.github.io/2019/09/23/nsenter%E5%91%BD%E4%BB%A4%E7%AE%80%E4%BB%8B/")]),s._v(" "),a("li",[s._v("https://tencentcloudcontainerteam.github.io/tke-handbook/skill/capture-packets-in-container.html")])])])}),[],!1,null,null,null);t.default=e.exports}}]);