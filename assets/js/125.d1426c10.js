(window.webpackJsonp=window.webpackJsonp||[]).push([[125],{596:function(s,t,e){"use strict";e.r(t);var a=e(20),n=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"_1、k8s对临时存储的限制后回收evicted-pod"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、k8s对临时存储的限制后回收evicted-pod"}},[s._v("#")]),s._v(" 1、K8S对临时存储的限制后回收Evicted pod")]),s._v(" "),e("p",[s._v("临时卷 ephemeral volume")]),s._v(" "),e("p",[s._v("节点通常还可以具有本地的临时性存储，由本地挂载的可写入设备或者有时也用 RAM 来提供支持。 “临时（Ephemeral）”意味着对所存储的数据不提供长期可用性的保证。")]),s._v(" "),e("p",[s._v("Pods 通常可以使用临时性本地存储来实现缓冲区、保存日志等功能。 kubelet 可以为使用本地临时存储的 Pods 提供这种存储空间，允许后者使用 "),e("a",{attrs:{href:"https://v1-18.docs.kubernetes.io/zh/docs/concepts/storage/volumes/#emptydir",target:"_blank",rel:"noopener noreferrer"}},[e("code",[s._v("emptyDir")]),e("OutboundLink")],1),s._v(" 类型的 "),e("a",{attrs:{href:"https://v1-18.docs.kubernetes.io/zh/docs/concepts/storage/volumes/",target:"_blank",rel:"noopener noreferrer"}},[s._v("卷"),e("OutboundLink")],1),s._v("将其挂载到容器中。")]),s._v(" "),e("p",[s._v("kubelet 也使用此类存储来保存 "),e("a",{attrs:{href:"https://v1-18.docs.kubernetes.io/zh/docs/concepts/cluster-administration/logging/#logging-at-the-node-level",target:"_blank",rel:"noopener noreferrer"}},[s._v("节点层面的容器日志"),e("OutboundLink")],1),s._v("， 容器镜像文件、以及运行中容器的可写入层")]),s._v(" "),e("p",[s._v("kubelet 会将日志写入到所配置的日志目录（默认为 "),e("code",[s._v("/var/log")]),s._v("）下的文件中； 还会针对其他本地存储的数据使用同一个基础目录（默认为 "),e("code",[s._v("/var/lib/kubelet")]),s._v("）")]),s._v(" "),e("p",[s._v("开启限制")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[s._v("    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("limits")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4"')]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ephemeral-storage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 30Gi\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时存储的大小")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 8Gi\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nvidia.com/gpu")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ephemeral-storage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 30Gi\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 8Gi\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("查看pod被驱逐的信息")]),s._v(" "),e("div",{staticClass:"language-go line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[s._v("status"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  message"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 'Pod ephemeral local storage usage exceeds the total limit of containers\n    20Gi"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" '\n  phase"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Failed\n  reason"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Evicted\n  startTime"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-05-12T09:45:15Z"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lzq70112/images/blog/202205131202818.png",alt:"image-20220513120240319"}})]),s._v(" "),e("h2",{attrs:{id:"_2、开启限制后-出现多个evicted-pod的解决方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、开启限制后-出现多个evicted-pod的解决方法"}},[s._v("#")]),s._v(" 2、开启限制后，出现多个Evicted pod的解决方法")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://kubernetes.io/docs/reference/command-line-tools-reference/kube-controller-manager/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),e("OutboundLink")],1)]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/kubernetes/manifests/kube-controller-manager.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("增加如下配置")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lzq70112/images/blog/202205131203287.png",alt:"image-20220513120301060"}})]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("terminated"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("threshold=5\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 个数 对Evicted 和Successed 的pod进行删除")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);