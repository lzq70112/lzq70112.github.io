(window.webpackJsonp=window.webpackJsonp||[]).push([[182],{652:function(s,a,e){"use strict";e.r(a);var n=e(20),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[e("a",{attrs:{href:"https://docs.ceph.com/en/pacific/install/manual-deployment/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方地址"),e("OutboundLink")],1)]),s._v(" "),e("h2",{attrs:{id:"_1、ceph的资源池作用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、ceph的资源池作用"}},[s._v("#")]),s._v(" 1、ceph的资源池作用")]),s._v(" "),e("p",[s._v("Ceph 架构中，Ceph 客户端是直接读或者写存放在 OSD上的 RADOS 对象存储中的对象（data object）的，因此，Ceph 需要走完 "),e("strong",[s._v("(Pool, Object) → (Pool, PG) → OSD set → OSD/Disk")]),s._v(" 完整的链路，才能让 ceph client 知道目标数据 object的具体位置在哪里：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lzq70112/images/blog/94e0cd5a8c1c4123bc1a640c78a37dd5.png",alt:"RBD 数据写入流程"}})]),s._v(" "),e("h2",{attrs:{id:"_2、创建、查看资源池"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、创建、查看资源池"}},[s._v("#")]),s._v(" 2、创建、查看资源池")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("ceph osd pool create ceph-demo "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建osd池指定pg数和pgp数")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("ceph osd lspools "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看资源池")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1 ceph-demo\n# id 名称\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"_3、创建、修改pg和pgp"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、创建、修改pg和pgp"}},[s._v("#")]),s._v(" 3、创建、修改PG和PGP")]),s._v(" "),e("ul",[e("li",[s._v("PG是指定存储池存储对象的目录有多少个，PGP是存储池PG的OSD分布组合个数")]),s._v(" "),e("li",[s._v("PG的增加会引起PG内的数据进行分裂，分裂到相同的OSD上新生成的PG当中")]),s._v(" "),e("li",[s._v("PGP的增加会引起部分PG的分布进行变化，但是不会引起PG内对象的变动")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("ceph osd pool "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" ceph-demo pg_num "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改pg数")]),s._v("\nceph osd pool "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" ceph-demo pgp_num "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改pgp数")]),s._v("\nceph osd pool get ceph-demo pg_num "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看pg数")]),s._v("\nceph osd pool get ceph-demo size "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看副本数")]),s._v("\nceph osd pool get ceph-demo crush_rule "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看调度算法")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("crush_rule: replicated_rule\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认为复制算法")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"_3、rbd创建和使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、rbd创建和使用"}},[s._v("#")]),s._v(" 3、RBD创建和使用")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("rbd create -p ceph-demo --image rbd-demo.img --size 2G\nrbd create  ceph-demo/rbd-demo-1.img --size 2G\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 两种方式都是创建RBD的方式")]),s._v("\nrbd "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("  ceph-demo/rbd-demo-1.img  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除rbd")]),s._v("\nrbd -p ceph-demo "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#验证是否创建")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("rbd-demo-1.img\nrbd-demo.img\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("rbd info  ceph-demo/rbd-demo-1.img "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看RBD信息")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("rbd image "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbd-demo-1.img'")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n        size "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" GiB "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v(" objects\n        order "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" MiB objects"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        snapshot_count: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        id: 3873135bd549\n        block_name_prefix: rbd_data.3873135bd549\n        format: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n        features: layering, exclusive-lock, object-map, fast-diff, deep-flatten\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# centos7只支持layering的特性")]),s._v("\n        op_features: \n        flags: \n        create_timestamp: Sun Oct "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":10:16 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("\n        access_timestamp: Sun Oct "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":10:16 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("\n        modify_timestamp: Sun Oct "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":10:16 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("p",[s._v("注意："),e("strong",[s._v("以上centos7只支持layering的特性，我们需要删除其他特性")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("rbd feature disable ceph-demo/rbd-demo.img exclusive-lock\nrbd feature disable ceph-demo/rbd-demo.img object-map\nrbd feature disable ceph-demo/rbd-demo.img fast-diff\nrbd feature disable ceph-demo/rbd-demo.img deep-flatten\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("rbd map  ceph-demo/rbd-demo.img "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#测试挂载")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/dev/rbd0\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("rbd device list "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看镜像挂载块情况")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("id pool      namespace image        snap device    \n0  ceph-demo           rbd-demo.img -    /dev/rbd0 \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("此时我们得到了一个块设备，可以通过格式化来使用块设备")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("mkfs.ext4 /dev/rbd0 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#格式化")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mke2fs")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.42")]),s._v(".9 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v("-Dec-2013"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nDiscarding device blocks: 完成                            \n文件系统标签"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nOS type: Linux\n块大小"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("log"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n分块大小"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("log"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Stride")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" blocks, Stripe "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("width")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" blocks\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v(" inodes, "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("524288")]),s._v(" blocks\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("26214")]),s._v(" blocks "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.00")]),s._v("%"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" reserved "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the super user\n第一个数据块"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nMaximum filesystem "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("blocks")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("536870912")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" block "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("groups")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768")]),s._v(" blocks per group, "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768")]),s._v(" fragments per group\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v(" inodes per group\nSuperblock backups stored on blocks: \n        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("98304")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("163840")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("229376")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("294912")]),s._v("\n\nAllocating group tables: 完成                            \n正在写入inode表: 完成                            \nCreating journal "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v(" blocks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": 完成\nWriting superblocks and filesystem accounting information: 完成 \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /mnt/rbd-demo \n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" /dev/rbd0 /mnt/rbd-demo\n "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" -Th "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看挂载")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("文件系统                类型      容量  已用  可用 已用% 挂载点\ndevtmpfs                devtmpfs  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev\ntmpfs                   tmpfs     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev/shm\ntmpfs                   tmpfs     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G   12M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /run\ntmpfs                   tmpfs     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /sys/fs/cgroup\n/dev/mapper/centos-root xfs        33G  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".0G   31G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("% /\n/dev/sda1               xfs       197M  160M   37M   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("82")]),s._v("% /boot\ntmpfs                   tmpfs     378M     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  378M    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /run/user/0\ntmpfs                   tmpfs     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G   52K  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /var/lib/ceph/osd/ceph-0\n/dev/rbd0               ext4      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".0G  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".0M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /mnt/rbd-demo\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("h2",{attrs:{id:"_4、块存储的扩容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、块存储的扩容"}},[s._v("#")]),s._v(" 4、块存储的扩容")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v(" rbd resize  ceph-demo/rbd-demo.img --size 4G"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#扩容")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v(" rbd info  ceph-demo/rbd-demo.img "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看RBD扩容信息")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("rbd image 'rbd-demo.img':\n        size 4 GiB in 1024 objects\n        order 22 (4 MiB objects)\n        snapshot_count: 0\n        id: 386a45ee6679\n        block_name_prefix: rbd_data.386a45ee6679\n        format: 2\n        features: layering\n        op_features: \n        flags: \n        create_timestamp: Sun Oct 31 11:09:06 2021\n        access_timestamp: Sun Oct 31 11:09:06 2021\n        modify_timestamp: Sun Oct 31 11:09:06 2021     \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("RBD的块已经被扩容到4G，fdisk系统查看块设备的扩容")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("fdisk")]),s._v(" -l "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看分区")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("磁盘 /dev/sda：37.6 GB, 37580963840 字节，73400320 个扇区\nUnits = 扇区 of 1 * 512 = 512 bytes\n扇区大小(逻辑/物理)：512 字节 / 512 字节\nI/O 大小(最小/最佳)：512 字节 / 512 字节\n磁盘标签类型：dos\n磁盘标识符：0x000d37ca\n\n   设备 Boot      Start         End      Blocks   Id  System\n/dev/sda1   *        2048      411647      204800   83  Linux\n/dev/sda2          411648    73400319    36494336   8e  Linux LVM\n\n磁盘 /dev/sdb：21.5 GB, 21474836480 字节，41943040 个扇区\nUnits = 扇区 of 1 * 512 = 512 bytes\n扇区大小(逻辑/物理)：512 字节 / 512 字节\nI/O 大小(最小/最佳)：512 字节 / 512 字节\n\n\n磁盘 /dev/mapper/centos-root：35.2 GB, 35219570688 字节，68788224 个扇区\nUnits = 扇区 of 1 * 512 = 512 bytes\n扇区大小(逻辑/物理)：512 字节 / 512 字节\nI/O 大小(最小/最佳)：512 字节 / 512 字节\n\n\n磁盘 /dev/mapper/centos-swap：2147 MB, 2147483648 字节，4194304 个扇区\nUnits = 扇区 of 1 * 512 = 512 bytes\n扇区大小(逻辑/物理)：512 字节 / 512 字节\nI/O 大小(最小/最佳)：512 字节 / 512 字节\n\n\n磁盘 /dev/mapper/ceph--81838bff--e7a2--4188--85b3--6db72c15bb04-osd--block--f0a158bf--a59f--4f78--abd9--c6fe695248ff：21.5 GB, 21470642176 字节，41934848 个扇区\nUnits = 扇区 of 1 * 512 = 512 bytes\n扇区大小(逻辑/物理)：512 字节 / 512 字节\nI/O 大小(最小/最佳)：512 字节 / 512 字节\n\n\n磁盘 /dev/rbd0：4294 MB, 4294967296 字节，8388608 个扇区\nUnits = 扇区 of 1 * 512 = 512 bytes\n扇区大小(逻辑/物理)：512 字节 / 512 字节\nI/O 大小(最小/最佳)：4194304 字节 / 4194304 字节\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br")])]),e("p",[s._v("继续查看文件系统扩容")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" -Th "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件系统并没有扩容")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("文件系统                类型      容量  已用  可用 已用% 挂载点\ndevtmpfs                devtmpfs  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev\ntmpfs                   tmpfs     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev/shm\ntmpfs                   tmpfs     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G   12M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /run\ntmpfs                   tmpfs     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /sys/fs/cgroup\n/dev/mapper/centos-root xfs        33G  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".0G   31G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("% /\n/dev/sda1               xfs       197M  160M   37M   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("82")]),s._v("% /boot\ntmpfs                   tmpfs     378M     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  378M    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /run/user/0\ntmpfs                   tmpfs     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G   52K  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /var/lib/ceph/osd/ceph-0\n/dev/rbd0               ext4      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".0G  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".0M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /mnt/rbd-demo\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此处应该为4G")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("我们发现上面文件系统并没有扩容")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("resize2fs /dev/rbd0 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#我们需要手动文件系统进行扩容")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("resize2fs 1.42.9 (28-Dec-2013)\nFilesystem at /dev/rbd0 is mounted on /mnt/rbd-demo; on-line resizing required\nold_desc_blocks = 1, new_desc_blocks = 1\nThe filesystem on /dev/rbd0 is now 1048576 blocks long.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" -Th "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#扩容查看")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("文件系统                类型      容量  已用  可用 已用% 挂载点\ndevtmpfs                devtmpfs  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev\ntmpfs                   tmpfs     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev/shm\ntmpfs                   tmpfs     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G   12M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /run\ntmpfs                   tmpfs     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /sys/fs/cgroup\n/dev/mapper/centos-root xfs        33G  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".0G   31G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("% /\n/dev/sda1               xfs       197M  160M   37M   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("82")]),s._v("% /boot\ntmpfs                   tmpfs     378M     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  378M    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /run/user/0\ntmpfs                   tmpfs     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G   52K  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /var/lib/ceph/osd/ceph-0\n/dev/rbd0               ext4      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".9G  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".0M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".7G    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /mnt/rbd-demo\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 已经扩容了")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h2",{attrs:{id:"_5、查看存储数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、查看存储数据"}},[s._v("#")]),s._v(" 5、查看存储数据")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v(" rbd info  ceph-demo/rbd-demo.img "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看RBD扩容信息")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("rbd image "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbd-demo.img'")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n        size "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" GiB "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" objects\n        order "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" MiB objects"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        snapshot_count: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        id: 386a45ee6679\n        block_name_prefix: rbd_data.386a45ee6679\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前缀文件名")]),s._v("\n        format: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n        features: layering\n        op_features: \n        flags: \n        create_timestamp: Sun Oct "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":09:06 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("\n        access_timestamp: Sun Oct "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":09:06 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("\n        modify_timestamp: Sun Oct "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":09:06 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("    \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("rados -p ceph-demo "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" rbd_data.386a45ee6679 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看ceph-demo资源池的块数据对象")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lzq70112/images/blog/image-20211107105159022.png",alt:"image-20211107105159022"}})]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v(" rados -p ceph-demo "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("stat")]),s._v(" rbd_data.386a45ee6679.000000000000010f "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看对象大小")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ceph-demo/rbd_data.386a45ee6679.000000000000010f mtime 2021-10-31 11:30:38.000000, size 4194304\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("up ceph osd map ceph-demo rbd_data.386a45ee6679.000000000000010f "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看对象由pg(1.10) -> up 到osd 1,0,2")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("osdmap e22 pool 'ceph-demo' (1) object 'rbd_data.386a45ee6679.000000000000010f' -> pg 1.e709f1d0 (1.10) -> up ([1,0,2], p1) acting ([1,0,2], p1)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("ceph osd tree "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看osd树状图")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ID CLASS WEIGHT  TYPE NAME       STATUS REWEIGHT PRI-AFF \n-1       0.03908 root default                            \n-3       0.01949     host ceph-1                         \n 0   hdd 0.01949         osd.0       up  1.00000 1.00000 \n-5       0.00980     host ceph-2                         \n 1   hdd 0.00980         osd.1       up  1.00000 1.00000 \n-7       0.00980     host ceph-3                         \n 2   hdd 0.00980         osd.2       up  1.00000 1.00000 \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("写入数据 测试")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /mnt/rbd-demo/\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("if")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/zero "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("of")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test.img "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bs")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1M "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("count")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("rados -p ceph-demo "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" rbd_data.386a45ee6679 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看对象写入后数量")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("291\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("每个4Mx291 = 1164M")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" -Th "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#已经快/dev/rbd0 ")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("文件系统                类型      容量  已用  可用 已用% 挂载点\ndevtmpfs                devtmpfs  1.9G     0  1.9G    0% /dev\ntmpfs                   tmpfs     1.9G     0  1.9G    0% /dev/shm\ntmpfs                   tmpfs     1.9G   12M  1.9G    1% /run\ntmpfs                   tmpfs     1.9G     0  1.9G    0% /sys/fs/cgroup\n/dev/mapper/centos-root xfs        33G  2.0G   31G    6% /\n/dev/sda1               xfs       197M  160M   37M   82% /boot\ntmpfs                   tmpfs     1.9G   52K  1.9G    1% /var/lib/ceph/osd/ceph-0\n/dev/rbd0               ext4      3.9G  1.1G  2.7G   28% /mnt/rbd-demo\ntmpfs                   tmpfs     378M     0  378M    0% /run/user/0\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("h2",{attrs:{id:"_6、故障排查"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6、故障排查"}},[s._v("#")]),s._v(" 6、故障排查")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v(" ceph health detail "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看健康详情")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("HEALTH_WARN application not enabled on "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" pool"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" mons are allowing insecure global_id reclaim\nPOOL_APP_NOT_ENABLED application not enabled on "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" pool"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    application not enabled on pool "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ceph-demo'")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 未定义接口类型")]),s._v("\n    use "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ceph osd pool application enable <pool-name> <app-name>'")]),s._v(", where "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("app-name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" is "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cephfs'")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbd'")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rgw'")]),s._v(", or freeform "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" custom applications.\nAUTH_INSECURE_GLOBAL_ID_RECLAIM_ALLOWED mons are allowing insecure global_id reclaim\n    mon.ceph-1 has auth_allow_insecure_global_id_reclaim "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" to "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    mon.ceph-2 has auth_allow_insecure_global_id_reclaim "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" to "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    mon.ceph-3 has auth_allow_insecure_global_id_reclaim "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" to "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mon认证告警")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("ceph osd pool application "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" ceph-demo rbd "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#对资源池定义一个种接口方式")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("ceph osd pool application get ceph-demo  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看资源池接口类型")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('{\n    "rbd": {}\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("接下来我们继续看第二个报错")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("ceph config "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" mon auth_allow_insecure_global_id_reclaim "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将不安全的监控认证关闭")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("ceph -s "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最后我们在查看health状态")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("  cluster:\n    id:     ad3d4441-898a-475c-bfe7-ee2fa625e2a0\n    health: HEALTH_OK\n \n  services:\n    mon: 3 daemons, quorum ceph-1,ceph-2,ceph-3 (age 5h)\n    mgr: ceph-1(active, since 6d), standbys: ceph-2, ceph-3\n    osd: 3 osds: 3 up (since 5h), 3 in (since 6d)\n \n  data:\n    pools:   1 pools, 64 pgs\n    objects: 296 objects, 1.1 GiB\n    usage:   6.3 GiB used, 34 GiB / 40 GiB avail\n    pgs:     64 active+clean\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("ceph crash "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#等我们有crash 告警时可以查看到")]),s._v("\nceph crash info xxx "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看crash详情")]),s._v("\nceph crash archive-all "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#打包所有crash包")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);