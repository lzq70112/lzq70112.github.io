(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{584:function(s,t,e){"use strict";e.r(t);var a=e(20),n=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"_1、descheduler背景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、descheduler背景"}},[s._v("#")]),s._v(" 1、descheduler背景")]),s._v(" "),e("p",[s._v("Kubernetes 中的调度是挂起的 Pod 将绑定到节点的过程，由 Kubernetes 的一个组件执行，称为 kube-scheduler。调度程序的决定，无论 Pod 是否可以或不能调度，都由其可配置的策略指导，该策略由一系列规则组成，称为所谓的词和优先级。调度程序的决策受在出现新的 pod 进行调度时对其 Kubernetes 集群的视图的影响。由于 Kubernetes 实时动态，并且它们的状态会随同着时间而变化，出于各种原因，可能希望已经运行的pod移动到其他一些节点：")]),s._v(" "),e("ul",[e("li",[s._v("有一些节点使用不足或使用。")]),s._v(" "),e("li",[s._v("最初的调度不再适用，因为在节点上添加或删除了污点或标签，不再满足 pod/节点亲和性要求。")]),s._v(" "),e("li",[s._v("一些节点出现故障，它们的pod移动到其他节点。")]),s._v(" "),e("li",[s._v("新节点被添加到集群中。")])]),s._v(" "),e("p",[s._v("因此，可能在集群中不太需要节点上安排了多个 pod。调度器根据其策略寻找可以移动的 Pod 调用其回调。请注意，在当前的实现中，调度器不会安排被调用的 pod 的替换，依赖于默认的调度程序。")]),s._v(" "),e("h2",{attrs:{id:"_2、descheduler驱逐策略"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、descheduler驱逐策略"}},[s._v("#")]),s._v(" 2、descheduler驱逐策略")]),s._v(" "),e("p",[s._v("该策略包括适用于所有策略的通用配置")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("name")]),s._v(" "),e("th",[s._v("默认值")]),s._v(" "),e("th",[s._v("描述")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[e("code",[s._v("nodeSelector")])]),s._v(" "),e("td",[e("code",[s._v("nil")])]),s._v(" "),e("td",[s._v("限制处理的节点")])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("evictLocalStoragePods")])]),s._v(" "),e("td",[e("code",[s._v("false")])]),s._v(" "),e("td",[s._v("允许内有本地存储的豆荚")])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("evictSystemCriticalPods")])]),s._v(" "),e("td",[e("code",[s._v("false")])]),s._v(" "),e("td",[s._v("[警告：将盗用 Kubernetes 系统 Pod] 允许带有任何优先级的 Pod，包括像 kube-dns 这样的系统 Pod")])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("ignorePvcPods")])]),s._v(" "),e("td",[e("code",[s._v("false")])]),s._v(" "),e("td",[s._v("PVC pod 设置是否应取消或忽略")])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("maxNoOfPodsToEvictPerNode")])]),s._v(" "),e("td",[e("code",[s._v("nil")])]),s._v(" "),e("td",[s._v("从每个生命周期引发的最大 Pod 数（通过所有策略求和）")])])])]),s._v(" "),e("h3",{attrs:{id:"_2-1、removeduplicates"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1、removeduplicates"}},[s._v("#")]),s._v(" 2.1、RemoveDuplicates")]),s._v(" "),e("p",[s._v("此策略确保关联ReplicaSet（RS）、ReplicationController（RC）、StatefulSet或job的pod，只有一个pod与在同一节点上运行，如果他们是重复的在同一节点则会被驱逐。")]),s._v(" "),e("p",[s._v("例如：如果节点down了，这些节点上的pod被移动到其他节点，导致多个pod与RS或RC关联（例如，在同一节点上运行），则可能会发生此问题。")]),s._v(" "),e("p",[s._v("一旦故障节点再次准备就绪，就可以启用此策略来逐出那些重复的pod。")]),s._v(" "),e("p",[s._v("它提供了一个可选参数"),e("code",[s._v("ExcludeOwnerTypes")]),s._v("，它是OwnerRef种类的列表。如果某个pod将这些类型中的任何一种列为OwnerRef，则该pod将不会被视为驱逐。")]),s._v(" "),e("blockquote",[e("p",[s._v("注意，Deployments创建的POD被认为是此策略的逐出对象。excludeOwnerKinds参数应包括ReplicaSet，排除Deployments创建的POD。")])]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"descheduler/v1alpha1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DeschedulerPolicy"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"RemoveDuplicates"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("params")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n       "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("removeDuplicates")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n         "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("excludeOwnerKinds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n         "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ReplicaSet"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("当前，没有与该策略关联的参数，要禁用该策略，也很简单，只需要配置成 false 即可：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"descheduler/v1alpha1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DeschedulerPolicy"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"RemoveDuplicates"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_2-2、lownodeutilization"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2、lownodeutilization"}},[s._v("#")]),s._v(" 2.2、LowNodeUtilization")]),s._v(" "),e("p",[s._v("该策略查找未充分利用的节点，并从其他节点驱逐 Pod，以便 "),e("code",[s._v("kube-scheudler")]),s._v(" 重新将它们调度到未充分利用的节点上。该策略的参数可以通过字段 "),e("code",[s._v("nodeResourceUtilizationThresholds")]),s._v(" 进行配置。")]),s._v(" "),e("p",[s._v("节点的利用率不足可以通过配置 "),e("code",[s._v("thresholds")]),s._v(" 阈值参数来确定，可以通过 CPU、内存和 Pod 数量的百分比进行配置。如果节点的使用率均低于所有阈值，则认为该节点未充分利用。")]),s._v(" "),e("p",[s._v("此外，还有一个可配置的阈值 "),e("code",[s._v("targetThresholds")]),s._v("，该阈值用于计算可从中驱逐 Pod 的那些潜在节点，对于所有节点 "),e("code",[s._v("thresholds")]),s._v(" 和 "),e("code",[s._v("targetThresholds")]),s._v(" 之间的阈值被认为是合理使用的，不考虑驱逐。"),e("code",[s._v("targetThresholds")]),s._v(" 阈值也可以针对 CPU、内存和 Pod 数量进行配置。"),e("code",[s._v("thresholds")]),s._v(" 和 "),e("code",[s._v("targetThresholds")]),s._v(" 可以根据你的集群需求进行动态调整，如下所示示例：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"descheduler/v1alpha1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DeschedulerPolicy"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"LowNodeUtilization"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("params")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n       "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeResourceUtilizationThresholds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n         "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("thresholds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n           "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"cpu"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n           "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"memory"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n           "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"pods"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n         "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetThresholds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n           "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"cpu"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n           "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"memory"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n           "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"pods"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("p",[s._v("和 "),e("code",[s._v("LowNodeUtilization")]),s._v(" 策略关联的另一个参数是 "),e("code",[s._v("numberOfNodes")]),s._v("，只有当未充分利用的节点数大于该配置值的时候，才可以配置该参数来激活该策略，该参数对于大型集群非常有用，其中有一些节点可能会频繁使用或短期使用不足，默认情况下，"),e("code",[s._v("numberOfNodes")]),s._v(" 为0。")]),s._v(" "),e("h3",{attrs:{id:"_2-3、highnodeutilization"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3、highnodeutilization"}},[s._v("#")]),s._v(" 2.3、HighNodeUtilization")]),s._v(" "),e("p",[s._v("该策略查找未充分利用的节点，并从节点中逐出POD，希望这些POD将被紧凑地调度到更少的节点中。此策略与节点自动缩放结合使用，旨在帮助触发未充分利用的节点的向下缩放。此策略必须与调度程序策略"),e("code",[s._v("MostRequestedPriority")]),s._v("一起使用。此策略的参数在"),e("code",[s._v("nodeResourceUtilizationThresholds")]),s._v("下配置。")]),s._v(" "),e("p",[s._v("节点利用率不足由可配置的阈值确定。可以根据百分比为cpu、内存、POD数量和扩展资源配置阈值。百分比计算为节点上请求的当前资源与可分配的总资源之比。对于pod，这意味着节点上的pod数量是该节点pod容量集的一部分。")]),s._v(" "),e("p",[s._v("如果一个节点的使用率低于所有节点的阈值（cpu、内存、POD数量和扩展资源），则该节点被视为未充分利用。目前，pods请求资源需求被考虑用于计算节点资源利用率。任何高于阈值的节点都被认为是适当利用的，不考虑逐出。")]),s._v(" "),e("p",[s._v("thresholds参数可以根据您的集群需求进行调整。")]),s._v(" "),e("blockquote",[e("p",[s._v("请注意，此策略将POD从未充分利用的节点（使用率低于阈值的节点）中逐出，以便可以在适当利用的节点中重新创建POD。")])]),s._v(" "),e("p",[s._v("如果任何未充分利用的节点数或适当利用的节点数为零，该策略将中止。")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"descheduler/v1alpha1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DeschedulerPolicy"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"HighNodeUtilization"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("params")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n       "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeResourceUtilizationThresholds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n         "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("thresholds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n           "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"cpu"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n           "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"memory"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n           "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"pods"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h3",{attrs:{id:"_2-4、removepodsviolatinginterpodantiaffinity"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-4、removepodsviolatinginterpodantiaffinity"}},[s._v("#")]),s._v(" 2.4、RemovePodsViolatingInterPodAntiAffinity")]),s._v(" "),e("p",[s._v("该策略可以确保从节点中删除违反 Pod 反亲和性的 Pod。比如某个节点上有 "),e("code",[s._v("podA")]),s._v(" 这个 Pod，并且 "),e("code",[s._v("podB")]),s._v(" 和 "),e("code",[s._v("podC")]),s._v("（在同一个节点上运行）具有禁止它们在同一个节点上运行的反亲和性规则，则 "),e("code",[s._v("podA")]),s._v(" 将被从该节点上驱逐，以便 "),e("code",[s._v("podB")]),s._v(" 和 "),e("code",[s._v("podC")]),s._v(" 运行正常运行。当 "),e("code",[s._v("podB")]),s._v(" 和 "),e("code",[s._v("podC")]),s._v(" 已经运行在节点上后，反亲和性规则被创建就会发送这样的问题，目前没有和该策略相关联的配置参数，要禁用该策略，同样配置成 false 即可：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"descheduler/v1alpha1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DeschedulerPolicy"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"RemovePodsViolatingInterPodAntiAffinity"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_2-5、removepodsviolatingnodeaffinity"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5、removepodsviolatingnodeaffinity"}},[s._v("#")]),s._v(" 2.5、RemovePodsViolatingNodeAffinity")]),s._v(" "),e("p",[s._v("该策略确保从节点中删除违反节点亲和性的 Pod。比如名为 "),e("code",[s._v("podA")]),s._v(" 的 Pod 被调度到了节点 "),e("code",[s._v("nodeA")]),s._v("，"),e("code",[s._v("podA")]),s._v(" 在调度的时候满足了节点亲和性规则 "),e("code",[s._v("requiredDuringSchedulingIgnoredDuringExecution")]),s._v("，但是随着时间的推移，节点 "),e("code",[s._v("nodeA")]),s._v(" 不再满足该规则了，那么如果另一个满足节点亲和性规则的节点 "),e("code",[s._v("nodeB")]),s._v(" 可用，则 "),e("code",[s._v("podA")]),s._v(" 将被从节点 "),e("code",[s._v("nodeA")]),s._v(" 驱逐，如下所示的策略配置示例：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"descheduler/v1alpha1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DeschedulerPolicy"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"RemovePodsViolatingNodeAffinity"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("params")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeAffinityType")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"requiredDuringSchedulingIgnoredDuringExecution"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h3",{attrs:{id:"_2-6、removepodsviolatingnodetaints"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6、removepodsviolatingnodetaints"}},[s._v("#")]),s._v(" 2.6、RemovePodsViolatingNodeTaints")]),s._v(" "),e("p",[s._v("该策略可以确保从节点中删除违反 "),e("code",[s._v("NoSchedule")]),s._v(" 污点的 Pod。比如有一个名为 "),e("code",[s._v("podA")]),s._v(" 的 Pod，通过配置容忍 "),e("code",[s._v("key=value:NoSchedule")]),s._v(" 允许被调度到有该污点配置的节点上，如果节点的污点随后被更新或者删除了，则污点将不再被 Pods 的容忍满足，然后将被驱逐，如下所示配置策略：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"descheduler/v1alpha1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DeschedulerPolicy"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"RemovePodsViolatingNodeTaints"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_2-7、removepodsviolatingtopologyspreadconstraint"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-7、removepodsviolatingtopologyspreadconstraint"}},[s._v("#")]),s._v(" 2.7、RemovePodsViolatingTopologySpreadConstraint")]),s._v(" "),e("p",[s._v("此策略确保从节点中逐出违反拓扑扩展约束的POD。具体地说，它尝试将平衡拓扑域所需的最小POD数逐出到每个约束的maxSkew内。此策略至少需要k8s版本1.18。")]),s._v(" "),e("p",[s._v("默认情况下，此策略仅处理硬约束，将参数includeSoftConstraints设置为true将包括软约束。")]),s._v(" "),e("p",[s._v("平衡拓扑域时不使用策略参数labelSelector，仅在逐出期间应用，以确定是否可以逐出pod。")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"descheduler/v1alpha1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DeschedulerPolicy"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"RemovePodsViolatingTopologySpreadConstraint"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("params")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n       "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("includeSoftConstraints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"_2-8、removepodshavingtoomanyrestarts"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-8、removepodshavingtoomanyrestarts"}},[s._v("#")]),s._v(" 2.8、RemovePodsHavingTooManyRestarts")]),s._v(" "),e("p",[s._v("此策略确保从节点中删除重启次数过多的POD。例如，一个带有EBS/PD的pod无法将卷/磁盘连接到实例，那么该pod应该重新调度到其他节点。它的参数包括podRestartThreshold，它是pod应该被逐出的重启次数（在所有符合条件的容器上求和），以及includingInitContainers，它确定是否应该在该计算中考虑初始化容器重启。")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"descheduler/v1alpha1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DeschedulerPolicy"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"RemovePodsHavingTooManyRestarts"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("params")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n       "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("podsHavingTooManyRestarts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n         "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("podRestartThreshold")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n         "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("includingInitContainers")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h3",{attrs:{id:"_2-9、podlifetime"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-9、podlifetime"}},[s._v("#")]),s._v(" 2.9、PodLifeTime")]),s._v(" "),e("p",[s._v("此策略将驱逐比"),e("code",[s._v("maxPodLifeTimeSeconds")]),s._v("早的POD。")]),s._v(" "),e("p",[s._v("您还可以指定podStatusPhases以仅收回具有特定StatusPhases的pod，当前此参数仅限于Running和Pending。")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("apiVersion: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"descheduler/v1alpha1"')]),s._v("\nkind: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DeschedulerPolicy"')]),s._v("\nstrategies:\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PodLifeTime"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n     enabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n     params:\n       podLifeTime:\n         maxPodLifeTimeSeconds: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v("\n         podStatusPhases:\n         - "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Pending"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("h3",{attrs:{id:"_2-10、removefailedpods"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-10、removefailedpods"}},[s._v("#")]),s._v(" 2.10、RemoveFailedPods")]),s._v(" "),e("p",[s._v("此策略将驱逐处于失败状态阶段的POD。您可以提供可选参数以按失败原因进行筛选。通过将可选参数"),e("code",[s._v("includingInitContainers")]),s._v("设置为true，可以将原因扩展为包括InitContainers的原因。您可以指定一个可选参数minPodLifeTimeSeconds，以收回早于指定秒数的pod。最后，您可以指定可选参数"),e("code",[s._v("ExcludeOwnerTypes")]),s._v("，如果某个pod将这些类型中的任何一种列为"),e("code",[s._v("OwnerRef")]),s._v("，则该pod将不会被考虑逐出。")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"descheduler/v1alpha1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DeschedulerPolicy"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"RemoveFailedPods"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("params")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n       "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("failedPods")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n         "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("reasons")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n         "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NodeAffinity"')]),s._v("\n         "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("includingInitContainers")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n         "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("excludeOwnerKinds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n         "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Job"')]),s._v("\n         "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("minPodLifeTimeSeconds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("h2",{attrs:{id:"_3、针对资源过滤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、针对资源过滤"}},[s._v("#")]),s._v(" 3、针对资源过滤")]),s._v(" "),e("h3",{attrs:{id:"_3-1、namespace过滤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1、namespace过滤"}},[s._v("#")]),s._v(" 3.1、Namespace过滤")]),s._v(" "),e("p",[s._v("以下策略接受一个namespaces参数，该参数允许指定包含.")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("PodLifeTime")])]),s._v(" "),e("li",[e("code",[s._v("RemovePodsHavingTooManyRestarts")])]),s._v(" "),e("li",[e("code",[s._v("RemovePodsViolatingNodeTaints")])]),s._v(" "),e("li",[e("code",[s._v("RemovePodsViolatingNodeAffinity")])]),s._v(" "),e("li",[e("code",[s._v("RemovePodsViolatingInterPodAntiAffinity")])]),s._v(" "),e("li",[e("code",[s._v("RemoveDuplicates")])]),s._v(" "),e("li",[e("code",[s._v("RemovePodsViolatingTopologySpreadConstraint")])]),s._v(" "),e("li",[e("code",[s._v("RemoveFailedPods")])])]),s._v(" "),e("p",[s._v("示例")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"descheduler/v1alpha1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DeschedulerPolicy"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"PodLifeTime"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("params")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("podLifeTime")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maxPodLifeTimeSeconds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespaces")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("include")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"namespace1"')]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"namespace2"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("不包括")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"descheduler/v1alpha1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DeschedulerPolicy"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"PodLifeTime"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("params")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("podLifeTime")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maxPodLifeTimeSeconds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespaces")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exclude")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"namespace1"')]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"namespace2"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h3",{attrs:{id:"_3-2、priority过滤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2、priority过滤"}},[s._v("#")]),s._v(" 3.2、Priority过滤")]),s._v(" "),e("p",[s._v("所有策略都可以配置优先级阈值，只有低于阈值的 pod 才能被驱逐。您可以通过设置"),e("code",[s._v("thresholdPriorityClassName")]),s._v("（将阈值设置为给定优先级类的值）或"),e("code",[s._v("thresholdPriority")]),s._v("（直接设置阈值）参数来指定此阈值。默认情况下，此阈值设置为"),e("code",[s._v("system-cluster-critical")]),s._v("优先级的值。")]),s._v(" "),e("p",[s._v("注意：设置"),e("code",[s._v("evictSystemCriticalPods")]),s._v("为 true 会完全禁用优先级过滤。")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"descheduler/v1alpha1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DeschedulerPolicy"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"PodLifeTime"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("params")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("podLifeTime")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maxPodLifeTimeSeconds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("thresholdPriority")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h3",{attrs:{id:"_3-3、label-过滤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3、label-过滤"}},[s._v("#")]),s._v(" 3.3、Label 过滤")]),s._v(" "),e("p",[s._v("策略包括")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("PodLifeTime")])]),s._v(" "),e("li",[e("code",[s._v("RemovePodsHavingTooManyRestarts")])]),s._v(" "),e("li",[e("code",[s._v("RemovePodsViolatingNodeTaints")])]),s._v(" "),e("li",[e("code",[s._v("RemovePodsViolatingNodeAffinity")])]),s._v(" "),e("li",[e("code",[s._v("RemovePodsViolatingInterPodAntiAffinity")])]),s._v(" "),e("li",[e("code",[s._v("RemovePodsViolatingTopologySpreadConstraint")])]),s._v(" "),e("li",[e("code",[s._v("RemoveFailedPods")])])]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"descheduler/v1alpha1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DeschedulerPolicy"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"PodLifeTime"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("params")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("podLifeTime")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maxPodLifeTimeSeconds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labelSelector")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("component")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchExpressions")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tier"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("operator")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" In"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("values")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("cache"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" environment"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("operator")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NotIn"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("values")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dev"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("h3",{attrs:{id:"_3-4、node-fit-过滤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-4、node-fit-过滤"}},[s._v("#")]),s._v(" 3.4、node Fit 过滤")]),s._v(" "),e("p",[s._v("以下策略接受"),e("code",[s._v("nodeFit")]),s._v("可以优化调度的布尔参数")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("RemoveDuplicates")])]),s._v(" "),e("li",[e("code",[s._v("LowNodeUtilization")])]),s._v(" "),e("li",[e("code",[s._v("HighNodeUtilization")])]),s._v(" "),e("li",[e("code",[s._v("RemovePodsViolatingInterPodAntiAffinity")])]),s._v(" "),e("li",[e("code",[s._v("RemovePodsViolatingNodeAffinity")])]),s._v(" "),e("li",[e("code",[s._v("RemovePodsViolatingNodeTaints")])]),s._v(" "),e("li",[e("code",[s._v("RemovePodsViolatingTopologySpreadConstraint")])]),s._v(" "),e("li",[e("code",[s._v("RemovePodsHavingTooManyRestarts")])]),s._v(" "),e("li",[e("code",[s._v("RemoveFailedPods")])])]),s._v(" "),e("p",[s._v("如果设置为"),e("code",[s._v("true")]),s._v("descheduler 将考虑满足驱逐标准的 pod 是否适合其他节点，然后再驱逐它们。如果一个 Pod 不能被重新调度到另一个节点，它不会被驱逐。目前，在设置"),e("code",[s._v("nodeFit")]),s._v("为时考虑以下标准"),e("code",[s._v("true")]),s._v("：")]),s._v(" "),e("ul",[e("li",[s._v("一个"),e("code",[s._v("nodeSelector")]),s._v("的pod")]),s._v(" "),e("li",[s._v("任何"),e("code",[s._v("Tolerations")]),s._v("对pod和任何"),e("code",[s._v("Taints")]),s._v("其他节点上")]),s._v(" "),e("li",[e("code",[s._v("nodeAffinity")]),s._v(" 在pod上")]),s._v(" "),e("li",[s._v("是否有任何其他节点被标记为 "),e("code",[s._v("unschedulable")])])]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"descheduler/v1alpha1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DeschedulerPolicy"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"LowNodeUtilization"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("params")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n       "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeResourceUtilizationThresholds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n         "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("thresholds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n           "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"cpu"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n           "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"memory"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n           "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"pods"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n         "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetThresholds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n           "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"cpu"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n           "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"memory"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n           "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"pods"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("h2",{attrs:{id:"_4、pod驱逐的原则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、pod驱逐的原则"}},[s._v("#")]),s._v(" 4、pod驱逐的原则")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://kubernetes.io/docs/tasks/administer-cluster/guaranteed-scheduling-critical-addon-pods/",target:"_blank",rel:"noopener noreferrer"}},[s._v("关键 pod"),e("OutboundLink")],1),s._v("（将 priorityClassName 设置为 system-cluster-critical 或 system-node-critical）永远不会被驱逐（除非"),e("code",[s._v("evictSystemCriticalPods: true")]),s._v("已设置）。")]),s._v(" "),e("li",[s._v("不属于 ReplicationController、ReplicaSet(Deployment)、StatefulSet 或 Job 的 Pod（静态或镜像 Pod 或独立 Pod）永远不会被驱逐，因为这些 Pod 不会被重新创建。")]),s._v(" "),e("li",[s._v("与 DaemonSet 关联的 Pod 永远不会被驱逐。")]),s._v(" "),e("li",[s._v("具有本地存储的 Pod 永远不会被驱逐（除非"),e("code",[s._v("evictLocalStoragePods: true")]),s._v("已设置）。")]),s._v(" "),e("li",[s._v("带有 PVC 的 Pod 被驱逐（除非"),e("code",[s._v("ignorePvcPods: true")]),s._v("设置）。")]),s._v(" "),e("li",[s._v("在"),e("code",[s._v("LowNodeUtilization")]),s._v("和 中"),e("code",[s._v("RemovePodsViolatingInterPodAntiAffinity")]),s._v("，pod 会按优先级从低到高逐出，如果它们具有相同的优先级，则尽力而为的 pod 会在可爆裂和有保证的 pod 之前被逐出。")]),s._v(" "),e("li",[s._v("带有注释的所有类型的 pod"),e("code",[s._v("descheduler.alpha.kubernetes.io/evict")]),s._v("都有资格被驱逐。此注释用于覆盖防止驱逐的检查，用户可以选择驱逐哪个 pod。用户应该知道如何以及是否会重新创建 pod。")]),s._v(" "),e("li",[s._v("默认情况下不会驱逐具有非 nil DeletionTimestamp 的 Pod。")])]),s._v(" "),e("h2",{attrs:{id:"_5、安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、安装"}},[s._v("#")]),s._v(" 5、安装")]),s._v(" "),e("h3",{attrs:{id:"_5-1、安装metrics-server"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-1、安装metrics-server"}},[s._v("#")]),s._v(" 5.1、安装metrics-server")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("https://github.com/kubernetes-sigs/metrics-server/archive/v0.3.6.tar.gz\ntar -zxvf v0.3.6.tar.gz\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("修改Metrics-Server配置文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cd metrics-server-0.3.6/deploy/1.8+/\nvim metrics-server-deployment.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("vim metrics-server-deployment.yaml文件")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ServiceAccount\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" metrics"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" metrics"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s-app")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" metrics"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s-app")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" metrics"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" metrics"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("k8s-app")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" metrics"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceAccountName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" metrics"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount in tmp so we can safely use from-scratch images and/or read-only containers")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tmp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dir\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("emptyDir")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" metrics"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改image 和 imagePullPolicy")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mirrorgooglecontainers/metrics"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("amd64"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v0.3.6\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新增command配置")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /metrics"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("kubelet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("insecure"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("tls\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("kubelet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("preferred"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("address"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("types=InternalDNS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("InternalIP"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ExternalDNS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ExternalIP"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("Hostname\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tmp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dir\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /tmp\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新增resources配置")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("limits")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 300m\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 200Mi\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 200m\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 100Mi　　\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br")])]),e("p",[s._v("安装Metrics-Server")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("kubectl apply -f metrics-server-0.3.6/deploy/1.8+/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("测试")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("kubectl get --raw "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/apis/metrics.k8s.io/v1beta1/pods"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jq\nkubectl "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" nodes\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_5-2、安装descheduler"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-2、安装descheduler"}},[s._v("#")]),s._v(" 5.2、安装descheduler")]),s._v(" "),e("p",[s._v("添加仓库")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("helm repo "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" descheduler https://kubernetes-sigs.github.io/descheduler/\nhelm "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" my-release --namespace kube-system descheduler/descheduler\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("介绍")]),s._v(" "),e("p",[s._v("此图表使用"),e("a",{attrs:{href:"https://helm.sh/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Helm"),e("OutboundLink")],1),s._v("包管理器在"),e("a",{attrs:{href:"http://kubernetes.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Kubernetes"),e("OutboundLink")],1),s._v("集群上引导"),e("a",{attrs:{href:"https://github.com/kubernetes-sigs/descheduler/",target:"_blank",rel:"noopener noreferrer"}},[s._v("调度程序"),e("OutboundLink")],1),s._v("cron 作业。")]),s._v(" "),e("p",[s._v("先决条件")]),s._v(" "),e("ul",[e("li",[s._v("Kubernetes 1.14+")])]),s._v(" "),e("p",[s._v("helm安装")]),s._v(" "),e("p",[s._v("要使用发行版名称安装helm"),e("code",[s._v("my-release")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("helm "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --namespace kube-system my-release descheduler/descheduler\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("该命令以默认配置在 Kubernetes 集群上部署"),e("em",[s._v("descheduler")]),s._v("。这配置 部分列出了可以在安装过程中配置的参数。")]),s._v(" "),e("blockquote",[e("p",[e("strong",[s._v("提示")]),s._v("：列出所有版本使用"),e("code",[s._v("helm list")])])]),s._v(" "),e("p",[e("strong",[s._v("helm卸载")])]),s._v(" "),e("p",[s._v("要卸载/删除"),e("code",[s._v("my-release")]),s._v("部署：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("helm delete my-release\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("该命令删除与图表关联的所有 Kubernetes 组件并删除发布。")]),s._v(" "),e("p",[e("strong",[s._v("配置参数")])]),s._v(" "),e("p",[s._v("下表列出了"),e("em",[s._v("调度器")]),s._v("图表的可配置参数及其默认值。")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("范围")]),s._v(" "),e("th",{staticStyle:{"text-align":"center"}},[s._v("描述")]),s._v(" "),e("th",[s._v("默认")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[e("code",[s._v("kind")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("用作 CronJob 或部署")]),s._v(" "),e("td",[e("code",[s._v("CronJob")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("image.repository")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("要使用的 Docker 存储库")]),s._v(" "),e("td",[e("code",[s._v("k8s.gcr.io/descheduler/descheduler")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("image.tag")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("要使用的 Docker 标签")]),s._v(" "),e("td",[e("code",[s._v("v[chart appVersion]")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("image.pullPolicy")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("Docker 镜像拉取策略")]),s._v(" "),e("td",[e("code",[s._v("IfNotPresent")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("imagePullSecrets")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("Docker 存储库的秘密")]),s._v(" "),e("td",[e("code",[s._v("[]")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("nameOverride")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("部分覆盖"),e("code",[s._v("descheduler.fullname")]),s._v("模板的字符串（将添加发布名称）")]),s._v(" "),e("td",[e("code",[s._v('""')])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("fullnameOverride")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("完全覆盖"),e("code",[s._v("descheduler.fullname")]),s._v("模板的字符串")]),s._v(" "),e("td",[e("code",[s._v('""')])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("cronJobApiVersion")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("CronJob API 组版本")]),s._v(" "),e("td",[e("code",[s._v('"batch/v1"')])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("schedule")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("这个cron时间表运行"),e("em",[s._v("descheduler")]),s._v("上工作")]),s._v(" "),e("td",[e("code",[s._v('"*/2 * * * *"')])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("startingDeadlineSeconds")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("如果设置，"),e("code",[s._v("startingDeadlineSeconds")]),s._v("则为"),e("em",[s._v("调度程序")]),s._v("作业配置")]),s._v(" "),e("td",[e("code",[s._v("nil")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("successfulJobsHistoryLimit")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("如果设置，"),e("code",[s._v("successfulJobsHistoryLimit")]),s._v("则为"),e("em",[s._v("调度程序")]),s._v("作业配置")]),s._v(" "),e("td",[e("code",[s._v("nil")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("failedJobsHistoryLimit")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("如果设置，"),e("code",[s._v("failedJobsHistoryLimit")]),s._v("则为"),e("em",[s._v("调度程序")]),s._v("作业配置")]),s._v(" "),e("td",[e("code",[s._v("nil")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("deschedulingInterval")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("如果使用 kind:Deployment，则设置连续调度程序执行之间的时间。")]),s._v(" "),e("td",[e("code",[s._v("5m")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("cmdOptions")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("传递给"),e("em",[s._v("descheduler")]),s._v("命令的选项")]),s._v(" "),e("td",[e("em",[s._v("参见 values.yaml")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("deschedulerPolicy.strategies")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("要应用的"),e("em",[s._v("调度器")]),s._v("策略")]),s._v(" "),e("td",[e("em",[s._v("参见 values.yaml")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("priorityClassName")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("要添加到 pod 的优先级类的名称")]),s._v(" "),e("td",[e("code",[s._v("system-cluster-critical")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("rbac.create")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("如果"),e("code",[s._v("true")]),s._v("，创建和使用 RBAC 资源")]),s._v(" "),e("td",[e("code",[s._v("true")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("podSecurityPolicy.create")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("如果"),e("code",[s._v("true")]),s._v("，创建 PodSecurityPolicy")]),s._v(" "),e("td",[e("code",[s._v("true")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("resources")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("调度器容器 CPU 和内存请求/限制")]),s._v(" "),e("td",[e("em",[s._v("参见 values.yaml")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("serviceAccount.create")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("如果"),e("code",[s._v("true")]),s._v("，为 cron 作业创建一个服务帐户")]),s._v(" "),e("td",[e("code",[s._v("true")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("serviceAccount.name")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("要使用的服务帐户的名称，如果未设置且 create 为 true，则使用 fullname 模板生成名称")]),s._v(" "),e("td",[e("code",[s._v("nil")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("nodeSelector")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("用于在特定节点上运行调度程序 cronjob 的节点选择器")]),s._v(" "),e("td",[e("code",[s._v("nil")])])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("tolerations")])]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("在特定节点上运行调度程序 cronjob 的容忍度")]),s._v(" "),e("td",[e("code",[s._v("nil")])])])])]),s._v(" "),e("p",[s._v("默认策略生成")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[s._v("  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("RemoveDuplicates")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("RemovePodsViolatingNodeTaints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("RemovePodsViolatingNodeAffinity")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("params")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeAffinityType")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" requiredDuringSchedulingIgnoredDuringExecution\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("RemovePodsViolatingInterPodAntiAffinity")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("LowNodeUtilization")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("params")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeResourceUtilizationThresholds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("thresholds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pods")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetThresholds")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pods")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br")])]),e("h2",{attrs:{id:"_6、测试驱逐"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6、测试驱逐"}},[s._v("#")]),s._v(" 6、测试驱逐")]),s._v(" "),e("p",[s._v("测试驱逐")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deployment"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("basic\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.7.9\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("kubectl apply -f nginx.yaml\nkubectl get pod -n default -o wide\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("NAME                                      READY   STATUS    RESTARTS   AGE     IP               NODE                NOMINATED NODE   READINESS GATES\nnginx-deployment-basic-76bf4969df-82kbf   1/1     Running   0          4m40s   10.244.206.168   k8s-10.165.24.170   <none>           <none>\nnginx-deployment-basic-76bf4969df-m7nl6   1/1     Running   0          4m40s   10.244.37.104    k8s-10.165.24.169   <none>           <none>\nnginx-deployment-basic-76bf4969df-tv6zv   1/1     Running   0          4m40s   10.244.205.218   k8s-10.165.24.168   <none>           <none>\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://raw.githubusercontent.com/lzq70112/images/master/blog/image-20211130152208364.png",alt:"image-20211130152208364"}})]),s._v(" "),e("p",[s._v("触发策略")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://raw.githubusercontent.com/lzq70112/images/master/blog/image-20211130200811536.png",alt:"image-20211130200811536"}})]),s._v(" "),e("p",[e("img",{attrs:{src:"https://raw.githubusercontent.com/lzq70112/images/master/blog/image-20211130200733541.png",alt:"image-20211130200733541"}})]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('I1130 12:04:10.866453       1 named_certificates.go:53] "Loaded SNI cert" index=0 certName="self-signed loopback" certDetail="\\"apiserver-loopback-client@1638273850\\" [serving] validServingFor=[apiserver-loopback-client] issuer=\\"apiserver-loopback-client-ca@1638273850\\" (2021-11-30 11:04:10 +0000 UTC to 2022-11-30 11:04:10 +0000 UTC (now=2021-11-30 12:04:10.866373593 +0000 UTC))"\nI1130 12:04:10.866600       1 secure_serving.go:195] Serving securely on [::]:10258\nI1130 12:04:10.866742       1 tlsconfig.go:240] "Starting DynamicServingCertificateController"\nI1130 12:04:10.892135       1 node.go:46] "Node lister returned empty list, now fetch directly"\nI1130 12:04:10.900951       1 pod_antiaffinity.go:81] "Processing node" node="k8s-10.165.24.168"\nI1130 12:04:10.968112       1 pod_antiaffinity.go:81] "Processing node" node="k8s-10.165.24.169"\nI1130 12:04:11.040374       1 pod_antiaffinity.go:81] "Processing node" node="k8s-10.165.24.170"\nI1130 12:04:11.111586       1 node_affinity.go:75] "Executing for nodeAffinityType" nodeAffinity="requiredDuringSchedulingIgnoredDuringExecution"\nI1130 12:04:11.111629       1 node_affinity.go:80] "Processing node" node="k8s-10.165.24.168"\nI1130 12:04:11.156870       1 node.go:169] "Pod fits on node" pod="default/nginx-deployment-basic-76bf4969df-gx7fk" node="k8s-10.165.24.168"\nI1130 12:04:11.156917       1 node.go:169] "Pod fits on node" pod="default/nginx-deployment-basic-76bf4969df-kvhwq" node="k8s-10.165.24.168"\nI1130 12:04:11.156985       1 node.go:169] "Pod fits on node" pod="kedacom-project-namespace/cephfs-provisioner-6cb45d4d4-jn2gl" node="k8s-10.165.24.168"\nI1130 12:04:11.157042       1 node.go:169] "Pod fits on node" pod="kedacom-project-namespace/dol-elasticsearch-78-exporter-7977b8b59d-gc2jf" node="k8s-10.165.24.168"\nI1130 12:04:11.157069       1 node.go:169] "Pod fits on node" pod="kedacom-project-namespace/dol-elasticsearch-exporter-58d4647d54-vpmsr" node="k8s-10.165.24.168"\nI1130 12:04:11.157204       1 node.go:169] "Pod fits on node" pod="kube-system/kube-state-metrics-6986f4f675-zgwpg" node="k8s-10.165.24.168"\nI1130 12:04:11.157249       1 node_affinity.go:80] "Processing node" node="k8s-10.165.24.169"\nI1130 12:04:11.213063       1 node.go:169] "Pod fits on node" pod="kedacom-project-namespace/alertmanager-1" node="k8s-10.165.24.169"\nI1130 12:04:11.213147       1 node.go:169] "Pod fits on node" pod="kedacom-project-namespace/dol-prometheus-0" node="k8s-10.165.24.169"\nI1130 12:04:11.213275       1 node_affinity.go:80] "Processing node" node="k8s-10.165.24.170"\nI1130 12:04:11.268428       1 node.go:169] "Pod fits on node" pod="default/nginx-deployment-basic-76bf4969df-l5qcn" node="k8s-10.165.24.170"\nI1130 12:04:11.268494       1 node.go:169] "Pod fits on node" pod="kedacom-project-namespace/alertmanager-0" node="k8s-10.165.24.170"\nI1130 12:04:11.268624       1 node.go:169] "Pod fits on node" pod="kedacom-project-namespace/dol-prometheus-1" node="k8s-10.165.24.170"\nI1130 12:04:11.268848       1 node_taint.go:81] "Processing node" node="k8s-10.165.24.168"\nI1130 12:04:11.312521       1 node_taint.go:81] "Processing node" node="k8s-10.165.24.169"\nI1130 12:04:11.370280       1 node_taint.go:81] "Processing node" node="k8s-10.165.24.170"\nI1130 12:04:11.608101       1 nodeutilization.go:164] "Node is underutilized" node="k8s-10.165.24.168" usage=map[cpu:4225m memory:34851Mi pods:33] usagePercentage=map[cpu:35.208333333333336 memory:54.18162323038457 pods:30]\nI1130 12:04:11.608182       1 nodeutilization.go:167] "Node is overutilized" node="k8s-10.165.24.169" usage=map[cpu:5825m memory:52197Mi pods:42] usagePercentage=map[cpu:48.541666666666664 memory:81.14883899332538 pods:38.18181818181818]\nI1130 12:04:11.608215       1 nodeutilization.go:167] "Node is overutilized" node="k8s-10.165.24.170" usage=map[cpu:5225m memory:48717Mi pods:51] usagePercentage=map[cpu:43.541666666666664 memory:75.73860546080873 pods:46.36363636363637]\nI1130 12:04:11.608239       1 lownodeutilization.go:100] "Criteria for a node under utilization" CPU=60 Mem=60 Pods=60\nI1130 12:04:11.608276       1 lownodeutilization.go:101] "Number of underutilized nodes" totalNumber=1\nI1130 12:04:11.608309       1 lownodeutilization.go:114] "Criteria for a node above target utilization" CPU=62 Mem=62 Pods=62\nI1130 12:04:11.608326       1 lownodeutilization.go:115] "Number of overutilized nodes" totalNumber=2\nI1130 12:04:11.608375       1 nodeutilization.go:223] "Total capacity to be moved" CPU=3215 Mem=5273266749 Pods=35\nI1130 12:04:11.608399       1 nodeutilization.go:226] "Evicting pods from node" node="k8s-10.165.24.169" usage=map[cpu:5825m memory:52197Mi pods:42]\nI1130 12:04:11.608700       1 nodeutilization.go:229] "Pods on node" node="k8s-10.165.24.169" allPods=42 nonRemovablePods=40 removablePods=2\nI1130 12:04:11.608745       1 nodeutilization.go:236] "Evicting pods based on priority, if they have same priority, they\'ll be evicted based on QoS tiers"\nI1130 12:04:11.649119       1 evictions.go:130] "Evicted pod" pod="kedacom-project-namespace/alertmanager-1" reason="LowNodeUtilization"\nI1130 12:04:11.649416       1 nodeutilization.go:269] "Evicted pods" pod="kedacom-project-namespace/alertmanager-1" err=<nil>\nI1130 12:04:11.649457       1 nodeutilization.go:294] "Updated node usage" node="k8s-10.165.24.169" CPU=5725 Mem=54195650560 Pods=41\nI1130 12:04:11.650289       1 event.go:291] "Event occurred" object="kedacom-project-namespace/alertmanager-1" kind="Pod" apiVersion="v1" type="Normal" reason="Descheduled" message="pod evicted by sigs.k8s.io/deschedulerLowNodeUtilization"\nI1130 12:04:11.672580       1 evictions.go:130] "Evicted pod" pod="kedacom-project-namespace/dol-prometheus-0" reason="LowNodeUtilization"\nI1130 12:04:11.672854       1 nodeutilization.go:269] "Evicted pods" pod="kedacom-project-namespace/dol-prometheus-0" err=<nil>\nI1130 12:04:11.673048       1 nodeutilization.go:294] "Updated node usage" node="k8s-10.165.24.169" CPU=5625 Mem=52048166912 Pods=40\nI1130 12:04:11.673132       1 nodeutilization.go:240] "Evicted pods from node" node="k8s-10.165.24.169" evictedPods=2 usage=map[cpu:5625m memory:49637Mi pods:40]\nI1130 12:04:11.673136       1 event.go:291] "Event occurred" object="kedacom-project-namespace/dol-prometheus-0" kind="Pod" apiVersion="v1" type="Normal" reason="Descheduled" message="pod evicted by sigs.k8s.io/deschedulerLowNodeUtilization"\nI1130 12:04:11.673178       1 nodeutilization.go:226] "Evicting pods from node" node="k8s-10.165.24.170" usage=map[cpu:5225m memory:48717Mi pods:51]\nI1130 12:04:11.673775       1 nodeutilization.go:229] "Pods on node" node="k8s-10.165.24.170" allPods=51 nonRemovablePods=48 removablePods=3\nI1130 12:04:11.673829       1 nodeutilization.go:236] "Evicting pods based on priority, if they have same priority, they\'ll be evicted based on QoS tiers"\nI1130 12:04:11.700919       1 evictions.go:130] "Evicted pod" pod="default/nginx-deployment-basic-76bf4969df-l5qcn" reason="LowNodeUtilization"\nI1130 12:04:11.701078       1 nodeutilization.go:269] "Evicted pods" pod="default/nginx-deployment-basic-76bf4969df-l5qcn" err=<nil>\nI1130 12:04:11.701126       1 nodeutilization.go:294] "Updated node usage" node="k8s-10.165.24.170" CPU=5225 Mem=51083476992 Pods=50\nI1130 12:04:11.701257       1 event.go:291] "Event occurred" object="default/nginx-deployment-basic-76bf4969df-l5qcn" kind="Pod" apiVersion="v1" type="Normal" reason="Descheduled" message="pod evicted by sigs.k8s.io/deschedulerLowNodeUtilization"\nI1130 12:04:11.728656       1 evictions.go:130] "Evicted pod" pod="kedacom-project-namespace/alertmanager-0" reason="LowNodeUtilization"\nI1130 12:04:11.728832       1 nodeutilization.go:269] "Evicted pods" pod="kedacom-project-namespace/alertmanager-0" err=<nil>\nI1130 12:04:11.728873       1 nodeutilization.go:294] "Updated node usage" node="k8s-10.165.24.170" CPU=5125 Mem=50546606080 Pods=49\nI1130 12:04:11.729218       1 event.go:291] "Event occurred" object="kedacom-project-namespace/alertmanager-0" kind="Pod" apiVersion="v1" type="Normal" reason="Descheduled" message="pod evicted by sigs.k8s.io/deschedulerLowNodeUtilization"\nI1130 12:04:11.771287       1 evictions.go:130] "Evicted pod" pod="kedacom-project-namespace/dol-prometheus-1" reason="LowNodeUtilization"\nI1130 12:04:11.771445       1 nodeutilization.go:269] "Evicted pods" pod="kedacom-project-namespace/dol-prometheus-1" err=<nil>\nI1130 12:04:11.771478       1 nodeutilization.go:294] "Updated node usage" node="k8s-10.165.24.170" CPU=5025 Mem=48399122432 Pods=48\nI1130 12:04:11.771525       1 nodeutilization.go:240] "Evicted pods from node" node="k8s-10.165.24.170" evictedPods=3 usage=map[cpu:5025m memory:46157Mi pods:48]\nI1130 12:04:11.771574       1 lownodeutilization.go:163] "Total number of pods evicted" evictedPods=5\nI1130 12:04:11.771599       1 descheduler.go:152] "Number of evicted pods" totalEvicted=5\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);