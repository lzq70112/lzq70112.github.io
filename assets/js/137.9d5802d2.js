(window.webpackJsonp=window.webpackJsonp||[]).push([[137],{607:function(s,t,r){"use strict";r.r(t);var a=r(20),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,r=s._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("p",[s._v("本文转载于"),r("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/345823292",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://zhuanlan.zhihu.com/p/345823292"),r("OutboundLink")],1),s._v("，用于后续查询学习")]),s._v(" "),r("h2",{attrs:{id:"_1、导读"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1、导读"}},[s._v("#")]),s._v(" 1、"),r("strong",[s._v("导读")])]),s._v(" "),r("p",[s._v("Pod容器想要获取集群的资源信息，需要配置角色和ServiceAccount进行授权。为了更精细地控制Pod对资源的使用方式，Kubernetes从1.4版本开始引入了PodSecurityPolicy资源对象对Pod的安全策略进行管理。")]),s._v(" "),r("h2",{attrs:{id:"_2、pod特权模式"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2、pod特权模式"}},[s._v("#")]),s._v(" 2、"),r("strong",[s._v("Pod特权模式")])]),s._v(" "),r("p",[s._v("容器内的进程获得的特权几乎与容器外的进程相同。使用特权模式，可以更容易地将网络和卷插件编写为独立的pod，不需要编译到kubelet中。")]),s._v(" "),r("h2",{attrs:{id:"_3、podsecuritypolicy"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3、podsecuritypolicy"}},[s._v("#")]),s._v(" 3、"),r("strong",[s._v("PodSecurityPolicy")])]),s._v(" "),r("h3",{attrs:{id:"_3-1、官网定义"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1、官网定义"}},[s._v("#")]),s._v(" 3.1、"),r("strong",[s._v("官网定义")])]),s._v(" "),r("p",[s._v("Pod 安全策略（Pod Security Policy） 是集群级别的资源，它能够控制Pod规约 中与安全性相关的各个方面。PodSecurityPolicy 对象定义了一组Pod运行时必须遵循的条件及相关字段的默认值，只有 Pod 满足这些条件才会被系统接受。")]),s._v(" "),r("p",[s._v("Pod 安全策略允许管理员控制如下方面：")]),s._v(" "),r("p",[r("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lzq70112/images/blog/202206301049465.png",alt:"img"}})]),s._v(" "),r("p",[s._v("Pod 安全策略 由设置和策略组成，它们能够控制 Pod 访问的安全特征。这些设置分为如下三类：")]),s._v(" "),r("p",[s._v("（1）基于布尔值控制 ：这种类型的字段默认为最严格限制的值。（2）基于被允许的值集合控制 ：这种类型的字段会与这组值进行对比，以确认值被允许。（3）基于策略控制 ：设置项通过一种策略提供的机制来生成该值，这种机制能够确保指定的值落在被允许的这组值中。")]),s._v(" "),r("h3",{attrs:{id:"_3-2、开启"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2、开启"}},[s._v("#")]),s._v(" 3.2、"),r("strong",[s._v("开启")])]),s._v(" "),r("p",[s._v("如果需要开启PodSecurityPolicy，需要在kube-apiserver的启动参数中设置如下参数")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("enable"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admission"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plugins"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PodSecurityPolicy\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("在开启PodSecurityPolicy准入控制器后，k8s默认不允许创建任何Pod，需要创建PodSecurityPolicy和RBAC授权策略，Pod才能创建成功。")]),s._v(" "),r("p",[s._v("注：修改kube-apiserver配置文件/etc/kubernetes/manifests/kube-apiserver.yaml，由于是static pod，所以修改就会生效。")]),s._v(" "),r("p",[s._v("系统默认此参数为：")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("enable"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admission"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plugins"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NodeRestriction\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("开启之后创建Pod会出现如下错误：")]),s._v(" "),r("p",[r("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lzq70112/images/blog/202206301049832.png",alt:"img"}})]),s._v(" "),r("h3",{attrs:{id:"_3-3、创建podsecuritypolicy"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3、创建podsecuritypolicy"}},[s._v("#")]),s._v(" 3.3、"),r("strong",[s._v("创建PodSecurityPolicy")])]),s._v(" "),r("p",[s._v("下列PodSecurityPolicy表示是不允许创建特权模式的Pod")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiVersion")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" policy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1beta1 \n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("kind")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" PodSecurityPolicy\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("metadata")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" psp"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("non"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("privileged\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("spec")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("privileged")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("  #不允许特权模式的Pod\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("seLinux")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("rule")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" RunAsAny\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("supplementalGroups")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("rule")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" RunAsAny\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("runAsUser")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("rule")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" RunAsAny\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("fsGroup")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("rule")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" RunAsAny\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("volumes")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br")])]),r("p",[s._v("创建之后查看：")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" psp\n或者\nkubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" podSecurityPolicy\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("p",[r("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lzq70112/images/blog/202206301049708.png",alt:"img"}})]),s._v(" "),r("p",[s._v("之后再次创建Pod就能创建成功")]),s._v(" "),r("p",[r("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lzq70112/images/blog/202206301049267.png",alt:"img"}})]),s._v(" "),r("p",[s._v("上面的PodSecurytiPolicy是设置了不允许创建特权模式的Pod，例如，在下面的YAML配置文件pod-privileged.yaml中为Pod设置了特权模式：")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiVersion")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("kind")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Pod\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("metadata")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("spec")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("containers")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("image")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("latest\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("imagePullPolicy")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" IfNotPresent\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("ports")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" containerPort"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("securityContext")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("privileged")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br")])]),r("p",[s._v("创建的时候会报如下错误：")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("unable to validate against any pod security policy\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[r("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lzq70112/images/blog/202206301049249.png",alt:"img"}})]),s._v(" "),r("h2",{attrs:{id:"_4、podsecuritypolicy配置详解"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4、podsecuritypolicy配置详解"}},[s._v("#")]),s._v(" 4、"),r("strong",[s._v("PodSecurityPolicy配置详解")])]),s._v(" "),r("p",[s._v("在PodSecurityPolicy对象中可以设置下列字段来控制Pod运行时的各种安全策略")]),s._v(" "),r("h3",{attrs:{id:"_4-1、特权模式相关配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-1、特权模式相关配置"}},[s._v("#")]),s._v(" 4.1、"),r("strong",[s._v("特权模式相关配置")])]),s._v(" "),r("p",[s._v("privileged：是否允许Pod以特权模式运行")]),s._v(" "),r("h3",{attrs:{id:"_4-2、宿主机资源相关配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-2、宿主机资源相关配置"}},[s._v("#")]),s._v(" 4.2、宿主机资源相关配置")]),s._v(" "),r("p",[s._v("1、hostPID：是否允许Pod共享宿主机的进程空间")]),s._v(" "),r("p",[s._v("2、hostIPC：是否允许Pod共享宿主机的IPC命名空间")]),s._v(" "),r("p",[s._v("3、hostNetwork：是否允许Pod共享宿主机网络的命名空间")]),s._v(" "),r("p",[s._v("4、hostPorts：是否允许Pod使用宿主机的端口号，可以通过hostPortRange字段设置允许使用的端口号范围，以[min, max]设置最小端口号和最大端口号")]),s._v(" "),r("p",[s._v("5、Volumes：允许Pod使用的存储卷Volume类型，设置为“*”表示允许使用任意Volume类型，建议至少允许Pod使用下列Volume类型。configMap，emptyDir、downwardAPI、persistentVolumeClaim、secret、projected")]),s._v(" "),r("p",[s._v("6、AllowedHostPaths：允许Pod使用宿主机的hostPath路径名称，可通过pathPrefix字段设置路径的前缀，并可以设置是否只读属性，例如：只允许Pod访问宿主机上以“/foo”为前缀的路径，包 括“/foo”“/foo/”“/foo/bar”等，")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiVersion")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" policy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1beta1\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("kind")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" PodSecurityPolicy\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("metadata")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" all"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hostpath"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("volumes\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("spec")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("volumes")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" hostPath\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("allowedHostPaths")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" pathPrefix"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/foo"')]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("readOnly")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("   \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br")])]),r("p",[s._v("7、FSGroup：设置允许访问某些Volume的Group ID范围，可以将rule字段设置为ManyRunAs、MayRunAs、RunAsAny")]),s._v(" "),r("p",[s._v("MustRunAs：需要设置Group ID的范围，例如1～65535，要求Pod的securityContext.fsGroup设置的值必须属于该Group ID的范围。")]),s._v(" "),r("p",[s._v("MayRunAs：需要设置Group ID的范围，例如1～65535，不强制要求Pod设置securityContext.fsGroup。")]),s._v(" "),r("p",[s._v("RunAsAny：不限制Group ID的范围，任何Group都可以访问Volume。")]),s._v(" "),r("p",[s._v("8、ReadOnlyRootFilesystem：要求容器运行的根文件系统（root filesystem）必须是只读的")]),s._v(" "),r("p",[s._v("9、allowedFlexVolumes：对于类型为flexVolume的存储卷，设置允许使用的驱动类型，例如：")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiVersion")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" policy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1beta1\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("kind")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" PodSecurityPolicy\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("metadata")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" allowedflexvolumes\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("spec")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("volumes")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" flexVolume\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("allowedFlexVolumes")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" driver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" example"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lvm\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" driver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" example"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cifs\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br")])]),r("h3",{attrs:{id:"_4-3、用户和组相关配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-3、用户和组相关配置"}},[s._v("#")]),s._v(" 4.3、用户和组相关配置")]),s._v(" "),r("p",[s._v("1、RunAsUser：设置运行容器的用户ID范围，rule可以被设置为MustRunAs、MustRunAsNonRoot或RunAsAny")]),s._v(" "),r("p",[s._v("MustRunAs：需要设置User ID的范围，要求Pod的securityContext.runAsUser设置的值必须属于该User ID的范围。")]),s._v(" "),r("p",[s._v("MustRunAsNonRoot：必须以非root用户运行容器，要求Pod的 securityContext.runAsUser设置一个非0的用户ID，或者镜像中在USER字段设置了用户ID，建议同时设置allowPrivilegeEscalation=false以避免不 必要的提升权限操作。")]),s._v(" "),r("p",[s._v("RunAsAny：不限制User ID的范围，任何User都可以运行。")]),s._v(" "),r("p",[s._v("2、RunAsGroup：设置运行容器的Group ID范围，可以被设置为MustRunAs、MustRunAsNonRoot、RunAsAny")]),s._v(" "),r("p",[s._v("MustRunAs：需要设置Group ID的范围，要求Pod的securityContext.runAsGroup设置的值必须属于该Group ID的范围。")]),s._v(" "),r("p",[s._v("MustRunAsNonRoot：必须以非root组运行容器，要求Pod的securityContext.runAsUser设置一个非0的用户ID，或者镜像中在USER字段设置了用户ID，建议同时设置allowPrivilegeEscalation=false以避免不必要的提升权限操作。")]),s._v(" "),r("p",[s._v("RunAsAny：不限制Group ID的范围，任何Group的用户都可以运行。")]),s._v(" "),r("p",[s._v("3、SupplementalGroups：设置容器可以额外添加的Group ID范围，可以将规则（rule字段）设置为MustRunAs、MayRunAs或RunAsAny")]),s._v(" "),r("p",[s._v("MustRunAs：需要设置Group ID的范围，要求Pod的securityContext.supplementalGroups设置的值必须属于该Group ID范围。")]),s._v(" "),r("p",[s._v("MayRunAs：需要设置Group ID的范围，不强制要求Pod设置 securityContext.supplementalGroups。")]),s._v(" "),r("p",[s._v("RunAsAny：不限制Group ID的范围，任何supplementalGroups的用户都可以运行。")]),s._v(" "),r("h3",{attrs:{id:"_4-4、提升权限相关配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4、提升权限相关配置"}},[s._v("#")]),s._v(" 4.4、提升权限相关配置")]),s._v(" "),r("p",[s._v("1、AllowPrivilegeEscalation：用于设置容器内的子进程是否可以提升权限，通常在设置非Root用户（MustRunAsNonRoot）时进行设置。")]),s._v(" "),r("p",[s._v("2、DefaultAllowPrivilegeEscalation：设置AllowPrivilegeEscalation的默认值，设置为disallow时，管理员还可以显式设置 AllowPrivilegeEscalation来指定是否允许提升权限。")]),s._v(" "),r("h3",{attrs:{id:"_4-5、linux能力相关配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-5、linux能力相关配置"}},[s._v("#")]),s._v(" 4.5、Linux能力相关配置")]),s._v(" "),r("p",[s._v("1、AllowedCapabilities：设置容器使用的linux能力列表，设置为“*”表示允许使用Linux的所有能力（如NET_ADMIN、SYS_TIME等）。")]),s._v(" "),r("p",[s._v("2、RequiredDropCapabilities：设置不允许容器使用的linux能力列表")]),s._v(" "),r("p",[s._v("3、DefaultAddCapabilities：设置默认为容器添加的Linux能力列表，例如SYS_TIME等")]),s._v(" "),r("h3",{attrs:{id:"_4-6、selinux相关配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-6、selinux相关配置"}},[s._v("#")]),s._v(" 4.6、SELinux相关配置")]),s._v(" "),r("p",[s._v("seLinux：设置SELinux参数，可以将规则字段（rule）的值设置为MustRunAs或RunAsAny。")]),s._v(" "),r("p",[s._v("MustRunAs：要求设置seLinuxOptions，系统将对Pod的securityContext.seLinuxOptions设置的值进行校验。")]),s._v(" "),r("p",[s._v("RunAsAny：不限制seLinuxOptions的设置")]),s._v(" "),r("h3",{attrs:{id:"_4-7、其它linux相关配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-7、其它linux相关配置"}},[s._v("#")]),s._v(" 4.7、其它Linux相关配置")]),s._v(" "),r("p",[s._v("1、AllowedProcMountType：设置允许的PropMountTypes类型列表，可以设置allowedProcMountTypes或DefaultProcMount。")]),s._v(" "),r("p",[s._v("2、AppArmor：设置对容器可执行程序的访问控制权限，")]),s._v(" "),r("p",[s._v("3、Seccomp：设置允许容器使用的系统调用（System Calls）的profile")]),s._v(" "),r("p",[s._v("4、Sysctl：设置允许调整的内核参数，")]),s._v(" "),r("h3",{attrs:{id:"_4-8、列举两种常用的podsecuritypolicy安全策略配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-8、列举两种常用的podsecuritypolicy安全策略配置"}},[s._v("#")]),s._v(" 4.8、列举两种常用的PodSecurityPolicy安全策略配置")]),s._v(" "),r("p",[s._v("1、基本没有限制的安全策略，允许创建任意安全设置的Pod。")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiVersion")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" policy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1beta1\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("kind")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" PodSecurityPolicy\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("metadata")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" privileged\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("annotations")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    seccomp"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("security"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alpha"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("allowedProfileNames"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("spec")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("privileged")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("  #不允许创建特权模式的Pod\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("allowPrivilegeEscalation")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("  #设置子进程是否可以提升权限，配置MustRunAsNonRoot\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("allowedCapabilities")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("volumes")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("hostNetwork")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("hostPorts")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" min"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("max")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("hostIPC")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("hostPID")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("runAsUser")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("rule")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'RunAsAny'")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("seLinux")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("rule")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'RunAsAny'")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("supplementalGroups")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("rule")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'RunAsAny'")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("fsGroup")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("rule")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'RunAsAny'")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br")])]),r("p",[s._v("2、要求Pod运行用户为非特权用户；禁止提升权限；不允许使用宿主机网络、端口号、IPC等资源；限制可以使用的Volume类型，等等")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiVersion")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" policy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1beta1\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("kind")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" PodSecurityPolicy\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("metadata")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" retricted\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("annotations")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    seccomp"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("security"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alpha"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("allowedProfileNames"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'docker/default'")]),s._v("\n    seccomp"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("security"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alpha"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("defaultProfileNames"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'docker/default'")]),s._v("\n    apparmor"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("security"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("beta"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("allowedProfileNames"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'runtime/default'")]),s._v(" \n    apparmor"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("security"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("beta"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("defaultProfileNames"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'runtime/default'")]),s._v(" \n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("spec")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("privileged")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("allowPrivilegeEscalation")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("requiredDropCapabilities")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ALL")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("volumes")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'configMap'")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'emptyDir'")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'projected'")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'secret'")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'downwardAPI'")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'persistentVolumeClaim'")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("hostNetwork")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("hostIPC")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("hostPID")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("runAsUser")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("rule")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MustRunAsNonRoot'")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("seLinux")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("rule")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'RunAsAny'")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("supplementalGroups")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("rule")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MustRunAsRoot'")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("ranges")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" min"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("max")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("fsGroup")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("rule")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MustRunAsRoot'")]),s._v("\n    ranges：\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" min"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("max")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("readOnlyRootFilesystem")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br"),r("span",{staticClass:"line-number"},[s._v("31")]),r("br"),r("span",{staticClass:"line-number"},[s._v("32")]),r("br"),r("span",{staticClass:"line-number"},[s._v("33")]),r("br"),r("span",{staticClass:"line-number"},[s._v("34")]),r("br"),r("span",{staticClass:"line-number"},[s._v("35")]),r("br"),r("span",{staticClass:"line-number"},[s._v("36")]),r("br"),r("span",{staticClass:"line-number"},[s._v("37")]),r("br"),r("span",{staticClass:"line-number"},[s._v("38")]),r("br"),r("span",{staticClass:"line-number"},[s._v("39")]),r("br")])]),r("p",[s._v("Kubernetes建议使用RBAC授权机制来设置针对Pod安全策略的授权，通常应该对Pod的ServiceAccount进行授权。")]),s._v(" "),r("p",[s._v("例如，可以创建如下ClusterRole（也可以创建Role）并将其设置为允许使用PodSecurityPolicy：")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiVersion")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" rbac"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("kind")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ClusterRole\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("metadata")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" role"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("rules")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" apiGroups"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'policy'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("resources")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'podsecuritypolicies'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("verbs")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'use'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("resourceNames")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" #允许使用的PodSecurityPolicy列表\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br")])]),r("p",[s._v("然后创建一个ClusterRoleBinding与用户和ServiceAccount进行绑定")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiVersion")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" rbac"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("kind")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ClusterRoleBinding\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("metadata")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" bind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("ruleRef")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("kind")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ClusterRole\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" role"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiGroup")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" rabc"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("subjects")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" kind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ServiceAccount\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" serviceaccount\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("namespace")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" kind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" User\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" username\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiGroup")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" rbac"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br")])]),r("p",[s._v("也可以创建RoleBinding对与该RoleBinding相同的Namespace中的Pod进行授权，通常可以与某个系统级别的Group关联配置，例如：")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiVersion")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" rbac"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("kind")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" RoleBinding\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("metadata")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" bind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("namespace")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" namespace #该RoleBinding所属的namespace\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("roleRef")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("kind")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Role\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" \n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiGroup")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" rabc"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("subjects")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n#授权该Namespace中的全部ServiceAccount\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" kind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Group\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiGroup")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" rabc"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" system"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("serviceaccounts\n#授权该Namespace的全部用户\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" kind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" User\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiGroup")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" rabc"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" system"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("authenticated\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br")])]),r("h2",{attrs:{id:"_5、pod的安全设置详解"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5、pod的安全设置详解"}},[s._v("#")]),s._v(" 5、"),r("strong",[s._v("Pod的安全设置详解")])]),s._v(" "),r("p",[s._v("Pod和容器的安全策略可以在Pod或Container的securityContext字段中设置，如果在Pod和Container级别都设置了相同的安全类型字段，容器将使用Container级别的设置。")]),s._v(" "),r("p",[s._v("在Pod级别可以设置的安全措施如下：")]),s._v(" "),r("p",[s._v("◎ runAsUser：容器内运行程序的用户ID。")]),s._v(" "),r("p",[s._v("◎ runAsGroup：容器内运行程序的用户组ID。")]),s._v(" "),r("p",[s._v("◎ runAsNonRoot：是否必须以非root用户运行程序。◎ fsGroup：SELinux相关设置。")]),s._v(" "),r("p",[s._v("◎ seLinuxOptions：SELinux相关设置。")]),s._v(" "),r("p",[s._v("◎ supplementalGroups：允许容器使用的其他用户组ID。")]),s._v(" "),r("p",[s._v("◎ sysctls：设置允许调整的内核参数。")]),s._v(" "),r("p",[s._v("在Container级别可以设置的安全策略类型如下：")]),s._v(" "),r("p",[s._v("◎ runAsUser：容器内运行程序的用户ID。")]),s._v(" "),r("p",[s._v("◎ runAsGroup：容器内运行程序的用户组ID。")]),s._v(" "),r("p",[s._v("◎ runAsNonRoot：是否必须以非root用户运行程序。")]),s._v(" "),r("p",[s._v("◎ privileged：是否以特权模式运行。")]),s._v(" "),r("p",[s._v("◎ allowPrivilegeEscalation：是否允许提升权限。")]),s._v(" "),r("p",[s._v("◎ readOnlyRootFilesystem：根文件系统是否为只读属性。")]),s._v(" "),r("p",[s._v("◎ capabilities：Linux能力列表。")]),s._v(" "),r("p",[s._v("◎ seLinuxOptions：SELinux相关设置。")]),s._v(" "),r("p",[s._v("例如：Pod级别的安全设置，作用于该Pod内的全部容器")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiVersion")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("kind")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Pod\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("metadata")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" security"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("context"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("spec")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("securityContext")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("runAsUser")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("runAsGroup")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("fsGroup")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("volumes")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ctx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("vol\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("emptyDir")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("containers")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ctx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("image")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("volumeMounts")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ctx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo\n      "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("mountPath")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("demo\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("securityContext")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("allowPrivilegeEscalation")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br")])]),r("p",[s._v("◎ runAsUser=1000：所有容器都将以User ID 1000运行程序，所有新生成文件的User ID也被设置为1000。")]),s._v(" "),r("p",[s._v("◎ runAsGroup=3000：所有容器都将以Group ID 3000运行程序，所有新生成文件的Group ID也被设置为3000。")]),s._v(" "),r("p",[s._v("◎ fsGroup=2000：挂载的卷“/data/demo”及其中创建的文件都将属于Group ID 2000。")]),s._v(" "),r("p",[s._v("Container级别的安全设置，作用于特定的容器。")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiVersion")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("kind")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Pod\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("metadata")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" scd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("spec")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("securityContext")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("runAsUser")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("containers")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" scd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("image")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("latest\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("imagePullPolicy")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" IfNotPresent\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("securityContext")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("runAsUser")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("allowPrivilegeEscalation")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br")])]),r("p",[s._v("为Container设置可用的Linux能力，为容器设置允许使用的Linux能力包括NET_ADMIN和SYS_TIME。")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apiVersion")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("kind")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Pod\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("metadata")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" scd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("spec")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("containers")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" scd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("image")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("securityContext")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("capabilities")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("add")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NET_ADMIN"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SYS_TIME"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);