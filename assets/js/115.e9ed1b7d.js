(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{585:function(t,s,a){"use strict";a.r(s);var n=a(20),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_1、什么是security-context"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、什么是security-context"}},[t._v("#")]),t._v(" 1、什么是Security Context")]),t._v(" "),a("p",[t._v("Security Context，即安全上下文，用于定义Pod或Container的权限和访问控制。")]),t._v(" "),a("p",[t._v("Kubernetes 提供了三种配置 Security Context 的方法：")]),t._v(" "),a("ul",[a("li",[t._v("Container-level Security Context：应用于容器级别")]),t._v(" "),a("li",[t._v("Pod-level Security Context：应用于Pod级别")]),t._v(" "),a("li",[t._v("Pod Security Policy：应用于集群级别")])]),t._v(" "),a("h2",{attrs:{id:"_2、容器级别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、容器级别"}},[t._v("#")]),t._v(" 2、容器级别")]),t._v(" "),a("p",[t._v("仅应用到指定的容器上，并且不会影响 Volume。")]),t._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hello"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("world\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hello"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("world"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("container\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("securityContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("privileged")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("h2",{attrs:{id:"_3、pod级别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、pod级别"}},[t._v("#")]),t._v(" 3、Pod级别")]),t._v(" "),a("p",[t._v("应用到 Pod 内所有容器，会影响 Volume。")]),t._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hello"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("world\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("securityContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fsGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1234")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("supplementalGroups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5678")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("seLinuxOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("level")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s0:c123,c456"')]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("h2",{attrs:{id:"_4、psp集群级别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、psp集群级别"}},[t._v("#")]),t._v(" 4、PSP集群级别")]),t._v(" "),a("p",[t._v("PSP 是集群级的 Pod 安全策略，自动为集群内的 Pod 和 Volume 设置 Security Context。")]),t._v(" "),a("p",[a("strong",[t._v("支持的控制项")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("privileged")]),t._v(" "),a("th",[t._v("运行特权容器")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("defaultAddCapabilities")]),t._v(" "),a("td",[t._v("可添加到容器的 Capabilities")])]),t._v(" "),a("tr",[a("td",[t._v("requiredDropCapabilities")]),t._v(" "),a("td",[t._v("会从容器中删除的 Capabilities")])]),t._v(" "),a("tr",[a("td",[t._v("allowedCapabilities")]),t._v(" "),a("td",[t._v("允许使用的 Capabilities 列表")])]),t._v(" "),a("tr",[a("td",[t._v("volumes")]),t._v(" "),a("td",[t._v("控制容器可以使用哪些 volume")])]),t._v(" "),a("tr",[a("td",[t._v("hostNetwork")]),t._v(" "),a("td",[t._v("允许使用 host 网络")])]),t._v(" "),a("tr",[a("td",[t._v("hostPorts")]),t._v(" "),a("td",[t._v("允许的 host 端口列表")])]),t._v(" "),a("tr",[a("td",[t._v("hostPID")]),t._v(" "),a("td",[t._v("使用 host PID namespace")])]),t._v(" "),a("tr",[a("td",[t._v("hostIPC")]),t._v(" "),a("td",[t._v("使用 host IPC namespace")])]),t._v(" "),a("tr",[a("td",[t._v("seLinux")]),t._v(" "),a("td",[t._v("SELinux Context")])]),t._v(" "),a("tr",[a("td",[t._v("runAsUser")]),t._v(" "),a("td",[t._v("user ID")])]),t._v(" "),a("tr",[a("td",[t._v("supplementalGroups")]),t._v(" "),a("td",[t._v("允许的补充用户组")])]),t._v(" "),a("tr",[a("td",[t._v("fsGroup")]),t._v(" "),a("td",[t._v("volume FSGroup")])]),t._v(" "),a("tr",[a("td",[t._v("readOnlyRootFilesystem")]),t._v(" "),a("td",[t._v("只读根文件系统")])]),t._v(" "),a("tr",[a("td",[t._v("allowedHostPaths")]),t._v(" "),a("td",[t._v("允许 hostPath 插件使用的路径列表")])]),t._v(" "),a("tr",[a("td",[t._v("allowedFlexVolumes")]),t._v(" "),a("td",[t._v("允许使用的 flexVolume 插件列表")])]),t._v(" "),a("tr",[a("td",[t._v("allowPrivilegeEscalation")]),t._v(" "),a("td",[t._v("允许容器进程设置")])]),t._v(" "),a("tr",[a("td",[t._v("defaultAllowPrivilegeEscalation")]),t._v(" "),a("td",[t._v("默认是否允许特权升级")])])])]),t._v(" "),a("p",[a("strong",[t._v("RunAsUser")])]),t._v(" "),a("ul",[a("li",[a("em",[t._v("MustRunAs")]),t._v(" - 必须配置一个 "),a("code",[t._v("range")]),t._v("。使用该范围内的第一个值作为默认值。验证是否不在配置的该范围内。")]),t._v(" "),a("li",[a("em",[t._v("MustRunAsNonRoot")]),t._v(" - 要求提交的 Pod 具有非零 "),a("code",[t._v("runAsUser")]),t._v(" 值，或在镜像中定义了 "),a("code",[t._v("USER")]),t._v(" 环境变量。不提供默认值。")]),t._v(" "),a("li",[a("em",[t._v("RunAsAny")]),t._v(" - 没有提供默认值。允许指定任何 "),a("code",[t._v("runAsUser")]),t._v(" 。")])]),t._v(" "),a("p",[a("strong",[t._v("SELinux")])]),t._v(" "),a("ul",[a("li",[a("em",[t._v("MustRunAs")]),t._v(" - 如果没有使用预分配的值，必须配置 "),a("code",[t._v("seLinuxOptions")]),t._v("。默认使用 "),a("code",[t._v("seLinuxOptions")]),t._v("。")]),t._v(" "),a("li",[a("em",[t._v("RunAsAny")]),t._v(" - 没有提供默认值。允许任意指定的 "),a("code",[t._v("seLinuxOptions")]),t._v(" ID。")])]),t._v(" "),a("p",[a("strong",[t._v("SupplementalGroups")])]),t._v(" "),a("ul",[a("li",[a("em",[t._v("MustRunAs")]),t._v(" - 至少需要指定一个范围。默认使用第一个范围的最小值。")]),t._v(" "),a("li",[a("em",[t._v("RunAsAny")]),t._v(" - 没有提供默认值。允许任意指定的 "),a("code",[t._v("supplementalGroups")]),t._v(" ID。")])]),t._v(" "),a("p",[a("strong",[t._v("FSGroup")])]),t._v(" "),a("ul",[a("li",[a("em",[t._v("MustRunAs")]),t._v(" - 至少需要指定一个范围。默认使用第一个范围的最小值。")]),t._v(" "),a("li",[a("em",[t._v("RunAsAny")]),t._v(" - 没有提供默认值。允许任意指定的 "),a("code",[t._v("fsGroup")]),t._v(" ID。")])]),t._v(" "),a("p",[a("strong",[t._v("主机网络")])]),t._v(" "),a("ul",[a("li",[a("em",[t._v("HostPorts")]),t._v(" ， 默认为 "),a("code",[t._v("empty")]),t._v("。"),a("code",[t._v("HostPortRange")]),t._v(" 列表通过 "),a("code",[t._v("min")]),t._v("(包含) and "),a("code",[t._v("max")]),t._v("(包含) 来定义，指定了被允许的主机端口。")])]),t._v(" "),a("p",[a("strong",[t._v("允许的主机路径")])]),t._v(" "),a("ul",[a("li",[a("em",[t._v("AllowedHostPaths")]),t._v(" 是一个被允许的主机路径前缀的白名单。空值表示所有的主机路径都可以使用。")])]),t._v(" "),a("p",[a("strong",[t._v("控制卷")])]),t._v(" "),a("p",[t._v("通过设置 PSP 卷字段，能够控制具体卷类型的使用。")]),t._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" extensions/v1beta1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PodSecurityPolicy\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" permissive\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("seLinux")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RunAsAny\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("supplementalGroups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RunAsAny\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runAsUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RunAsAny\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fsGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RunAsAny\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPorts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("min")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);