<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Grafana安装与使用 | xiongmao&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="K8S、ELK、Jenkins、DevOps、CI/CD、Python、go、运维、运维开发、云原生、集群运维">
    <meta name="keywords" content="K8S、ELK、Jenkins、DevOps、CI/CD、Python、nginx、tomcat、mysql、ansible">
    <meta name="baidu-site-verification" content="b9w0xnx4YF">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.6732922a.css" as="style"><link rel="preload" href="/assets/js/app.e7221624.js" as="script"><link rel="preload" href="/assets/js/2.1e679d1d.js" as="script"><link rel="preload" href="/assets/js/168.2ade24d2.js" as="script"><link rel="prefetch" href="/assets/js/10.a711d5fc.js"><link rel="prefetch" href="/assets/js/100.24d6aa43.js"><link rel="prefetch" href="/assets/js/101.c117fc2a.js"><link rel="prefetch" href="/assets/js/102.6b262694.js"><link rel="prefetch" href="/assets/js/103.7bf86548.js"><link rel="prefetch" href="/assets/js/104.54770dc3.js"><link rel="prefetch" href="/assets/js/105.f9af743e.js"><link rel="prefetch" href="/assets/js/106.553f5ef8.js"><link rel="prefetch" href="/assets/js/107.265aceab.js"><link rel="prefetch" href="/assets/js/108.f20abc28.js"><link rel="prefetch" href="/assets/js/109.a27e2a34.js"><link rel="prefetch" href="/assets/js/11.a6dae5da.js"><link rel="prefetch" href="/assets/js/110.c922f6fd.js"><link rel="prefetch" href="/assets/js/111.4fa6852b.js"><link rel="prefetch" href="/assets/js/112.5e0c1c97.js"><link rel="prefetch" href="/assets/js/113.5af907d8.js"><link rel="prefetch" href="/assets/js/114.20f5b2ef.js"><link rel="prefetch" href="/assets/js/115.e9ed1b7d.js"><link rel="prefetch" href="/assets/js/116.87448a71.js"><link rel="prefetch" href="/assets/js/117.664f9e24.js"><link rel="prefetch" href="/assets/js/118.c3ad91dc.js"><link rel="prefetch" href="/assets/js/119.fea33d99.js"><link rel="prefetch" href="/assets/js/12.5e6cb236.js"><link rel="prefetch" href="/assets/js/120.99135414.js"><link rel="prefetch" href="/assets/js/121.67431f42.js"><link rel="prefetch" href="/assets/js/122.e5b201e1.js"><link rel="prefetch" href="/assets/js/123.56a8519c.js"><link rel="prefetch" href="/assets/js/124.f46051c7.js"><link rel="prefetch" href="/assets/js/125.d1426c10.js"><link rel="prefetch" href="/assets/js/126.935ac184.js"><link rel="prefetch" href="/assets/js/127.96e995ee.js"><link rel="prefetch" href="/assets/js/128.25122e8b.js"><link rel="prefetch" href="/assets/js/129.d920ab03.js"><link rel="prefetch" href="/assets/js/13.8fb916dd.js"><link rel="prefetch" href="/assets/js/130.f22667b3.js"><link rel="prefetch" href="/assets/js/131.767ff4bc.js"><link rel="prefetch" href="/assets/js/132.8d98b382.js"><link rel="prefetch" href="/assets/js/133.7d094f05.js"><link rel="prefetch" href="/assets/js/134.b0ceb6e3.js"><link rel="prefetch" href="/assets/js/135.f79e660b.js"><link rel="prefetch" href="/assets/js/136.953d769e.js"><link rel="prefetch" href="/assets/js/137.9d5802d2.js"><link rel="prefetch" href="/assets/js/138.8e02fa5c.js"><link rel="prefetch" href="/assets/js/139.b9e91678.js"><link rel="prefetch" href="/assets/js/14.bc1837be.js"><link rel="prefetch" href="/assets/js/140.4699c687.js"><link rel="prefetch" href="/assets/js/141.8eefbbaa.js"><link rel="prefetch" href="/assets/js/142.27d45adb.js"><link rel="prefetch" href="/assets/js/143.f6f923f7.js"><link rel="prefetch" href="/assets/js/144.f14a5230.js"><link rel="prefetch" href="/assets/js/145.2c25c568.js"><link rel="prefetch" href="/assets/js/146.788e90e0.js"><link rel="prefetch" href="/assets/js/147.b3120ee6.js"><link rel="prefetch" href="/assets/js/148.62b7c62a.js"><link rel="prefetch" href="/assets/js/149.a5c5ace4.js"><link rel="prefetch" href="/assets/js/15.bcde294a.js"><link rel="prefetch" href="/assets/js/150.86d0eb3a.js"><link rel="prefetch" href="/assets/js/151.b653d4ff.js"><link rel="prefetch" href="/assets/js/152.0eeee040.js"><link rel="prefetch" href="/assets/js/153.0b7a1da9.js"><link rel="prefetch" href="/assets/js/154.d80a7f08.js"><link rel="prefetch" href="/assets/js/155.4531d3d6.js"><link rel="prefetch" href="/assets/js/156.2f305049.js"><link rel="prefetch" href="/assets/js/157.d2a0fbc5.js"><link rel="prefetch" href="/assets/js/158.6a87dd62.js"><link rel="prefetch" href="/assets/js/159.ce0968fd.js"><link rel="prefetch" href="/assets/js/16.a96da137.js"><link rel="prefetch" href="/assets/js/160.f7508c8f.js"><link rel="prefetch" href="/assets/js/161.91b40a07.js"><link rel="prefetch" href="/assets/js/162.d066159e.js"><link rel="prefetch" href="/assets/js/163.ded50322.js"><link rel="prefetch" href="/assets/js/164.866bec3d.js"><link rel="prefetch" href="/assets/js/165.79580fd7.js"><link rel="prefetch" href="/assets/js/166.b76915c2.js"><link rel="prefetch" href="/assets/js/167.4122b048.js"><link rel="prefetch" href="/assets/js/169.e4cf458b.js"><link rel="prefetch" href="/assets/js/17.329a0167.js"><link rel="prefetch" href="/assets/js/170.055e2f01.js"><link rel="prefetch" href="/assets/js/171.8d1021c2.js"><link rel="prefetch" href="/assets/js/172.979e1d08.js"><link rel="prefetch" href="/assets/js/173.0e5667db.js"><link rel="prefetch" href="/assets/js/174.13df9b11.js"><link rel="prefetch" href="/assets/js/175.b0f8e245.js"><link rel="prefetch" href="/assets/js/176.8011865c.js"><link rel="prefetch" href="/assets/js/177.3c82b4a9.js"><link rel="prefetch" href="/assets/js/178.1427ffad.js"><link rel="prefetch" href="/assets/js/179.9e55fe39.js"><link rel="prefetch" href="/assets/js/18.048038df.js"><link rel="prefetch" href="/assets/js/180.1f316f88.js"><link rel="prefetch" href="/assets/js/181.830e98f1.js"><link rel="prefetch" href="/assets/js/182.807b4423.js"><link rel="prefetch" href="/assets/js/183.56e5d811.js"><link rel="prefetch" href="/assets/js/184.58165fc4.js"><link rel="prefetch" href="/assets/js/185.9eb4fb3e.js"><link rel="prefetch" href="/assets/js/186.801d2024.js"><link rel="prefetch" href="/assets/js/187.0767512b.js"><link rel="prefetch" href="/assets/js/188.860f9aa7.js"><link rel="prefetch" href="/assets/js/189.d849c1c4.js"><link rel="prefetch" href="/assets/js/19.674f919f.js"><link rel="prefetch" href="/assets/js/190.1daa10ee.js"><link rel="prefetch" href="/assets/js/191.467bba3f.js"><link rel="prefetch" href="/assets/js/192.841a56c3.js"><link rel="prefetch" href="/assets/js/193.89bcabec.js"><link rel="prefetch" href="/assets/js/194.e8ded807.js"><link rel="prefetch" href="/assets/js/195.3e7b0617.js"><link rel="prefetch" href="/assets/js/196.95f00ff1.js"><link rel="prefetch" href="/assets/js/197.76d38222.js"><link rel="prefetch" href="/assets/js/198.7e1912e1.js"><link rel="prefetch" href="/assets/js/199.8a7f294d.js"><link rel="prefetch" href="/assets/js/20.56b4d647.js"><link rel="prefetch" href="/assets/js/200.9b1ddc2a.js"><link rel="prefetch" href="/assets/js/201.291b74c8.js"><link rel="prefetch" href="/assets/js/202.15d119a4.js"><link rel="prefetch" href="/assets/js/203.d7d33e0b.js"><link rel="prefetch" href="/assets/js/204.e1ab1070.js"><link rel="prefetch" href="/assets/js/205.c391b268.js"><link rel="prefetch" href="/assets/js/206.bf3b2e92.js"><link rel="prefetch" href="/assets/js/207.754f6593.js"><link rel="prefetch" href="/assets/js/208.6fad6e05.js"><link rel="prefetch" href="/assets/js/209.4afd7509.js"><link rel="prefetch" href="/assets/js/21.60c8872f.js"><link rel="prefetch" href="/assets/js/210.4bd3dbe8.js"><link rel="prefetch" href="/assets/js/211.19a1b42c.js"><link rel="prefetch" href="/assets/js/212.57a1b8c5.js"><link rel="prefetch" href="/assets/js/213.bd4c5274.js"><link rel="prefetch" href="/assets/js/214.8921ec84.js"><link rel="prefetch" href="/assets/js/215.459b1d0e.js"><link rel="prefetch" href="/assets/js/216.aebd6bf1.js"><link rel="prefetch" href="/assets/js/217.dab1470b.js"><link rel="prefetch" href="/assets/js/218.6e059aec.js"><link rel="prefetch" href="/assets/js/219.72054a37.js"><link rel="prefetch" href="/assets/js/22.fdf97007.js"><link rel="prefetch" href="/assets/js/220.7184442c.js"><link rel="prefetch" href="/assets/js/221.afdbe6c1.js"><link rel="prefetch" href="/assets/js/222.eac2b252.js"><link rel="prefetch" href="/assets/js/223.4785e013.js"><link rel="prefetch" href="/assets/js/224.27358d52.js"><link rel="prefetch" href="/assets/js/225.0082a87e.js"><link rel="prefetch" href="/assets/js/226.a6a027b2.js"><link rel="prefetch" href="/assets/js/227.55b58d50.js"><link rel="prefetch" href="/assets/js/228.172efcf6.js"><link rel="prefetch" href="/assets/js/229.d534fb18.js"><link rel="prefetch" href="/assets/js/23.10a156cb.js"><link rel="prefetch" href="/assets/js/230.720d75bc.js"><link rel="prefetch" href="/assets/js/231.7bc7aa8f.js"><link rel="prefetch" href="/assets/js/232.3f9ab0c4.js"><link rel="prefetch" href="/assets/js/233.d74308ce.js"><link rel="prefetch" href="/assets/js/234.dd9ae057.js"><link rel="prefetch" href="/assets/js/235.ec785b6e.js"><link rel="prefetch" href="/assets/js/236.267e73c5.js"><link rel="prefetch" href="/assets/js/237.2e57b470.js"><link rel="prefetch" href="/assets/js/238.3f9da24a.js"><link rel="prefetch" href="/assets/js/239.e03ebe19.js"><link rel="prefetch" href="/assets/js/24.4e04c9e7.js"><link rel="prefetch" href="/assets/js/240.0d490de0.js"><link rel="prefetch" href="/assets/js/241.7505bfb6.js"><link rel="prefetch" href="/assets/js/242.137a5428.js"><link rel="prefetch" href="/assets/js/243.b8914177.js"><link rel="prefetch" href="/assets/js/244.da9e248f.js"><link rel="prefetch" href="/assets/js/245.28437df7.js"><link rel="prefetch" href="/assets/js/246.2c235016.js"><link rel="prefetch" href="/assets/js/247.52676c46.js"><link rel="prefetch" href="/assets/js/248.ece61318.js"><link rel="prefetch" href="/assets/js/249.ff7eccd2.js"><link rel="prefetch" href="/assets/js/25.e17374f9.js"><link rel="prefetch" href="/assets/js/250.dac20dcd.js"><link rel="prefetch" href="/assets/js/251.bc176c68.js"><link rel="prefetch" href="/assets/js/252.279835bc.js"><link rel="prefetch" href="/assets/js/253.7497ddda.js"><link rel="prefetch" href="/assets/js/254.95475930.js"><link rel="prefetch" href="/assets/js/255.02dc3505.js"><link rel="prefetch" href="/assets/js/256.a34c36ad.js"><link rel="prefetch" href="/assets/js/257.67ad6470.js"><link rel="prefetch" href="/assets/js/258.ea2b27b5.js"><link rel="prefetch" href="/assets/js/259.81209387.js"><link rel="prefetch" href="/assets/js/26.34503cad.js"><link rel="prefetch" href="/assets/js/260.024c3f3e.js"><link rel="prefetch" href="/assets/js/261.0df7357d.js"><link rel="prefetch" href="/assets/js/262.4e6da19e.js"><link rel="prefetch" href="/assets/js/263.28548e49.js"><link rel="prefetch" href="/assets/js/264.a711087c.js"><link rel="prefetch" href="/assets/js/265.45b7c9b8.js"><link rel="prefetch" href="/assets/js/266.65ee3594.js"><link rel="prefetch" href="/assets/js/267.4eeefd02.js"><link rel="prefetch" href="/assets/js/268.eb8fffe3.js"><link rel="prefetch" href="/assets/js/269.aa6a90b0.js"><link rel="prefetch" href="/assets/js/27.bd1f04ea.js"><link rel="prefetch" href="/assets/js/270.162a9089.js"><link rel="prefetch" href="/assets/js/271.fc29d223.js"><link rel="prefetch" href="/assets/js/272.0dda0be6.js"><link rel="prefetch" href="/assets/js/273.afc6b167.js"><link rel="prefetch" href="/assets/js/274.e7c546a6.js"><link rel="prefetch" href="/assets/js/275.b978f78e.js"><link rel="prefetch" href="/assets/js/276.43860563.js"><link rel="prefetch" href="/assets/js/277.f2150475.js"><link rel="prefetch" href="/assets/js/278.0941595a.js"><link rel="prefetch" href="/assets/js/279.d943f446.js"><link rel="prefetch" href="/assets/js/28.a709d8a8.js"><link rel="prefetch" href="/assets/js/280.ec13f58e.js"><link rel="prefetch" href="/assets/js/281.4266e436.js"><link rel="prefetch" href="/assets/js/282.56735a7a.js"><link rel="prefetch" href="/assets/js/283.70d7ad21.js"><link rel="prefetch" href="/assets/js/284.3dccddfa.js"><link rel="prefetch" href="/assets/js/285.62b34a26.js"><link rel="prefetch" href="/assets/js/286.cd4c9adf.js"><link rel="prefetch" href="/assets/js/287.e110a68f.js"><link rel="prefetch" href="/assets/js/288.68978e3e.js"><link rel="prefetch" href="/assets/js/289.9f5dcd49.js"><link rel="prefetch" href="/assets/js/29.e2e496dd.js"><link rel="prefetch" href="/assets/js/290.b86da697.js"><link rel="prefetch" href="/assets/js/291.a564a706.js"><link rel="prefetch" href="/assets/js/292.20a8d093.js"><link rel="prefetch" href="/assets/js/293.8f13aa53.js"><link rel="prefetch" href="/assets/js/294.c08ff719.js"><link rel="prefetch" href="/assets/js/295.68af44f0.js"><link rel="prefetch" href="/assets/js/296.62ac2911.js"><link rel="prefetch" href="/assets/js/297.ca51a0df.js"><link rel="prefetch" href="/assets/js/298.fe843a9c.js"><link rel="prefetch" href="/assets/js/299.93f52b75.js"><link rel="prefetch" href="/assets/js/3.256457cb.js"><link rel="prefetch" href="/assets/js/30.55c1d01b.js"><link rel="prefetch" href="/assets/js/300.316522e5.js"><link rel="prefetch" href="/assets/js/301.f99ac528.js"><link rel="prefetch" href="/assets/js/302.b37fa14b.js"><link rel="prefetch" href="/assets/js/303.b7af66cf.js"><link rel="prefetch" href="/assets/js/304.238e8c3b.js"><link rel="prefetch" href="/assets/js/305.3a59f2d0.js"><link rel="prefetch" href="/assets/js/306.03be0708.js"><link rel="prefetch" href="/assets/js/307.45284eb1.js"><link rel="prefetch" href="/assets/js/308.e96d9ca0.js"><link rel="prefetch" href="/assets/js/309.33e5c121.js"><link rel="prefetch" href="/assets/js/31.1f0c8edd.js"><link rel="prefetch" href="/assets/js/32.9e99cdeb.js"><link rel="prefetch" href="/assets/js/33.48c69098.js"><link rel="prefetch" href="/assets/js/34.a6843d71.js"><link rel="prefetch" href="/assets/js/35.7688e566.js"><link rel="prefetch" href="/assets/js/36.ac72cc70.js"><link rel="prefetch" href="/assets/js/37.1e25ed4a.js"><link rel="prefetch" href="/assets/js/38.a3765157.js"><link rel="prefetch" href="/assets/js/39.962392a9.js"><link rel="prefetch" href="/assets/js/4.8e736c7d.js"><link rel="prefetch" href="/assets/js/40.bc83f81b.js"><link rel="prefetch" href="/assets/js/41.1951766e.js"><link rel="prefetch" href="/assets/js/42.39113478.js"><link rel="prefetch" href="/assets/js/43.37c5c2be.js"><link rel="prefetch" href="/assets/js/44.d2b1f9dd.js"><link rel="prefetch" href="/assets/js/45.720c7121.js"><link rel="prefetch" href="/assets/js/46.30d1fc2a.js"><link rel="prefetch" href="/assets/js/47.3e6a5e18.js"><link rel="prefetch" href="/assets/js/48.2cb1bcdf.js"><link rel="prefetch" href="/assets/js/49.dc40f4fe.js"><link rel="prefetch" href="/assets/js/5.bedf66e3.js"><link rel="prefetch" href="/assets/js/50.004e7368.js"><link rel="prefetch" href="/assets/js/51.96480463.js"><link rel="prefetch" href="/assets/js/52.8171064f.js"><link rel="prefetch" href="/assets/js/53.aeabf1b7.js"><link rel="prefetch" href="/assets/js/54.a69a5494.js"><link rel="prefetch" href="/assets/js/55.4e3362b8.js"><link rel="prefetch" href="/assets/js/56.cf00203d.js"><link rel="prefetch" href="/assets/js/57.7dad9f05.js"><link rel="prefetch" href="/assets/js/58.5a599aa3.js"><link rel="prefetch" href="/assets/js/59.7a41d4ec.js"><link rel="prefetch" href="/assets/js/6.aa30f1b7.js"><link rel="prefetch" href="/assets/js/60.743bc681.js"><link rel="prefetch" href="/assets/js/61.30370304.js"><link rel="prefetch" href="/assets/js/62.1880bf44.js"><link rel="prefetch" href="/assets/js/63.625ede55.js"><link rel="prefetch" href="/assets/js/64.a0e699b3.js"><link rel="prefetch" href="/assets/js/65.1332e799.js"><link rel="prefetch" href="/assets/js/66.bf13ff4e.js"><link rel="prefetch" href="/assets/js/67.b1f02878.js"><link rel="prefetch" href="/assets/js/68.d9e97dc1.js"><link rel="prefetch" href="/assets/js/69.5fc5d0ad.js"><link rel="prefetch" href="/assets/js/7.b3b653a5.js"><link rel="prefetch" href="/assets/js/70.f0695449.js"><link rel="prefetch" href="/assets/js/71.f3df3763.js"><link rel="prefetch" href="/assets/js/72.ab0393fe.js"><link rel="prefetch" href="/assets/js/73.dc1ad4a0.js"><link rel="prefetch" href="/assets/js/74.98ea0207.js"><link rel="prefetch" href="/assets/js/75.75a79389.js"><link rel="prefetch" href="/assets/js/76.7b07f2b0.js"><link rel="prefetch" href="/assets/js/77.517e9335.js"><link rel="prefetch" href="/assets/js/78.90d5b20d.js"><link rel="prefetch" href="/assets/js/79.a2fdc1e8.js"><link rel="prefetch" href="/assets/js/8.e41b72a1.js"><link rel="prefetch" href="/assets/js/80.ce3db513.js"><link rel="prefetch" href="/assets/js/81.e9f26768.js"><link rel="prefetch" href="/assets/js/82.6ae00170.js"><link rel="prefetch" href="/assets/js/83.0a300de3.js"><link rel="prefetch" href="/assets/js/84.7f61b37c.js"><link rel="prefetch" href="/assets/js/85.52c4f70c.js"><link rel="prefetch" href="/assets/js/86.bb2b54e2.js"><link rel="prefetch" href="/assets/js/87.9632dc47.js"><link rel="prefetch" href="/assets/js/88.5736b64f.js"><link rel="prefetch" href="/assets/js/89.113520f8.js"><link rel="prefetch" href="/assets/js/9.72f4cc05.js"><link rel="prefetch" href="/assets/js/90.809eed5c.js"><link rel="prefetch" href="/assets/js/91.db653d35.js"><link rel="prefetch" href="/assets/js/92.f1c7d0c5.js"><link rel="prefetch" href="/assets/js/93.fabbd55d.js"><link rel="prefetch" href="/assets/js/94.951a8287.js"><link rel="prefetch" href="/assets/js/95.6b89432f.js"><link rel="prefetch" href="/assets/js/96.ab0e2ef7.js"><link rel="prefetch" href="/assets/js/97.bb53d2e5.js"><link rel="prefetch" href="/assets/js/98.16ee1d21.js"><link rel="prefetch" href="/assets/js/99.9b4ae87d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6732922a.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/EB-logo.png" alt="xiongmao's blog" class="logo"> <span class="site-name can-hide">xiongmao's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><a href="/Operation/" class="link-title">运维</a> <span class="title" style="display:none;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>linux运维</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/nginx/" class="nav-link">nginx</a></li><li class="dropdown-subitem"><a href="/note/docker/" class="nav-link">docker</a></li><li class="dropdown-subitem"><a href="/note/elk/" class="nav-link">elk</a></li><li class="dropdown-subitem"><a href="/note/jenkins/" class="nav-link">jenkins</a></li><li class="dropdown-subitem"><a href="/note/jumpserver/" class="nav-link">jumpserver</a></li><li class="dropdown-subitem"><a href="/note/K8S/" class="nav-link">K8S</a></li><li class="dropdown-subitem"><a href="/note/linux/" class="nav-link">linux系统</a></li><li class="dropdown-subitem"><a href="/note/mysql/" class="nav-link">mysql</a></li><li class="dropdown-subitem"><a href="/note/ceph/" class="nav-link">ceph</a></li><li class="dropdown-subitem"><a href="/note/Prometheus/" class="nav-link">Prometheus</a></li><li class="dropdown-subitem"><a href="/note/redis/" class="nav-link">redis</a></li><li class="dropdown-subitem"><a href="/note/tomcat/" class="nav-link">tomcat</a></li><li class="dropdown-subitem"><a href="/note/zabbix/" class="nav-link">zabbix</a></li><li class="dropdown-subitem"><a href="/note/zookeeper/" class="nav-link">zookeeper</a></li><li class="dropdown-subitem"><a href="/note/KVM/" class="nav-link">KVM</a></li><li class="dropdown-subitem"><a href="/note/ansible/" class="nav-link">ansible</a></li></ul></li><li class="dropdown-item"><h4>网络运维</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/网络知识/" class="nav-link">网络知识</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><a href="/Develop/" class="link-title">开发</a> <span class="title" style="display:none;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/python/" class="nav-link">python</a></li><li class="dropdown-item"><!----> <a href="/note/shell/" class="nav-link">shell</a></li><li class="dropdown-item"><!----> <a href="/note/go/" class="nav-link">go</a></li></ul></div></div><div class="nav-item"><a href="/more/" class="nav-link">踩坑</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/pages/beb6c0bd8a66cea6/" class="nav-link">网站</a></li><li class="dropdown-item"><!----> <a href="/pages/beb6c0bd8a66cea61/" class="nav-link">葵花宝典</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="/friends/" class="nav-link">友情链接</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/lzq70112/lzq70112.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/20200615022410.png"> <div class="blogger-info"><h3>胸毛君</h3> <span>运维界的小学生</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><a href="/Operation/" class="link-title">运维</a> <span class="title" style="display:none;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>linux运维</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/nginx/" class="nav-link">nginx</a></li><li class="dropdown-subitem"><a href="/note/docker/" class="nav-link">docker</a></li><li class="dropdown-subitem"><a href="/note/elk/" class="nav-link">elk</a></li><li class="dropdown-subitem"><a href="/note/jenkins/" class="nav-link">jenkins</a></li><li class="dropdown-subitem"><a href="/note/jumpserver/" class="nav-link">jumpserver</a></li><li class="dropdown-subitem"><a href="/note/K8S/" class="nav-link">K8S</a></li><li class="dropdown-subitem"><a href="/note/linux/" class="nav-link">linux系统</a></li><li class="dropdown-subitem"><a href="/note/mysql/" class="nav-link">mysql</a></li><li class="dropdown-subitem"><a href="/note/ceph/" class="nav-link">ceph</a></li><li class="dropdown-subitem"><a href="/note/Prometheus/" class="nav-link">Prometheus</a></li><li class="dropdown-subitem"><a href="/note/redis/" class="nav-link">redis</a></li><li class="dropdown-subitem"><a href="/note/tomcat/" class="nav-link">tomcat</a></li><li class="dropdown-subitem"><a href="/note/zabbix/" class="nav-link">zabbix</a></li><li class="dropdown-subitem"><a href="/note/zookeeper/" class="nav-link">zookeeper</a></li><li class="dropdown-subitem"><a href="/note/KVM/" class="nav-link">KVM</a></li><li class="dropdown-subitem"><a href="/note/ansible/" class="nav-link">ansible</a></li></ul></li><li class="dropdown-item"><h4>网络运维</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/网络知识/" class="nav-link">网络知识</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><a href="/Develop/" class="link-title">开发</a> <span class="title" style="display:none;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/python/" class="nav-link">python</a></li><li class="dropdown-item"><!----> <a href="/note/shell/" class="nav-link">shell</a></li><li class="dropdown-item"><!----> <a href="/note/go/" class="nav-link">go</a></li></ul></div></div><div class="nav-item"><a href="/more/" class="nav-link">踩坑</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/pages/beb6c0bd8a66cea6/" class="nav-link">网站</a></li><li class="dropdown-item"><!----> <a href="/pages/beb6c0bd8a66cea61/" class="nav-link">葵花宝典</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="/friends/" class="nav-link">友情链接</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/lzq70112/lzq70112.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/b5e11111/" class="sidebar-link">Prometheus的原理及安装</a></li><li><a href="/pages/b5e11113/" class="sidebar-link">Prometheus监控集群应用</a></li><li><a href="/pages/1234/" class="sidebar-link">Prometheus集群监控</a></li><li><a href="/pages/b5e11114/" class="sidebar-link">Prometheus监控常用资源对象</a></li><li><a href="/pages/b5e111199/" aria-current="page" class="active sidebar-link">Grafana安装与使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/b5e111199/#_1、安装" class="sidebar-link">1、安装</a></li><li class="sidebar-sub-header"><a href="/pages/b5e111199/#_2、devopsprodigy-kubegraf插件" class="sidebar-link">2、DevOpsProdigy KubeGraf插件</a></li><li class="sidebar-sub-header"><a href="/pages/b5e111199/#_3、导入-dashboard" class="sidebar-link">3、导入 Dashboard</a></li><li class="sidebar-sub-header"><a href="/pages/b5e111199/#_4、自定义图表" class="sidebar-link">4、自定义图表</a></li></ul></li><li><a href="/pages/b5e11115/" class="sidebar-link">PromQL的语法及使用</a></li><li><a href="/pages/b5e11116/" class="sidebar-link">Prometheus之Alertmanager的安装使用</a></li><li><a href="/pages/b5e11117/" class="sidebar-link">Prometheus之Operator安装及使用</a></li><li><a href="/pages/Prometheus1000/" class="sidebar-link">Prometheus之rules大全</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><a href="/categories/?category=%E3%80%8APrometheus%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0" title="分类" data-v-0c557b5e>《Prometheus》学习笔记</a></li></ul> <div class="info" data-v-0c557b5e><div title="作者" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="https://github.com/lzq7012" target="_blank" title="作者" class="beLink" data-v-0c557b5e>xiongmao</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2021-09-08</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Grafana安装与使用<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p>Grafana安装与使用</p> <p>前面我们使用 Prometheus 采集了 Kubernetes 集群中的一些监控数据指标，尝试使用 promQL 语句查询出了一些数据，并且在 Prometheus 的 Dashboard 中进行了展示，但是明显可以感觉到 Prometheus 的图表功能相对较弱，所以一般情况下会一个第三方的工具来展示这些数据，使用到的就是 <a href="http://grafana.com/" target="_blank" rel="noopener noreferrer">Grafana<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>Grafana 是一个可视化面板，有着非常漂亮的图表和布局展示，功能齐全的度量仪表盘和图形编辑器，支持 Graphite、zabbix、InfluxDB、Prometheus、OpenTSDB、Elasticsearch 等作为数据源，比 Prometheus 自带的图表展示功能强大太多，更加灵活，有丰富的插件，功能更加强大。</p> <h2 id="_1、安装"><a href="#_1、安装" class="header-anchor">#</a> 1、安装</h2> <p>同样的我们将 grafana 安装到 Kubernetes 集群中，第一步去查看 grafana 的 docker 镜像的介绍，我们可以在 dockerhub 上去搜索，也可以在官网去查看相关资料，镜像地址如下：https://hub.docker.com/r/grafana/grafana/，我们可以看到介绍中运行 grafana 容器的命令非常简单：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run -d --name<span class="token operator">=</span>grafana -p <span class="token number">3000</span>:3000 grafana/grafana
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但是还有一个需要注意的是 Changelog 中v5.1.0版本的更新介绍：</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>Major restructuring of the container
Usage of chown removed
File permissions incompatibility with previous versions
user id changed from 104 to 472
group id changed from 107 to 472
Runs as the grafana user by default (instead of root)
All default volumes removed</p></div> <p>特别需要注意第3条</p> <p>userid 和 groupid 都有所变化，所以我们在运行的容器的时候需要注意这个变化。现在我们将这个容器转化成 Kubernetes 中的 Pod：</p> <p><code>grafana.yaml</code></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> grafana
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>ops
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> grafana
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> grafana
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> storage
        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /data/k8s/grafana/
          <span class="token comment"># 本地持久化不是很建议</span>
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">kubernetes.io/hostname</span><span class="token punctuation">:</span> node2
      <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
        <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> grafana
        <span class="token key atrule">image</span><span class="token punctuation">:</span> grafana/grafana<span class="token punctuation">:</span>7.4.3
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">3000</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> grafana
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> GF_SECURITY_ADMIN_USER
          <span class="token key atrule">value</span><span class="token punctuation">:</span> admin
          <span class="token comment"># 账号</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> GF_SECURITY_ADMIN_PASSWORD
          <span class="token key atrule">value</span><span class="token punctuation">:</span> admin321
          <span class="token comment"># 密码</span>
        <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
            <span class="token key atrule">path</span><span class="token punctuation">:</span> /api/health
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3000</span>
            <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTP
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">60</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
        <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>
          <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
            <span class="token key atrule">path</span><span class="token punctuation">:</span> /api/health
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3000</span>
            <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTP
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">1</span>
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 150m
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 512Mi
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 150m
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 512Mi
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/lib/grafana
          <span class="token key atrule">name</span><span class="token punctuation">:</span> storage
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> grafana
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>ops
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3000</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> grafana
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><p>我们使用了最新的镜像 <code>grafana/grafana:7.4.3</code>，然后添加了健康检查、资源声明，另外两个比较重要的环境变量<code>GF_SECURITY_ADMIN_USER</code> 和 <code>GF_SECURITY_ADMIN_PASSWORD</code>，用来配置 grafana 的管理员用户和密码的，由于 grafana 将 dashboard、插件这些数据保存在 <code>/var/lib/grafana</code> 这个目录下面的，所以我们这里如果需要做数据持久化的话，就需要针对这个目录进行 volume 挂载声明，和 Prometheus 一样，我们将 grafana 固定在一个具有 <code>kubernetes.io/hostname=node2</code> 标签的节点，</p> <p>由于上面我们刚刚提到的 Changelog 中 grafana 的 userid 和 groupid 有所变化，所以我们这里增加一个 <code>securityContext</code> 的声明来进行声明使用 root 用户运行。最后，我们需要对外暴露 grafana 这个服务，所以我们需要一个对应的 Service 对象，当然用 NodePort 或者再建立一个 ingress 对象都是可行的。</p> <p>现在我们直接创建上面的这些资源对象：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl apply -f grafana.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建完成后，我们可以查看 grafana 对应的 Pod 是否正常：</p> <p><code>kubectl get pods -n kube-ops -l app=grafana</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>NAME                       READY   STATUS    RESTARTS   AGE
grafana-5df69dd8b9-rl6gp   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          6m25s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>kubectl logs -f grafana-5df69dd8b9-rl6gp -n kube-ops</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token assign-left variable">logger</span><span class="token operator">=</span>settings <span class="token assign-left variable">var</span><span class="token operator">=</span><span class="token string">&quot;GF_SECURITY_ADMIN_USER=admin&quot;</span>
<span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">2019</span>-12-13T06:35:08+0000 <span class="token assign-left variable">lvl</span><span class="token operator">=</span>info <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;Config overridden from Environment variable&quot;</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">2019</span>-12-13T06:35:08+0000 <span class="token assign-left variable">lvl</span><span class="token operator">=</span>info <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;Initializing Stream Manager&quot;</span>
<span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token number">2019</span>-12-13T06:35:08+0000 <span class="token assign-left variable">lvl</span><span class="token operator">=</span>info <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;HTTP Server Listen&quot;</span> <span class="token assign-left variable">logger</span><span class="token operator">=</span>http.server <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token punctuation">[</span>::<span class="token punctuation">]</span>:3000 <span class="token assign-left variable">protocol</span><span class="token operator">=</span>http <span class="token assign-left variable">subUrl</span><span class="token operator">=</span> <span class="token assign-left variable">socket</span><span class="token operator">=</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>看到上面的日志信息就证明我们的 grafana 的 Pod 已经正常启动起来了。这个时候我们可以查看 Service 对象：</p> <p><code>kubectl get svc -n kube-ops</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>             AGE
grafana      NodePort    <span class="token number">10.68</span>.58.174   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">3000</span>:14845/TCP      12m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>现在我们就可以在浏览器中使用 <code>http://&lt;任意节点IP:14845&gt;</code> 来访问 grafana 这个服务了：</p> <p>上面定义的账号密码</p> <p>admin</p> <p>admin321</p> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/20210304170632.png" alt="grafana login"></p> <p>由于上面我们配置了管理员的，所以第一次打开的时候会跳转到登录界面，然后就可以用上面我们配置的两个环境变量的值来进行登录了，登录完成后就可以进入到下面 Grafana 的首页，然后点击<code>Add data source</code>进入添加数据源界面。</p> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/image-20211003004858775.png" alt="image-20211003004858775"></p> <p>我们这个地方配置的数据源是 <code>Prometheus</code>，我们这里 Prometheus 和 Grafana 都处于 kube-ops 这同一个 namespace 下面，所以我们这里的数据源地址：<code>http://prometheus:9090</code>（因为在同一个 namespace 下面所以直接用 Service 名也可以），然后其他的配置信息就根据实际情况了，比如 Auth 认证，我们这里没有，所以跳过即可，点击最下方的 <code>Save &amp; Test</code> 提示成功证明我们的数据源配置正确：</p> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/20210304170841.png" alt="grafana prometheus datasource"></p> <h2 id="_2、devopsprodigy-kubegraf插件"><a href="#_2、devopsprodigy-kubegraf插件" class="header-anchor">#</a> 2、DevOpsProdigy KubeGraf插件</h2> <p>我们也可以安装一些其他插件，比如 grafana 就有一个专门针对 Kubernetes 集群监控的插件：<a href="https://grafana.com/plugins/grafana-kubernetes-app" target="_blank" rel="noopener noreferrer">grafana-kubernetes-app<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，介绍一个功能更加强大的插件 <a href="https://github.com/devopsprodigy/kubegraf/" target="_blank" rel="noopener noreferrer">DevOpsProdigy KubeGraf<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，它是 Grafana 官方的 <a href="https://grafana.com/plugins/grafana-kubernetes-app" target="_blank" rel="noopener noreferrer">Kubernetes 插件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的升级版本，该插件可以用来可视化和分析 Kubernetes 集群的性能，通过各种图形直观的展示了 Kubernetes 集群的主要服务的指标和特征，还可以用于检查应用程序的生命周期和错误日志。</p> <p>要安装这个插件，需要到 grafana 的 Pod 里面去执行安装命令：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl <span class="token builtin class-name">exec</span> -it grafana-5df69dd8b9-rl6gp -n kube-ops /bin/bash <span class="token comment">#进入容器进行安装</span>
bash-5.0<span class="token comment"># grafana-cli plugins install devopsprodigy-kubegraf-app #执行命令</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>installing devopsprodigy-kubegraf-app @ <span class="token number">1.5</span>.2
from: https://grafana.com/api/plugins/devopsprodigy-kubegraf-app/versions/1.5.2/download
into: /var/lib/grafana/plugins

✔ Installed devopsprodigy-kubegraf-app successfully 
installing grafana-piechart-panel @ <span class="token number">1.6</span>.2
from: https://grafana.com/api/plugins/grafana-piechart-panel/versions/1.6.2/download
into: /var/lib/grafana/plugins

✔ Installed grafana-piechart-panel successfully 
Installed dependency: grafana-piechart-panel ✔
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>安装完成后需要重启 grafana 才会生效，pod没有service命令，我们这里直接删除 Pod，重建即可。</p> <p>Pod 删除重建完成后插件就安装成功了。然后通过浏览器打开 Grafana 找到该插件，点击 <code>enable</code> 启用插件。</p> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/image-20211003010802858.png" alt="image-20211003010802858"></p> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/20210304171214.png" alt="enable plugin"></p> <p>点击 <code>Set up your first k8s-cluster</code> 创建一个新的 Kubernetes 集群:</p> <ul><li>URL 使用 Kubernetes Service 地址即可：https://kubernetes.default:443</li> <li>Access 访问模式使用：<code>Server(default)</code></li> <li>由于插件访问 Kubernetes 集群的各种资源对象信息，所以我们需要配置访问权限，这里我们可以简单使用 kubectl 的 <code>kubeconfig</code> 来进行配置即可。</li> <li>勾选 Auth 下面的 <code>TLS Client Auth</code> 和 <code>With CA Cert</code> 两个选项</li> <li>其中 <code>TLS Auth Details</code> 下面的值就对应 <code>kubeconfig</code> 里面的证书信息。比如我们这里的 <code>kubeconfig</code> 文件格式如下所示：</li></ul> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># ~/.kube/config</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">clusters</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span>
    <span class="token key atrule">certificate-authority-data</span><span class="token punctuation">:</span> LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUR1RENDQXFDZ0F3SUJBZ0lVSDB4UFpCOU9wZWd3a3pTUm5YaW5JaUpjRVQ0d0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qRXdPREl3TVRrd01EQXdXaGdQTWpFeU1UQTNNamN4T1RBd01EQmFNR0V4Q3pBSkJnTlYKQkFZVEFrTk9NUkV3RHdZRFZRUUlFd2hJWVc1bldtaHZkVEVMTUFrR0ExVUVCeE1DV0ZNeEREQUtCZ05WQkFvVApBMnM0Y3pFUE1BMEdBMVVFQ3hNR1UzbHpkR1Z0TVJNd0VRWURWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhzMGp1MVIzK2FaSGNRVWtTU0VqTGl3MGNTeUQKQ0d5RnQ5bXc2K0paaG9hOTNXTWJXNkU5a2Y2c0NsWHdyUDhCdHczZlNObThhc2dLTGcxdDliWEJvWlIyUWlyVAo0VVdvZlZiYS9LZjNCRkZwRFptTklyMi9sNnZpcERnTTMwMW4vTytyUjJkQmdCZDREUmJBSVNLckxpMHhHTElnCmVEQXRieTdGNEFZZmVoTVNLcXlMVTNYVk1vRTY3RzR0MGY3TzlCUW11TzJuNTFWT0U0NURaT2E1OXFkbW1rT3oKRmV3WkswV2xSTTEzZHE3MkRVVzVMeVR3ay9wOWpzbDQ0czI4Smw1OG51bW9Jazl6R2E0MWgwS1AwYWpFWlhjYwpwWmM5T3VOaHNpbGhQZGtNRytQOXFLZVplSDQ3M1U3TGE5dXhCYytpdEpUeER0M3c0alFvNTBLYXp3SURBUUFCCm8yWXdaREFPQmdOVkhROEJBZjhFQkFNQ0FRWXdFZ1lEVlIwVEFRSC9CQWd3QmdFQi93SUJBakFkQmdOVkhRNEUKRmdRVWh5eUFkWHQvQXZ5Z2tKeFJ3WFpoQ3R1cVRlQXdId1lEVlIwakJCZ3dGb0FVaHl5QWRYdC9Bdnlna0p4Ugp3WFpoQ3R1cVRlQXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBSm1TUDk4OFl3ZHFGVTUyRm1xTVhhZ1hiTTFxCmNCMkx4YkZtVVVWOFZ4akl5WHlpUytPYVlvb0VybjRzWEVKcXkwUDAwdHcyUlVrb0RLM2VmdnFIQy9vdXZteWcKemlkOXkreStwMlYrbzdnbEhtVWVNR1VJaXMvOTczQ0h6ZDRoWlVsdGV2ZmpEeTFXZVVpRnAzZVVqb1U2NHlsVwpHZW9nY3puSDlOOEZobWNYSFVyRzdLZUhMZHFGRHVkSG1XNTd4TVdnVS9tQ3BjRE05S1AwSU8yQ0gyMkt0aHNHCm0yZnFLRFU1aW4zd2t3RmZwb0p6dDkzOVNMajk3bUk2N0FJaFIwSDB1R3l3ZE5NZTBNZnZQV2IxbVRBeWd3bGgKMlZ4bS92c2dQZ09jUURyRWZMajFVQThqZUQ2T0Z2aHcvY1Z1Ti9IR0p4NlVEaXNCT3ZzeTdYeXREK0E9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    <span class="token key atrule">server</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//192.168.2.22<span class="token punctuation">:</span><span class="token number">6443</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cluster1
<span class="token key atrule">contexts</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">context</span><span class="token punctuation">:</span>
    <span class="token key atrule">cluster</span><span class="token punctuation">:</span> cluster1
    <span class="token key atrule">user</span><span class="token punctuation">:</span> admin
  <span class="token key atrule">name</span><span class="token punctuation">:</span> context<span class="token punctuation">-</span>cluster1
<span class="token key atrule">current-context</span><span class="token punctuation">:</span> context<span class="token punctuation">-</span>cluster1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Config
<span class="token key atrule">preferences</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token key atrule">users</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> admin
  <span class="token key atrule">user</span><span class="token punctuation">:</span>
    <span class="token key atrule">client-certificate-data</span><span class="token punctuation">:</span> LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQxekNDQXIrZ0F3SUJBZ0lVVmR1VEZ2YytBcVZWakdZQXBVWmRKMnpYSUE0d0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qRXdPREl3TVRreE1EQXdXaGdQTWpBM01UQTRNRGd4T1RFd01EQmFNR2N4Q3pBSkJnTlYKQkFZVEFrTk9NUkV3RHdZRFZRUUlFd2hJWVc1bldtaHZkVEVMTUFrR0ExVUVCeE1DV0ZNeEZ6QVZCZ05WQkFvVApEbk41YzNSbGJUcHRZWE4wWlhKek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweERqQU1CZ05WQkFNVEJXRmtiV2x1Ck1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBMDJOY0RROTVlWmM5NjFVUjVrUVMKS1pWbVlYOG51RVhWZEVQTlNQOW9qbGp6ekVqSkxWZ0hHa1V5NDZFREhYKzdJc0RjLzlqTlJXSnhxQ3hUalM2QQoyUlJOQXBaaXl3ZVpzSDIzN09zbFk2b0hnSDNJUHdrSW9jaE52NmJ4U0p4eHpJQ0lBNHNJZmV3VC9Edm45VTJGCkhSWG1LaVJObnp6VDBOS0pmMWpyNThZRUpVYW5OQ0NXVVExYUF5a3M1VjhJVDJqTUwrZG1rTXJCRitLcStERHQKbFRKTVY3eWEva1cvRXFialdTbmFPeGhZSkwvZzB4LzVDemV6KzhHUVdsSVFadjBMUFRZOWZaM2Vrd2VjQXJhYQpBUGpGRkZBU2JvMndybU5TL243eENjT01kWjJrdDNKUUFuQjl0MnIxSFoxeXRYQTdUWFVscnMxTnVZaTVOb2tFCjh3SURBUUFCbzM4d2ZUQU9CZ05WSFE4QkFmOEVCQU1DQmFBd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3RUcKQ0NzR0FRVUZCd01DTUF3R0ExVWRFd0VCL3dRQ01BQXdIUVlEVlIwT0JCWUVGSlB0OHNINkEyZVFnU0g2bGd4RAprVDkwckdEZU1COEdBMVVkSXdRWU1CYUFGSWNzZ0hWN2Z3TDhvSkNjVWNGMllRcmJxazNnTUEwR0NTcUdTSWIzCkRRRUJDd1VBQTRJQkFRQjlOZDI5NGY3UTlTRjlWQ2s3MFgrUXNDQnJxdXRRTGQxUU5mNFFPR0VkdUtNRVRGQWIKRjNIS1g3aWxLaG9mdElUTXozRDlsNjJjdGZXMW1rUEFtVW9ZcEhkTXZ4R0RrT1Bxb1kzZm9neXgvcmFPRm9WWQorVG05dE5zV1ZPdjVLU1NWclYxR1NVaHBqRDdoc3htbE1PckxGT0xZNExjMHAxWUs5R0FLZE9CRW9uL09QK3pSCkZBaE96bEtwV2lFbFZCd29jVnIzQVRVaTM4SXdXcG9uVExCcDdvR0h6MFdyc1hDSmp4Nm5jU1V6dUtSVEZzNWgKdXhDOUZxam5OcGVlYTRHNFFWTnA2OHIzdkg5dDNFZGxDbEYvblBCcHZKakdkR2V6dmozZjFvRndlVm9ORXpsWApHSy9SdzR2MXBHdS9jZVh0UktjUUx4dzZ1ckt4Wmd0K3UxZjIKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    <span class="token key atrule">client-key-data</span><span class="token punctuation">:</span> LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBMDJOY0RROTVlWmM5NjFVUjVrUVNLWlZtWVg4bnVFWFZkRVBOU1A5b2psanp6RWpKCkxWZ0hHa1V5NDZFREhYKzdJc0RjLzlqTlJXSnhxQ3hUalM2QTJSUk5BcFppeXdlWnNIMjM3T3NsWTZvSGdIM0kKUHdrSW9jaE52NmJ4U0p4eHpJQ0lBNHNJZmV3VC9Edm45VTJGSFJYbUtpUk5uenpUME5LSmYxanI1OFlFSlVhbgpOQ0NXVVExYUF5a3M1VjhJVDJqTUwrZG1rTXJCRitLcStERHRsVEpNVjd5YS9rVy9FcWJqV1NuYU94aFlKTC9nCjB4LzVDemV6KzhHUVdsSVFadjBMUFRZOWZaM2Vrd2VjQXJhYUFQakZGRkFTYm8yd3JtTlMvbjd4Q2NPTWRaMmsKdDNKUUFuQjl0MnIxSFoxeXRYQTdUWFVscnMxTnVZaTVOb2tFOHdJREFRQUJBb0lCQUJuVk5hV2U4NEJwZkRhcgpNY0hMSmRFUkllN2VSRE5meldNaytneG1zaGRiUllmOGlTRlNkYU8vT3lYWVFuSXpidUlqWVo2ZWx3OVlwWDBnCjFhRVdRc2JFbFZpd21pZ25xSitKN1pVMWMxOUhveDBQd2czNkE2VUp2bjZpWHpBNWRpckF0bDZBZWl3eFVvdnIKb2tBM0ZnSms3N2pNc1BPNTBrVGR4ZEhiUXhFU3grSjBLUlFaZGN0TzB5NVdYNGVMdkhxN21VazF4K1NKOWFVeApYUktvZXVFNkZrV3lvM0Q1YmN5Y3dMQWI0YThLRS9aZ1BYWG1WVFhFRktVWlNpVlVNdlA3eklRTWg0NVlXWTV4CktKTGxpQS9ONTY3S0tSZFpSY1ZkU3A3UXVnMW12amlzN01YZnZPdGlKQTUxeEladDltYmh4TmVDOG9xUkJucFoKTHFQTjZwRUNnWUVBMkRwRnAwekR2S2UwaHJuZzJ3R3VBZGpwUEJPeFZKamMyUUR0SHoxZktlNDdlN0ZacHV3VgpDS3NzZ2N6anY3cTEvVUc0K0VkSXoxRGVJSGJ1MDVQZ1VmK0plUGhINTlnT1V2VGRtdUVVTDJVSVp4YThkZG1pCjVHUWdPYk1aUi9HUVg0MnVHdnhkRHQwUlRPQnQvVHo5OEN2ckFMUk5SdGhMQ004VU91cCtSanNDZ1lFQStrVTAKZWdleGJqU3d2aWNnajVVbHVhTm52OFpTV3VaeklIZ3BXZDE3a20vYjh3U212cU82Q1lxV3dXbWJTMWhYUTNGVApEVXpvN25ha0NoRlcxa05BdTkrRUxUeGMrWWZGODRvaHVhaDBsTktwbFV4UEhkUDRlWXY2YWI2ZHl5b0Nxb0xrCmh5NGE4MStqN201b1RkS0xGeHhyOUVTMnB2TEhaKys5YjRlemVLa0NnWUVBdzBZTTlZUDhHWG9UTE1EZGNxdlgKcTg5ckExaDlnM3J4cUFDUUpQQlY2eFk5SGY0U2l3OFdCOWdldjdKNzFBRVlyZmtXeFJJTGpUN28rOFNzOXVMTAphUUl2OHRHMmpvaXVsdmlRMFhpSHRDMjRJdkdEamFMWTJ3NFpsRUpNaUk1OTVlMmIyTDhrZzNIZVYrRXZNODVMClB3VktuRDQ0czh4T0oweHNackN6RFZVQ2dZQnNRUnNkM2M0RjJZeko4NnJGOE1ITXRyM2QyaTh0V3BsWjVpQWMKMnd6a25yWUpQRzNUOElZOE1sSmJmdzdKWElFQ2p6WlpmbmNURHdhTnhFcEhpL2VvVEZxa0pvUWcrM1hJam10ZwpIMW11TmlGY2p4RjUyWUtWTU5NMGdsdEcwZmt0UUVrUm9BUFFXZ0pTMURjUjBveVBocCs3blMxVXNaZEhnZy95CitrUExZUUtCZ1FDM3J2OHZpMnpuZldVK1UxcU5obWpUemx5NkJTNnRRcXd0SmZZMHdSR0QvMjBmSlQvQ29WZlYKYm1IR0lPMU9Wb0hwc3JQMytTOEhoczhpU0diM3M4MFlIeStTMGZyeHdxVktwcng3WkRXQkRhTDNhbTBFWklVTApMQ29XaTVDelNVNjJmNVZXL2NFcXU4SWVtS1NKaERsSTkwUmI5MGUwbGl5N010QWpURUZZcmc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><code>kubeconfig</code> 的值</p> <ul><li><p><code>CA Cert</code> 的值就对应 <code>kubeconfig</code> 里面的 <code>&lt;certificate-authority-data&gt;</code> 进行 base64 解码过后的值</p></li> <li><p><code>Client Cert</code> 的值对应 <code>&lt;client-certificate-data&gt;</code> 进行 base64 解码过后的值；</p></li> <li><p><code>Client Key</code> 的值就对应 <code>&lt;client-key-data&gt;</code> 进行 base64 解码过后的值。</p></li></ul> <p>base64 解码</p> <p>对于 base64 解码推荐使用一些在线的服务，比如 <a href="https://www.base64decode.org/" target="_blank" rel="noopener noreferrer">https://www.base64decode.org<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，非常方便。</p> <ul><li>最后在 <code>additional datasources</code> 下拉列表中选择 prometheus 的数据源。</li> <li>点击 <code>Save &amp; Test</code> 正常就可以保存成功了。</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/image-20211003013043196.png" alt="image-20211003013043196"></p> <p>如果报错<strong>502 Bad Gateway</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/image-20211003083113244.png" alt="image-20211003083113244"></p> <p>插件配置完成后，在左侧侧边栏就会出现 <code>DevOpsProdigy KubeGraf</code> 插件的入口，通过插件页面可以查看整个集群的状态。</p> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/image-20211003083426141.png" alt="image-20211003083426141"></p> <p>还有几个漂亮的 Dashboard 可以供我们来进行监控图表的展示：</p> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/20210304171942.png" alt="KubeGraf Dashboard"></p> <h2 id="_3、导入-dashboard"><a href="#_3、导入-dashboard" class="header-anchor">#</a> 3、导入 Dashboard</h2> <p>为了能够快速对系统进行监控，我们可以直接复用别人的 Grafana Dashboard，在 Grafana 的官方网站上就有很多非常优秀的第三方 Dashboard，我们完全可以直接导入进来即可。比如我们想要对所有的集群节点进行监控，也就是 node-exporter 采集的数据进行展示，这里我们就可以导入 https://grafana.com/grafana/dashboards/8919 这个 Dashboard。</p> <p>在侧边栏点击 &quot;+&quot;，选择 <code>Import</code>，在 Grafana Dashboard 的文本框中输入 8919 即可导入：</p> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/20200319193258.png" alt="import"></p> <p>进入导入 Dashboard 的页面，可以编辑名称，选择 Prometheus 的数据源：</p> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/image-20211003084451242.png" alt="image-20211003084451242"></p> <p>保存后即可进入导入的 Dashboard 页面。由于该 Dashboard 更新比较及时，所以基本上导入进来就可以直接使用了，我们也可以对页面进行一些调整，如果有的图表没有出现对应的图形，则可以编辑根据查询语句去 DEBUG。</p> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/20200319193754.png" alt="node-exporter dashboard"></p> <h2 id="_4、自定义图表"><a href="#_4、自定义图表" class="header-anchor">#</a> 4、自定义图表</h2> <p>导入现成的第三方 Dashboard 或许能解决我们大部分问题，但是毕竟还会有需要定制图表的时候，这个时候就需要了解如何去自定义图表了。</p> <p>同样在侧边栏点击 &quot;+&quot;，选择 Dashboard，然后选择 <code>Add new panel</code> 创建一个图表：</p> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/20210304172240.png" alt="add dashboard"></p> <p>然后在下方 Query 栏中选择 <code>Prometheus</code> 这个数据源：</p> <p><img src="https://bxdc-static.oss-cn-beijing.aliyuncs.com/images/20210304172455.png" alt="Queries"></p> <p>然后在 <code>Metrics</code> 区域输入我们要查询的监控 PromQL 语句，比如我们这里想要查询集群节点 CPU 的使用率：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>(1 <span class="token punctuation">-</span> sum(increase(node_cpu_seconds_total<span class="token punctuation">{</span>mode=&quot;idle&quot;<span class="token punctuation">,</span> instance=~&quot;$node&quot;<span class="token punctuation">}</span><span class="token punctuation">[</span>1m<span class="token punctuation">]</span>)) by (instance) / sum(increase(node_cpu_seconds_total<span class="token punctuation">{</span>instance=~&quot;$node&quot;<span class="token punctuation">}</span><span class="token punctuation">[</span>1m<span class="token punctuation">]</span>)) by (instance)) * 100
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>集群节点的 CPU 使用率实际上就相当于排除空闲 CPU 的使用率，所以我们可以优先计算空闲 CPU 的使用时长，除以总的 CPU 时长就是使用率了，用 1 减掉过后就是 CPU 的使用率了，如果想用百分比来表示的话则乘以 100 即可。</p> <p>这里有一个需要注意的地方是在 PromQL 语句中有一个 <code>instance=~&quot;$node&quot;</code> 的标签，其实意思就是根据 <code>$node</code> 这个参数来进行过滤，也就是我们希望在 Grafana 里面通过参数化来控制每一次计算哪一个节点的 CPU 使用率。</p> <p>所以这里就涉及到 Grafana 里面的参数使用。点击页面顶部的 <code>Dashboard Settings</code> 按钮进入配置页面：</p> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/image-20211003091437668.png" alt="image-20211003091437668"></p> <p>在左侧 tab 栏点击 <code>Variables</code> 进入参数配置页面，如果还没有任何参数，可以通过点击 <code>Add Variable</code> 添加一个新的变量：</p> <p>我们其实只是想要获取节点的名称，所以我们可以用正则表达式去匹配 <code>node=xxx</code> 这个标签，将匹配的值作为参数的值即可:</p> <p>在最下面的 <code>Preview of values</code> 里面会有获取的参数值的预览结果。除此之外，我们还可以使用一个更方便的 <code>label_values</code> 函数来获取，该函数可以用来直接获取某个指标的 label 值：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>label_values(kubelet_node_name<span class="token punctuation">,</span>node)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/image-20211003092414236.png" alt="image-20211003092414236"></p> <p>这里需要注意的是变量的名称 <code>node</code> 就是上面我们在 PromQL 语句里面使用的 <code>$node</code> 这个参数，这两个地方必须保持一致，然后最重要的就是参数的获取方式了，比如我们可以通过 <code>Prometheus</code> 这个数据源，通过 <code>kubelet_node_name</code> 这个指标来获取，在 Prometheus 里面我们可以查询该指标获取到的值为：</p> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/image-20211003092217571.png" alt="image-20211003092217571"></p> <p>另外由于我们希望能够让用户自由选择一次性可以查询多少个节点的数据，所以我们将 <code>Multi-value</code> 以及 <code>Include All option</code> 都勾选上了，最后记得保存，保存后跳转到 Dashboard 页面就可以看到我们自定义的图表信息：</p> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/image-20211003092516870.png" alt="image-20211003092516870"></p> <p>而且还可以根据参数选择一个或者多个节点，当然图表的标题和大小都可以自由去更改：</p> <p><img src="https://cdn.jsdelivr.net/gh/lzq70112/images/blog/image-20211003092729203.png" alt="image-20211003092729203"></p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/lzq70112/lzq70112.github.io/edit/master/docs/《Prometheus》学习笔记/05.Grafana安装与使用.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=Grafana" title="标签">#Grafana</a><a href="/tags/?tag=Prometheus" title="标签">#Prometheus</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/07/18, 19:58:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/b5e11114/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Prometheus监控常用资源对象</div></a> <a href="/pages/b5e11115/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">PromQL的语法及使用</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/b5e11114/" class="prev">Prometheus监控常用资源对象</a></span> <span class="next"><a href="/pages/b5e11115/">PromQL的语法及使用</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/ansible8/"><div>
            ansibleplaybook常用模块
            <!----></div></a> <span class="date">06-22</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/k8s110/"><div>
            kubelet硬件资源驱逐策略
            <!----></div></a> <span class="date">06-03</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/k8s111/"><div>
            k8s云存储nfs的nolock详解
            <!----></div></a> <span class="date">06-03</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:498510210@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/lzq70112" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2022
    <span>xiongmao | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank" rel="nofollow">MIT License</a> <a href="https://hongwei888.com/sitemap.xml" target="_blank">站点地图</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.e7221624.js" defer></script><script src="/assets/js/2.1e679d1d.js" defer></script><script src="/assets/js/168.2ade24d2.js" defer></script>
  </body>
</html>
